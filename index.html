<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SageCraft Ascendant â€” Sovereign Codex</title>
  <!-- <link rel="stylesheet" href="scripts/styles/sagecraftascendant.css?v=1.0.0"> -->
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icon/icon-192.png" type="image/png" />
  <!-- <meta name="theme-color" content="#1e1e2f" /> -->
  <!-- iOS PWA Splash and Icon Support -->
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Inventory Auditor">
  <link rel="apple-touch-icon" href="icon/splash-1080x1920.png">

  <!-- iOS Splash Screen (Portrait) -->
  <link rel="apple-touch-startup-image" href="icon/splash-1080x1920.png"
    media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
  <link rel="stylesheet" href="https://unpkg.com/phosphor-icons@1.4.2/src/css/ph.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&display=swap" rel="stylesheet">
  <!-- LiquidGlass styles should be loaded after all other head links -->
  <link rel="stylesheet" href="scripts/liquidGlass/liquidGlass.css">
  <meta name="theme-color" content="#2a003f" />
  <script src="https://apis.google.com/js/api.js"></script>
  <script type="text/javascript" src="https://www.dropbox.com/static/api/2/dropins.js" id="dropboxjs" data-app-key="440t4dh1sy47nue"></script>
</head>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <body class="liquid-glass-ui">
  <div style="position: fixed; top: 10px; right: 20px; z-index: 10000;">
    <label style="font-family: monospace; color: #fff;">
      <input type="checkbox" id="restoreToggle" checked />
      ğŸ” Restore Last Panel
    </label>
  </div>
  <!-- ğŸ”§ Phase 11.9 â€” Injected Dock Panel Anchors -->

  <!-- ğŸ”Œ Dock Panel Scaffolding Injected â€” Phase 12.0 -->
  <div class="dock-wrapper">
    <div id="exceptionManager" class="holo-console dock-panel"></div>
    <div id="deltaAnalyzer" class="holo-console dock-panel"></div>
    <div id="reportingHub" class="holo-console dock-panel"></div>
    <div id="sessionManager" class="holo-console dock-panel">
      <div class="last-backup-time"></div>
      <ul class="session-entries"></ul>
      <button class="trigger-backup">Backup</button>
      <button class="trigger-restore">Restore</button>
    </div>
    <div id="utilityHub" class="holo-console dock-panel"></div>
    <div id="progressDashboard" class="holo-console dock-panel"></div>
    <div id="masterExportHub" class="holo-console dock-panel"></div>
    <div id="mappings" class="holo-console dock-panel"></div>
    <div id="tools" class="holo-console dock-panel"></div>
    <div id="audit" class="holo-console dock-panel"></div>
    <div id="configPanel" class="holo-console dock-panel"></div>
  </div>

  <!--
  <div id="countConsole" class="holo-console" data-panel="count">
    ... (legacy, replaced by unified consolePanelGroup below)
  </div>
  -->

  <!-- ğŸ§  Predictive HUD Anchors -->
  <div id="predictiveHUD">
    <div id="dockStatusText" class="hud-label"></div>
    <div id="lastSync" class="hud-label"></div>
    <div>
      Items: <span id="itemSpan" class="hud-value"></span>
      Categories: <span id="categorySpan" class="hud-value"></span>
    </div>
    <ul id="recentList" class="hud-log"></ul>
  </div>

  <!--
  <div id="deltaAnalyzerConsole" class="holo-console" data-panel="deltaAnalyzer">
    ... (legacy, replaced by unified consolePanelGroup below)
  </div>
  -->

  <!--
  <div id="reportingHubConsole" class="holo-console" data-panel="reportingHub">
    ... (legacy, replaced by unified consolePanelGroup below)
  </div>
  -->

  <!--
  <div id="sessionManagerConsole" class="holo-console" data-panel="sessionManager">
    ... (legacy, replaced by unified consolePanelGroup below)
  </div>
  -->

  <!--
  <div id="utilityHubConsole" class="holo-console" data-panel="utilityHub">
    ... (legacy, replaced by unified consolePanelGroup below)
  </div>
  -->
</script>
  <script src="core/sovereignEventBus.js"></script>
</div>
</div>
<!-- ğŸ›  Dev Console Toggle -->
<div id="devConsoleToggle" onclick="toggleDevConsole()" style="
  position: fixed;
  bottom: 115px;
  left: 20px;
  z-index: 9999;
  background: #222;
  color: #00ffff;
  padding: 6px 12px;
  font-family: monospace;
  border: 1px solid #00ffff;
  border-radius: 6px;
  cursor: pointer;
  box-shadow: 0 0 8px #00ffff;
">
  ğŸ›  Dev Console
</div>

<!-- ğŸ§ª Dev Console Panel -->
  <div id="devConsolePanel" style="
  display: none;
  position: fixed;
  bottom: 175px;
  left: 20px;
  z-index: 9998;
  background: rgba(0,0,0,0.9);
  border: 1px solid #00ffff;
  padding: 12px;
  border-radius: 8px;
  width: 320px;
  max-width: 90vw;
  font-family: monospace;
  color: #0ff;
">
  <label for="devDirectiveInput">Directive JSON:</label>
  <select id="directivePresetSelect" onchange="loadDirectivePreset()" style="margin-bottom: 6px; width: 100%;">
    <option value="">ğŸ”½ Load Saved Directive...</option>
    <option value="dockManager.reinitialize">ğŸŒ€ dockManager â†’ reinitialize()</option>
    <option value="meshVitals.sync">âš™ï¸ meshVitals â†’ sync()</option>
    <option value="utilityHub.flushCache">â™»ï¸ utilityHub â†’ flushCache()</option>
  </select>
  <div style="margin-bottom: 6px;">
    <button onclick="saveCurrentDirectiveAsPreset()" style="margin-right: 6px;">ğŸ’¾ Save as Preset</button>
    <button onclick="deleteSelectedPreset()">ğŸ—‘ï¸ Delete Preset</button>
  </div>
  <textarea id="devDirectiveInput" style="width: 100%; height: 80px; margin-top: 6px;"></textarea>
  <button onclick="dispatchDevDirective()" style="
    margin-top: 10px;
    padding: 6px 10px;
    background: #00ffff;
    color: #000;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  ">ğŸš€ Dispatch</button>
</pre>
  <pre id="devConsoleLog" style="margin-top:10px; max-height:150px; overflow:auto; font-size:0.85em; background:#111; color:#0ff; padding:8px; border-radius:6px;"></pre>
  <pre id="feedbackConsole" style="
    margin-top: 6px;
    height: 150px;
    overflow-y: auto;
    background: #000;
    color: #0f0;
    font-family: monospace;
    font-size: 0.85em;
    padding: 10px;
    border-radius: 6px;
    border: 1px solid #0f0;
  "></pre>
</pre>
  <!-- ğŸ«€ Agent Lifeline Monitor Panel -->
  <div id="agentLifelinePanel" style="
    margin-top: 10px;
    border: 1px solid #888;
    padding: 8px;
    border-radius: 5px;
    background: #1b1b1b;
    color: #9cf;
    font-family: monospace;
    font-size: 0.8em;
  ">
    <b>ğŸ«€ Agent Lifeline Monitor</b>
    <ul id="agentLifelineList" style="margin-top: 6px; padding-left: 16px;"></ul>
    <button onclick="refreshAgentLifeline()" style="
      margin-top: 6px;
      background: #222;
      color: #9cf;
      border: 1px solid #555;
      padding: 4px 8px;
      font-size: 0.75em;
      cursor: pointer;
      border-radius: 4px;
    ">
      ğŸ” Refresh Lifeline
    </button>
  </div>
  <!-- ğŸ•¯ï¸ Anomaly Sanctum Panel -->
  <div id="anomalySanctumPanel" style="display: none; background: #111; border: 1px solid #444; padding: 10px; margin-top: 8px;">
    <h4 style="margin: 0; color: #f66;">ğŸ•¯ï¸ Anomaly Sanctum</h4>
    <ul id="anomalyList" style="margin: 6px 0 0; padding-left: 1em; font-size: 0.85em; color: #ccc;"></ul>
    <button onclick="restoreLastAnomaly()" style="
      margin-top: 6px;
      background: #222;
      color: #9cf;
      border: 1px solid #555;
      padding: 4px 8px;
      font-size: 0.75em;
      cursor: pointer;
      border-radius: 4px;
    ">
      â˜ ï¸ Raise Forgotten
    </button>
  </div>
</div>

<div id="neuralCommandBridge" style="position:fixed; bottom:0; left:0; width:100%; background:black; color:#00ffcc; z-index:9999; padding:12px; font-family:monospace; border-top: 2px solid #00ffcc; display:none;">
  <h3 style="margin-top:0;">ğŸ§  Neural Command Bridge Online</h3>
  
  <div style="display:flex; flex-wrap:wrap; gap:12px;">
    <button onclick="NeuralAuditSentinel.auditWiring()">âœ… Audit Integrity Scan</button>
    <button onclick="SelfHealingEngine.run()">â™» Self-Healing Engine</button>
    <button onclick="toggleCortexLoop()">ğŸ§  Cortex Loop Control</button>
    <button onclick="injectOrbit()">ğŸ›° Orbit Injection Utility</button>
    <button onclick="adjustGovernance()">âš™ Governance Thresholds</button>
  </div>

  <div id="commandBridgeOutput" style="margin-top:10px; color:#ccc; font-size:0.9em;"></div>
</div>
</body>
<script>
  function toggleDevConsole() {
    const panel = document.getElementById("devConsolePanel");
    if (panel) {
      panel.style.display = panel.style.display === "none" ? "block" : "none";
    }
  }

</script>
<script>
  // Directive Presets for Dev Console (now localStorage-based)
  function getStoredPresets() {
    return JSON.parse(localStorage.getItem("directivePresets") || "{}");
  }

  function updatePresetDropdown() {
    const select = document.getElementById("directivePresetSelect");
    const presets = getStoredPresets();

    // Clear and rebuild
    select.innerHTML = `<option value="">ğŸ”½ Load Saved Directive...</option>`;
    for (const key in presets) {
      const option = document.createElement("option");
      option.value = key;
      option.textContent = key;
      select.appendChild(option);
    }
  }

  function saveCurrentDirectiveAsPreset() {
    const name = prompt("Enter preset name (e.g., meshVitals.sync):");
    if (!name) return;
    try {
      const raw = document.getElementById("devDirectiveInput").value;
      const json = JSON.parse(raw);
      const presets = getStoredPresets();
      presets[name] = json;
      localStorage.setItem("directivePresets", JSON.stringify(presets));
      updatePresetDropdown();
      alert("âœ… Preset saved.");
    } catch {
      alert("âŒ Invalid JSON â€” cannot save.");
    }
  }

  function deleteSelectedPreset() {
    const select = document.getElementById("directivePresetSelect");
    const key = select.value;
    if (!key) return;
    const presets = getStoredPresets();
    if (!presets[key]) return;
    delete presets[key];
    localStorage.setItem("directivePresets", JSON.stringify(presets));
    updatePresetDropdown();
    alert("ğŸ—‘ï¸ Preset deleted.");
  }

  function loadDirectivePreset() {
    const key = document.getElementById("directivePresetSelect").value;
    const presets = getStoredPresets();
    if (presets[key]) {
      document.getElementById("devDirectiveInput").value =
        JSON.stringify(presets[key], null, 2);
    }
  }

  // Initialize dropdown on load
  updatePresetDropdown();

  function dispatchDevDirective() {
    try {
      const raw = document.getElementById("devDirectiveInput").value;
      const directive = JSON.parse(raw);
      if (window.SovereignBus?.emit) {
        window.SovereignBus.emit("agentDirective", directive);
        alert("âœ… Directive dispatched.");
      } else {
        alert("âŒ SovereignBus not found.");
      }
    } catch (err) {
      alert("âŒ Invalid JSON input.");
    }
  }

  // ğŸ›° Listen for Agent Responses and log them in the Dev Console
  // --- Agent Lifeline Monitor logic ---
  // The Hollow Warden anomaly handler
  const agentStatusMap = {};
  const anomalyLog = [];

  function refreshAgentLifeline() {
    renderAgentLifeline();
  }

  // Auto memory: Store seen agents
  function updateAgentLifeline(directive) {
    const key = directive?.target;
    if (!key) return;

    const now = Date.now();
    agentStatusMap[key] = now;
    storeAgentMemory();
    renderAgentLifeline();
  }

  function storeAgentMemory() {
    try {
      localStorage.setItem("agentMemory", JSON.stringify(agentStatusMap));
    } catch (e) {
      console.warn("Failed to store agent memory:", e);
    }
  }

  function restoreAgentMemory() {
    try {
      const stored = JSON.parse(localStorage.getItem("agentMemory") || "{}");
      Object.assign(agentStatusMap, stored);
      renderAgentLifeline();
    } catch (e) {
      console.warn("Failed to restore agent memory:", e);
    }
  }

  function renderAgentLifeline() {
    const list = document.getElementById("agentLifelineList");
    if (!list) return;

    list.innerHTML = "";
    const now = Date.now();

    Object.keys(agentStatusMap).forEach((key) => {
      const lastPing = agentStatusMap[key];
      const secondsAgo = Math.floor((now - lastPing) / 1000);

      let status = "âœ… ONLINE";
      let cssClass = "agent-status-online";

      if (secondsAgo > 30) {
        status = "âŒ MISSING";
        cssClass = "agent-status-missing";
      } else if (secondsAgo > 10) {
        status = "âš ï¸ IDLE";
        cssClass = "agent-status-idle";
      }

      const li = document.createElement("li");
      li.textContent = `${key}: ${status} â€” ${secondsAgo}s ago`;
      li.className = cssClass;
      list.appendChild(li);
    });
  }

  function sweepGhostAgents() {
    const now = Date.now();
    const purged = [];

    Object.entries(agentStatusMap).forEach(([key, timestamp]) => {
      const age = now - timestamp;
      if (age > 120000) {
        purged.push(key);
        anomalyLog.unshift({ key, timestamp });
        delete agentStatusMap[key];
      }
    });

    if (purged.length > 0) {
      storeAgentMemory();
      renderAgentLifeline();
      renderAnomalySanctum();
      logToFeedbackConsole(`â˜ ï¸ Hollow Warden purged ${purged.length} ghost agent(s): ${purged.join(", ")}`);
    }
  }

  function pulseWardenGlyph(active) {
  const glyph = document.getElementById("wardenGlyph");
  if (!glyph) return;
  glyph.style.color = active ? "#f44" : "#444";
  glyph.style.transform = active ? "scale(1.2)" : "scale(1)";
}

function toggleAnomalySanctum() {
  const panel = document.getElementById("anomalySanctumPanel");
  if (!panel) return;
  panel.style.display = panel.style.display === "none" ? "block" : "none";
}

function renderAnomalySanctum() {
  const list = document.getElementById("anomalyList");
  if (!list) return;
  list.innerHTML = "";

  anomalyLog.slice(0, 10).forEach((entry) => {
    const li = document.createElement("li");
    const time = new Date(entry.timestamp).toLocaleTimeString();
    li.textContent = `${entry.key} â€” ${time}`;
    list.appendChild(li);
  });

  const panel = document.getElementById("anomalySanctumPanel");
  const hasAnomalies = anomalyLog.length > 0;

  if (panel) panel.style.display = hasAnomalies ? "block" : "none";
  pulseWardenGlyph(hasAnomalies);
}

  function renderAnomalySanctum() {
    const list = document.getElementById("anomalyList");
    if (!list) return;
    list.innerHTML = "";

    anomalyLog.slice(0, 10).forEach((entry) => {
      const li = document.createElement("li");
      const time = new Date(entry.timestamp).toLocaleTimeString();
      li.textContent = `${entry.key} â€” ${time}`;
      list.appendChild(li);
    });

    // Reveal the panel if it has content
    document.getElementById("anomalySanctumPanel").style.display = anomalyLog.length > 0 ? "block" : "none";
  }

  function restoreLastAnomaly() {
    const entry = anomalyLog.shift();
    if (!entry) return alert("No anomalies to restore.");
    agentStatusMap[entry.key] = Date.now();
    renderAgentLifeline();
    renderAnomalySanctum();
    storeAgentMemory();
    logToFeedbackConsole(`âš¡ Restored forgotten agent: ${entry.key}`);
  }

  setInterval(sweepGhostAgents, 90000);

  // Restore on load
  restoreAgentMemory();

  if (window.SovereignBus?.on) {
    SovereignBus.on("agentResponse", (response) => {
      console.log("ğŸ›° Agent Response Received:", response);
      appendDevLog(response);

      const summary = response.directive?.target + "." + response.directive?.action;
      const status = response.status?.toUpperCase() || "UNKNOWN";
      logToFeedbackConsole(`${status} â€” ${summary}`);

      // Lifeline update
      updateAgentLifeline(response.directive);
    });
  }
  function logToFeedbackConsole(msg) {
    const logBox = document.getElementById("feedbackConsole");
    if (!logBox) return;
    const timestamp = new Date().toLocaleTimeString();
    const line = `[${timestamp}] ${msg}`;
    logBox.textContent += line + "\n";
    logBox.scrollTop = logBox.scrollHeight;
  }

  function appendDevLog(response) {
    const logEl = document.getElementById("devConsoleLog");
    if (!logEl) return;

    const timestamp = new Date().toLocaleTimeString();
    const status = response.status?.toUpperCase() || "UNKNOWN";
    const summary = response.directive?.action
      ? `${response.directive.target}.${response.directive.action}()`
      : "No action";

    let symbol = "ğŸ”·";
    if (status === "SUCCESS") symbol = "âœ…";
    else if (status === "ERROR") symbol = "âŒ";
    else if (status === "UNHANDLED") symbol = "âš ï¸";

    const line = `[${timestamp}] ${symbol} ${status} â€” ${summary}`;
    const existing = logEl.textContent.trim();
    logEl.textContent = line + "\n" + existing;
  }
</script>
</html>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const toggle = document.getElementById("restoreToggle");
      const restoreEnabled = localStorage.getItem("restoreEnabled") !== "false";
      toggle.checked = restoreEnabled;

      toggle.addEventListener("change", () => {
        localStorage.setItem("restoreEnabled", toggle.checked);
      });

      // Intercept Neural persistence restoration
      const originalRestore = window.NeuralMemory?.restoreLastPanel;
      if (typeof originalRestore === "function") {
        const shouldRestore = localStorage.getItem("restoreEnabled") !== "false";
        if (shouldRestore) {
          originalRestore();
        }
      }
    });
  </script>
  <div class="logo-banner-flex">
    <div id="operatorTierStatus" class="operator-tier-status sovereign-active">
      <span class="tier-badge">ğŸ›¡ SOVEREIGN</span>
      <span id="authStatusLight" class="status-light status-authenticated" title="Authenticated"></span>
    </div>
    <div class="header-title">
      <img id="mainLogo" src="icon/icon-1280.png" alt="SageCraft Ascendant Logo" style="max-width: 220px; height: auto;" />
      <h1 class="logo-title">SageCraft Ascendant â€” Sovereign Codex</h1>
    </div>
    <div id="sovereignToolbarMount" class="sovereign-toolbar-container"></div>
    <!-- Additional HoloConsole Sovereign Panels -->
    <!-- Sovereign Orbit Dock Console Panels -->
    <section class="holo-console hidden" id="pulseMonitorConsole" aria-hidden="true"></section>
    <!-- ğŸ”® Oracle Subsystem Panel -->
    <div id="oracle" class="holo-console hidden">
      <h2>ğŸ”® Oracle Subsystem</h2>
      <div id="oracleOutput" class="console-output"></div>
    </div>
  </div>
  <!-- === DOM Alignment Fixes: Forecast Console, Aliases, and DockGrid Stub === -->
  <!-- 1. Forecast Console -->
  <section id="forecastConsole" class="holo-console hidden" aria-hidden="true">
    <header class="console-header">ğŸ”® Forecast Console</header>
    <div class="console-body">
      <p>ğŸ“Š Forecast analysis and anomaly data will appear here.</p>
    </div>
  </section>
    <!-- 2. Full Panel Definitions for count and deltaAnalyzer -->
    <section class="holo-console hidden" id="countConsole" aria-hidden="true">
      <button class="panel-close" onclick="closeConsole(this)">âœ–ï¸</button>
      <header class="console-header">ğŸ§® Count Console</header>
      <div class="console-body">
        <div class="panel-content">
          <h2>ğŸ§® Count Console</h2>
          <p>Track any metric or inventory manually.</p>

          <div class="counter-display" id="countDisplay">0</div>

          <div class="counter-controls">
            <button onclick="updateCounter(1)">â• Increment</button>
            <button onclick="updateCounter(-1)">â– Decrement</button>
            <button onclick="resetCounter()">ğŸ” Reset</button>
          </div>

          <!-- Predictive HUD and count refresh markup -->
          <div class="status-bar">
            <span class="dock-status" id="dockStatusText">Status: Operational</span>
            <span class="last-sync">Last Sync: <span class="last-sync-time" id="lastSync">--:--</span></span>
          </div>
          <div class="hud-data">
            <span>Items: <span class="item-count" id="itemSpan">0</span></span>
            <span>Categories: <span class="category-count" id="categorySpan">0</span></span>
          </div>
          <ul class="recent-activity" id="recentList">
            <li>No recent activity</li>
          </ul>
          <button class="refresh-counts">ğŸ”„ Refresh Counts</button>
        </div>
      </div>
    </section>
  <style>
    .counter-display {
      font-size: 3rem;
      margin: 1rem 0;
      color: #0ff;
      text-shadow: 0 0 5px #0ff;
    }
    .counter-controls button {
      margin: 0.3rem;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      background: rgba(255,255,255,0.05);
      border: 1px solid #0ff;
      color: #0ff;
      cursor: pointer;
    }
    .counter-controls button:hover {
      background: rgba(0,255,255,0.1);
    }
  </style>
    <section class="holo-console hidden" id="deltaAnalyzerConsole" aria-hidden="true">
      <button class="panel-close" onclick="closeConsole(this)">âœ–ï¸</button>
      <header class="console-header">ğŸ“Š Delta Analyzer</header>
      <div class="console-body">
        <div class="panel-content">
          <h2>ğŸ“Š Delta Analyzer</h2>
          <p>Compare two values and calculate the delta (A - B).</p>

          <label>
            Value A:
            <input type="number" id="deltaValueA" placeholder="Enter Value A">
          </label>
          <label>
            Value B:
            <input type="number" id="deltaValueB" placeholder="Enter Value B">
          </label>

          <div class="delta-controls">
            <button onclick="calculateDelta()">ğŸ” Analyze</button>
            <button onclick="clearDeltaInputs()">ğŸ§¼ Clear</button>
          </div>

          <div id="deltaResult" class="delta-result">Î” = 0</div>
        </div>
      </div>
    </section>
    <!-- 3. Dock Grid Stub -->
    <div id="dockGrid" style="display: none;"></div>

    <!-- Injected missing orbital panels -->
    <section class="holo-console hidden" id="reportingHubConsole" aria-hidden="true">
      <button class="panel-close" onclick="closeConsole(this)">âœ–ï¸</button>
      <header class="console-header">ğŸ—‚ Reporting Hub</header>
      <div class="console-body">
        <div class="panel-content">
          <h2>ğŸ“ Reporting Hub</h2>
          <p>Submit observations, reports, or logs below.</p>
          <div class="button-group">
            <button class="run-diagnostics">Run Diagnostics</button>
            <button class="export-report">Export Report</button>
            <button class="clear-logs">Clear Logs</button>
          </div>
          <div class="log-output"></div>
        </div>
      </div>
    </section>

    <section class="holo-console hidden" id="sessionManagerConsole" aria-hidden="true">
      <button class="panel-close" onclick="closeConsole(this)">âœ–ï¸</button>
      <header class="console-header">ğŸ“‹ Session Manager</header>
      <div class="console-body">
        <div class="panel-content">
          <h2>ğŸ§  Session Manager</h2>
          <p>Name and initiate your active session.</p>

          <label>
            Session Name:
            <input type="text" id="sessionNameInput" placeholder="e.g., Forecast Sync 7">
          </label>
          <button onclick="startSession()">ğŸš€ Start Session</button>

          <div id="activeSessionDisplay" class="session-display"></div>
        </div>
      </div>
    </section>
    <!-- ğŸ›  Utility Hub Console Panel (injected after sessionManagerConsole) -->
    <div id="utilityHubConsole" class="holo-console dock-panel hidden">
      <h2>ğŸ› ï¸ Utility Hub</h2>
      <button class="clean-cache">ğŸ§¹ Clean Cache</button>
      <button class="resync">ğŸ”„ Re-Sync</button>
      <div class="utility-log"></div>
    </div>


    <section class="holo-console hidden" id="utilityHubConsole" aria-hidden="true">
      <button class="panel-close" onclick="closeConsole(this)">âœ–ï¸</button>
      <header class="console-header">ğŸ§° Utility Hub</header>
      <div class="console-body">
        <div class="panel-content">
          <h2>ğŸ›  Utility Hub</h2>
          <p>Run quick diagnostics or utility functions.</p>

          <div class="utility-controls">
            <button onclick="triggerTestAlert()">ğŸ”” Test Alert</button>
            <button onclick="runDiagnosticLog()">ğŸ“‹ Log Diagnostic</button>
            <button onclick="pingPanels()">ğŸ“¡ Ping Panels</button>
          </div>

          <pre id="utilityOutput" class="utility-output">Awaiting commands...</pre>
        </div>
      </div>
    </section>
    <!-- Exception Manager Console -->
    <section class="holo-console hidden" id="exceptionManagerConsole" aria-hidden="true">
      <button class="panel-close" onclick="closeConsole(this)">âœ–ï¸</button>
      <header class="console-header">ğŸ›  Exception Manager</header>
      <div class="console-body">
        <div class="panel-content">
          <h2>ğŸ›  Exception Manager</h2>
          <p>Subsystem for managing and simulating system exceptions.</p>
          <button class="trigger-exception">Trigger</button>
          <button class="clear-logs">Clear Logs</button>
          <button class="view-report">View Report</button>
          <div class="exception-log" style="margin-top: 10px; border: 1px solid #888; padding: 10px; min-height: 100px;">
              <!-- Logs will appear here -->
          </div>
        </div>
      </div>
    </section>
  <script>
    function triggerTestAlert() {
      alert("ğŸ”” Alert triggered from Utility Hub!");
      logUtility("Alert dispatched.");
    }

    function runDiagnosticLog() {
      console.log("ğŸ“‹ Utility Hub Diagnostic: System online.");
      logUtility("Logged system diagnostic to console.");
    }

    function pingPanels() {
      const panels = document.querySelectorAll(".holo-console");
      logUtility(`ğŸ“¡ Pinged ${panels.length} panels. Status: Responsive.`);
    }

    function logUtility(message) {
      const output = document.getElementById("utilityOutput");
      const timestamp = new Date().toLocaleTimeString();
      output.textContent = `[${timestamp}] ${message}`;
    }
  </script>
  <style>
    .utility-controls button {
      margin: 0.4rem;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      background: rgba(255,255,255,0.05);
      border: 1px solid #ff69b4;
      color: #ff69b4;
      cursor: pointer;
    }

    .utility-controls button:hover {
      background: rgba(255,105,180,0.1);
    }

    .utility-output {
      background: rgba(255,255,255,0.05);
      padding: 0.75rem;
      margin-top: 0.75rem;
      font-family: monospace;
      color: #ff69b4;
      border: 1px dashed #ff69b4;
      white-space: pre-wrap;
    }

    @keyframes pulseGreen {
  0% { color: #0f0; transform: scale(1); }
  50% { color: #6f6; transform: scale(1.05); }
  100% { color: #0f0; transform: scale(1); }
}

@keyframes pulseYellow {
  0% { color: #ff0; transform: scale(1); }
  50% { color: #ffb; transform: scale(1.05); }
  100% { color: #ff0; transform: scale(1); }
}

@keyframes pulseRed {
  0% { color: #f00; transform: scale(1); }
  50% { color: #f88; transform: scale(1.05); }
  100% { color: #f00; transform: scale(1); }
}

.agent-status-online {
  animation: pulseGreen 1.5s infinite;
}
.agent-status-idle {
  animation: pulseYellow 2s infinite;
}
.agent-status-missing {
  animation: pulseRed 2.2s infinite;
}
  </style>

    <section class="holo-console hidden" id="oracleConsole" aria-hidden="true">
      <button class="panel-close" onclick="closeConsole(this)">âœ–ï¸</button>
      <header class="console-header">ğŸ”® Oracle Interface</header>
      <div class="console-body">
        <div class="panel-content">
          <h2>ğŸ”® Oracle Console</h2>
          <p>Consult the Silent Sage. Enter your query below:</p>

          <label>
            Your Inquiry:
            <input type="text" id="oracleInput" placeholder="e.g., What is the state of the mesh?">
          </label>
          <button onclick="consultOracle()">ğŸ§™ Ask the Sage</button>

          <div id="oracleResponse" class="oracle-output">Awaiting your question...</div>
        </div>
      </div>
    </section>
    <!-- Micro-injected missing panels for Sovereign Console -->
    <div id="exceptionManagerConsole" class="holo-console">
      <h2>ğŸ§¨ Exception Manager</h2>
      <p>Monitoring real-time exceptions in the system.</p>
      <ul id="exceptionList">
        <!-- Exceptions dynamically populated here -->
      </ul>
      <button id="clearExceptionsBtn">Clear Exceptions</button>
    </div>
    <div id="progressDashboardConsole" class="holo-console"></div>
    <div id="masterExportHubConsole" class="holo-console"></div>
    <div id="mappingsConsole" class="holo-console"></div>
    <div id="toolsConsole" class="holo-console"></div>
    <div id="auditConsole" class="holo-console"></div>
    <div id="configPanelConsole" class="holo-console"></div>
  <script>
    function consultOracle() {
      const input = document.getElementById("oracleInput");
      const response = document.getElementById("oracleResponse");
      const question = input.value.trim();

      if (!question) return;

      const reply = generateMysticalResponse(question);
      response.textContent = `ğŸ§™ Sage replies: "${reply}"`;
      input.value = '';
    }

    function generateMysticalResponse(query) {
      const responses = [
        "The data whispers truths hidden in code.",
        "All systems stabilize in time.",
        "Beware the silent drift between panels.",
        "Your path will align when the circuit is closed.",
        "The mesh remembers more than you think."
      ];
      return responses[Math.floor(Math.random() * responses.length)];
    }
  </script>
  <style>
    #oracleConsole input {
      padding: 0.5rem;
      font-size: 1rem;
      width: 60%;
      margin-right: 0.5rem;
    }

    #oracleConsole button {
      padding: 0.5rem 1rem;
      font-size: 1rem;
      background: rgba(128,0,128,0.05);
      border: 1px solid #8a2be2;
      color: #8a2be2;
      cursor: pointer;
    }

    #oracleConsole button:hover {
      background: rgba(138,43,226,0.1);
    }

    .oracle-output {
      margin-top: 1rem;
      font-family: serif;
      font-style: italic;
      color: #8a2be2;
      text-shadow: 0 0 4px #8a2be2;
    }
  </style>

  <div id="orbitClusterWrap" style="display: flex; justify-content: center; padding: 40px 0;">
    <div id="sovereignOrbitDock" class="orbit-cluster">
      <button class="orbit-btn" data-target="countConsole">
        <img src="assets/icons/icon-count.png" alt="Count Console" />
      </button>
      <button class="orbit-btn" data-target="deltaAnalyzerConsole">
        <img src="assets/icons/icon-delta.png" alt="Delta Analyzer" />
      </button>
      <button class="orbit-btn" data-target="reportingHubConsole">
        <img src="assets/icons/icon-reporting.png" alt="Reporting Hub" />
      </button>
      <button class="orbit-btn" data-target="sessionManagerConsole">
        <img src="assets/icons/icon-session.png" alt="Session Manager" />
      </button>
      <button class="orbit-btn" data-target="utilityHubConsole">
        <img src="assets/icons/icon-utility.png" alt="Utility Hub" />
      </button>
      <button class="orbit-btn" data-target="oracleConsole">
        <img src="assets/icons/icon-oracle.png" alt="Oracle Console" />
      </button>
      <div class="whisperer-orbit-container">
        <button class="orbit-btn" data-target="whispererConsole" title="The Whisperer Console">
          <img src="assets/icons/icon-whisperer-glyph.png" alt="Whisperer Icon" />
        </button>
      </div>
      <button class="orbit-btn sagefeed-orbit" data-target="sageFeedConsole" title="Sage Feed Console">
        <img src="assets/icons/icon-sagefeed-glyph-v2.png" alt="Sage Feed Console">
      </button>
      <!-- ğŸª Grimoire Orbit Button -->
      <button class="orbit-btn" data-target="grimoireConsole" title="Grimoire Console">
        <img src="assets/icons/icon-grimoire-glyph.png" alt="Grimoire Console" />
      </button>
    </div>
  </div>
  <!-- Fallback Dock Grid Container -->
  <div id="dockGrid" class="dock-grid hidden">
    <!-- Panels will populate here dynamically -->
  </div>

  <!-- Whisperer Orbit external navigation logic removed; now handled via data-target like other orbits -->
  <!-- Ensure required console panels exist directly below #sovereignOrbitDock -->
  <script>
  document.addEventListener("DOMContentLoaded", function() {
    // Panel IDs & class
    const expectedPanels = [
      { id: "countConsole", className: "holo-console" },
      { id: "deltaAnalyzerConsole", className: "holo-console" },
      { id: "reportingHubConsole", className: "holo-console" },
      { id: "sessionManagerConsole", className: "holo-console" },
      { id: "utilityHubConsole", className: "holo-console" },
      { id: "oracleConsole", className: "holo-console" },
    ];
    // Find the sovereignOrbitDock node
    const dock = document.getElementById("sovereignOrbitDock");
    if (dock) {
      // Find last console panel after the dock (if any) to insert after
      let insertAfter = dock.parentNode;
      // Gather all direct siblings after #sovereignOrbitDock
      let next = dock.parentNode.nextSibling;
      let lastConsole = null;
      while (next) {
        if (next.nodeType === 1 && next.classList && next.classList.contains("holo-console")) {
          lastConsole = next;
        }
        next = next.nextSibling;
      }
      // Insert missing panels after the last known console, or after dock
      let insertParent = dock.parentNode.parentNode;
      let insertRef = dock.parentNode.nextSibling;
      // Check for each panel
      expectedPanels.forEach(panel => {
        if (!document.getElementById(panel.id)) {
          // Create and insert the missing panel
          const div = document.createElement("div");
          div.id = panel.id;
          div.className = panel.className;
          insertParent.insertBefore(div, insertRef);
        }
      });
    }
    // Predictive HUD DOM structure
    function createPredictiveHudDom() {
      const hud = document.createElement("div");
      hud.id = "predictiveHud";
      hud.className = "hud-container";
      hud.innerHTML = `
        <div id="dockStatusText">Dock: N/A</div>
        <div id="lastSync">Last Sync: N/A</div>
        <div>Items: <span id="itemSpan">0</span></div>
        <div>Categories: <span id="categorySpan">0</span></div>
        <ul id="recentList"></ul>
      `;
      return hud;
    }
    let predictiveHud = document.getElementById("predictiveHud");
    if (!predictiveHud) {
      // Try to find a container to append it to
      const container = document.getElementById("predictiveHud") || document.body;
      if (container && container.id === "predictiveHud") {
        // Already present, do nothing
      } else if (container && container.tagName === "BODY") {
        container.appendChild(createPredictiveHudDom());
      }
    }
  });
  </script>
  <header id="sovereignHeader">
  </header>

  <div id="wardenGlyph" onclick="toggleAnomalySanctum()" title="The Hollow Warden watches..." style="
  position: absolute;
  top: 58px;
  left: 12px;
  font-size: 1.4em;
  color: #444;
  cursor: pointer;
  user-select: none;
  transition: all 0.4s ease;
">
  â˜ ï¸
</div>
  <!-- ğŸ§­ Sovereign Ascendant Toolbar -->
  <div id="sovereignToolbar" class="sovereign-toolbar"></div>

  <!-- HoloConsole Sovereign Panels (for SovereignToolbar toggling) -->


  <!-- All legacy static Operator Console Panel and legacy tab-section panels removed.
       Only dynamic Control Deck injection point remains below. -->
  <div id="operatorConsole" class="tabcontent"></div>
  <!-- ğŸ§  Sage Feed Console Interface -->
  <div id="sageFeedConsoleWrapper" class="holo-console dock-panel hidden">
    <h2>ğŸ§  Sage Feed Console</h2>
    <p class="console-desc">Direct injection to Sage Memory Engine. Enter encoded lore, trigger phrases, or neural directives.</p>
    <textarea id="sageFeedInput" placeholder="Type a memory, command, or phrase..." rows="5"></textarea>
    <button id="sageFeedSubmit" class="primary-btn">ğŸ”® Feed the Sage</button>
    <div id="sageFeedLog" class="sage-feed-log"></div>
  </div>

  <!-- Neural Operator Console Panel -->
  <div id="operatorConsolePanel" class="console-section">
    <!-- Neural Operator Console will render here -->
  </div>




<!-- Phase 125.8 â€” Predictive Overlay Remover -->
  <style>
    .report-controls button {
      margin: 0.3rem;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      background: rgba(255,255,255,0.05);
      border: 1px solid #ffa500;
      color: #ffa500;
      cursor: pointer;
    }

    .report-controls button:hover {
      background: rgba(255,165,0,0.1);
    }

    #reportInput {
      width: 100%;
      padding: 0.5rem;
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }

    .report-log {
      list-style: none;
      padding-left: 0;
      color: #ffa500;
      font-family: monospace;
      max-height: 200px;
      overflow-y: auto;
    }

    .report-log li {
      margin-bottom: 0.3rem;
      padding-bottom: 0.3rem;
      border-bottom: 1px dashed #ffa500;
    }
    #diagnosticOverlay, #dropboxStatusOverlay {
      display: none !important;
    }
    .orbit-btn img.orbit-icon {
      width: 80%;
      height: 80%;
      object-fit: contain;
      display: block;
      margin: auto;
      padding: 10%;
      box-sizing: border-box;
    }
    .orbit-btn.active-orbit {
      border: 2px solid #cc66ff;
      box-shadow: 0 0 12px #cc66ff, inset 0 0 6px #cc66ff;
      transform: scale(1.05);
      transition: all 0.3s ease;
    }
  </style>

  <main class="container neon-container" role="main">
    <!-- Phase 300.12 â€” Orbital Dock Visibility Mesh (legacy static dock-toggle bar removed) -->
    <div class="mobile-wrapper">
      <div class="fantasy-wrapper electric-vibe">
      </div>
    </div>
    <!-- ğŸ§± Sovereign Dock Grid Container -->
    <!-- === Unified Holo Console Grid (moved just above Sovereign Orbit Dock) === -->
    <!-- ğŸ§  Reintegrated Console Panel Group -->
    <div id="consolePanelGroup" style="position: relative; z-index: 10; margin-top: 30px;">
      <div id="deltaAnalyzerConsole" class="holo-console hidden"
        style="display: none; visibility: hidden; opacity: 0; z-index: -1;"></div>
      <div id="reportingHubConsole" class="holo-console hidden"
        style="display: none; visibility: hidden; opacity: 0; z-index: -1;"></div>
      <div id="sessionManagerConsole" class="holo-console hidden"
        style="display: none; visibility: hidden; opacity: 0; z-index: -1;"></div>
      <div id="sageFeedConsole" class="holo-console dock-panel hidden" aria-hidden="true">
        <h2>ğŸ§  Sage Feed Console</h2>
        <p>Enter memory tokens, commands, or lore injections:</p>
        <textarea id="sageFeedInput" placeholder="Feed me knowledge..."></textarea>
        <button class="inject-feed">Inject Memory</button>
        <div id="feedLog"></div>
      </div>
      <div id="utilityHubConsole" class="holo-console hidden"
        style="display: none; visibility: hidden; opacity: 0; z-index: -1;"></div>
      <div id="exceptionManagerConsole" class="holo-console hidden"
        style="display: none; visibility: hidden; opacity: 0; z-index: -1;"></div>
      <div id="masterExportHubConsole" class="holo-console hidden"
        style="display: none; visibility: hidden; opacity: 0; z-index: -1;"></div>
      <div id="progressDashboardConsole" class="holo-console hidden"
        style="display: none; visibility: hidden; opacity: 0; z-index: -1;"></div>
      <div id="mappingsConsole" class="holo-console hidden"
        style="display: none; visibility: hidden; opacity: 0; z-index: -1;"></div>
      <div id="toolsConsole" class="holo-console hidden"
        style="display: none; visibility: hidden; opacity: 0; z-index: -1;"></div>
      <div id="auditConsole" class="holo-console hidden"
        style="display: none; visibility: hidden; opacity: 0; z-index: -1;"></div>
      <div id="oracleConsole" class="holo-console hidden"
        style="display: none; visibility: hidden; opacity: 0; z-index: -1;"></div>
    </div>
    <!-- ğŸ§  End Console Panel Group -->
    <!-- ğŸ“– Grimoire Console Panel -->
    <section id="grimoireConsole" class="holo-console hidden" aria-hidden="true">
      <h2 class="console-title">ğŸ“– Grimoire Console</h2>
      <div id="grimoirePanelContent">
        <p>Select a memory node to review its imprint...</p>
      </div>
      <!-- Lore Archive Table Panel: injected below main lore log panel -->
      <section id="grimoireTablePanel" class="grimoire-table-panel">
        <h2>ğŸ“š Lore Archive Table</h2>
        <!-- Table will be rendered here by JS -->
      </section>
    </section>
    <!-- ğŸŒ«ï¸ WHISPERER CONSOLE PANEL -->
    <section id="whispererConsole" class="holo-console panel">
      <h2 class="console-title">ğŸŒ€ Whisperer Console</h2>

      <!-- Whisperer Console Output (ensure this exists and is first in the panel) -->
      <div id="whispererConsoleOutput" class="console-output"></div>

      <section id="neuralPulseMonitor" class="console-section">
        <h3>Neural Pulse</h3>
        <div class="pulse-visual"></div>
        <p id="pulseStatus">Initializing...</p>
      </section>

      <section id="echoArchivePanel" class="console-section">
        <h3>Echo Archive</h3>
        <ul id="echoLogEntries"></ul>
      </section>

      <section id="coreCommandInput" class="console-section">
        <h3>Inject Command</h3>
        <input type="text" id="sovereignCommand" placeholder="Enter core directive...">
        <button id="injectCommandBtn">Inject</button>
        <div id="commandResponse" class="command-feedback"></div>
      </section>
    </section>
<!-- Grimoire Lore Table Render Trigger -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    if (window.GrimoireMemory && typeof GrimoireMemory.renderTableTo === "function") {
      GrimoireMemory.renderTableTo("grimoireTablePanel");
    }
  });
</script>
  </main>

<!-- Phase 201.2 â€” Neural Intake Uploader binding -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const intakeBtn = document.getElementById("launchNeuralIntakeBtn");
  const intakeFile = document.getElementById("neuralIntakeFile");

  if (intakeBtn && intakeFile) {
    intakeBtn.addEventListener("click", () => intakeFile.click());
    intakeFile.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (!file) return;
      if (window.NeuralDataIntake?.parseUploadedFile) {
        window.NeuralDataIntake.parseUploadedFile(file);
      } else {
        alert("Neural Intake system unavailable.");
      }
    });
  }
});
</script>


<!-- Phase 201.3 â€” Intake Pipeline Integration -->
<script>
// Upgraded drift-aware Neural Intake Pipeline Integration
document.addEventListener("DOMContentLoaded", () => {
  const intakeBtn = document.getElementById("launchNeuralIntakeBtn");
  const intakeFile = document.getElementById("neuralIntakeFile");

  if (intakeBtn && intakeFile) {
    intakeBtn.addEventListener("click", () => intakeFile.click());
    intakeFile.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (!file) return;
      if (window.NeuralDataIntake?.parseUploadedFile) {
        window.NeuralDataIntake.parseUploadedFile(file);

        // After successful parse, inject report directly into Cortex with drift-aware session ID
        setTimeout(() => {
          const parsed = window.NeuralDataIntake.getParsedReports();
          if (!parsed || parsed.length === 0) {
            console.warn("Neural Intake: No parsed data found.");
            return;
          }

          // Generate session identifier based on timestamp
          const intakeSessionId = `Intake_${new Date().toISOString().replace(/[:.]/g, '-')}`;

          // Phase 700.4 â€” Neural Drift Threshold Optimizer Injection
          if (!window.NeuralDriftThresholds) {
            window.NeuralDriftThresholds = {};
          }
          parsed.forEach(row => {
            const category = row.division;
            if (!window.NeuralDriftThresholds[category]) {
              window.NeuralDriftThresholds[category] = { count: 0, sumVariance: 0 };
            }
            const previousQty = 0; // Starting point for learning (can expand later)
            const variance = Math.abs(row.onHandUnits - previousQty);
            window.NeuralDriftThresholds[category].count += 1;
            window.NeuralDriftThresholds[category].sumVariance += variance;
          });

          parsed.forEach(row => {
            const avgDriftThreshold = Math.max(
              (window.NeuralDriftThresholds[row.division].sumVariance / window.NeuralDriftThresholds[row.division].count) * 0.25,
              5
            );
            const forecastEntry = {
              timestamp: new Date().toISOString(),
              intakeSessionId: intakeSessionId,
              itemNumber: row.itemNumber,
              division: row.division,
              onHandUnits: row.onHandUnits,
              cycleCountUnits: row.cycleCountUnits,
              shrinkUnits: row.shrinkUnits,
              itdSalesUnits: row.itdSalesUnits,
              stabilityHint: (row.shrinkUnits > 0 || row.cycleCountUnits !== 0) ? "Volatile" : "Stable",
              riskSignal: "ğŸŸ¢ Stable",
              anomalySignal: "âšª Unanalyzed",
              learnedDriftThreshold: avgDriftThreshold.toFixed(1)
            };

            if (typeof window.NeuralForecastMemoryCortex?.injectForecastRecord === "function") {
              window.NeuralForecastMemoryCortex.injectForecastRecord(forecastEntry);
            }
          });

          console.log("ğŸ§  Neural Cortex successfully injected with live intake data.");
        }, 500);
      } else {
        alert("Neural Intake system unavailable.");
      }
    });
  }
});
</script>

<!-- Phase 201.4 â€” Neural Intake Validation Diagnostics -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const validateIntakeBtn = document.createElement("button");
  validateIntakeBtn.textContent = "ğŸ§ª Validate Neural Intake";
  validateIntakeBtn.style.padding = "12px 18px";
  validateIntakeBtn.style.fontSize = "1em";
  validateIntakeBtn.style.fontFamily = "monospace";
  validateIntakeBtn.style.background = "#660033";
  validateIntakeBtn.style.color = "#fff";
  validateIntakeBtn.style.border = "2px solid #ff6699";
  validateIntakeBtn.style.borderRadius = "8px";
  validateIntakeBtn.style.cursor = "pointer";
  validateIntakeBtn.style.transition = "all 0.3s ease";

  validateIntakeBtn.addEventListener("click", () => {
    const parsed = window.NeuralDataIntake?.getParsedReports();
    if (!parsed || parsed.length === 0) {
      alert("âš  No parsed reports loaded.");
      return;
    }

    let sample = parsed.slice(0, 5);
    console.log("ğŸ§  Neural Intake Sample:", sample);
    alert(`âœ… Neural Intake contains ${parsed.length} rows. First 5 samples logged to console.`);
  });

  const operatorTools = document.getElementById("operatorTools");
  if (operatorTools) {
    operatorTools.appendChild(validateIntakeBtn);
  }
});
</script>

<!-- Phase 201.5 â€” Neural Cortex Session Memory Archiver -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const archiveIntakeBtn = document.createElement("button");
  archiveIntakeBtn.textContent = "ğŸ’¾ Archive Neural Session";
  archiveIntakeBtn.style.padding = "12px 18px";
  archiveIntakeBtn.style.fontSize = "1em";
  archiveIntakeBtn.style.fontFamily = "monospace";
  archiveIntakeBtn.style.background = "#224466";
  archiveIntakeBtn.style.color = "#fff";
  archiveIntakeBtn.style.border = "2px solid #3399ff";
  archiveIntakeBtn.style.borderRadius = "8px";
  archiveIntakeBtn.style.cursor = "pointer";
  archiveIntakeBtn.style.transition = "all 0.3s ease";

  archiveIntakeBtn.addEventListener("click", () => {
    const parsed = window.NeuralDataIntake?.getParsedReports();
    if (!parsed || parsed.length === 0) {
      alert("âš  No parsed intake data available.");
      return;
    }

    const archiveBlob = new Blob([JSON.stringify(parsed, null, 2)], { type: "application/json" });
    const archiveUrl = URL.createObjectURL(archiveBlob);
    const link = document.createElement("a");
    link.href = archiveUrl;
    link.download = `NeuralSession_${new Date().toISOString().replace(/[:.]/g,'-')}.json`;
    link.click();
    URL.revokeObjectURL(archiveUrl);

    console.log("ğŸ“¦ Neural Session archived successfully.");
  });

  const operatorTools = document.getElementById("operatorTools");
  if (operatorTools) {
    operatorTools.appendChild(archiveIntakeBtn);
  }
});
</script>

<!-- Phase 201.6 â€” Neural Session Replay Engine -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const replayFileInput = document.createElement("input");
  replayFileInput.type = "file";
  replayFileInput.accept = ".json";
  replayFileInput.style.display = "none";
  document.body.appendChild(replayFileInput);

  const replayBtn = document.createElement("button");
  replayBtn.textContent = "ğŸ”„ Replay Neural Session";
  replayBtn.style.padding = "12px 18px";
  replayBtn.style.fontSize = "1em";
  replayBtn.style.fontFamily = "monospace";
  replayBtn.style.background = "#333300";
  replayBtn.style.color = "#fff";
  replayBtn.style.border = "2px solid #cccc00";
  replayBtn.style.borderRadius = "8px";
  replayBtn.style.cursor = "pointer";
  replayBtn.style.transition = "all 0.3s ease";

  replayBtn.addEventListener("click", () => replayFileInput.click());

  replayFileInput.addEventListener("change", (e) => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(event) {
      try {
        const replayData = JSON.parse(event.target.result);
        if (!Array.isArray(replayData) || replayData.length === 0) {
          alert("Invalid neural session file.");
          return;
        }

        // Replay into Cortex Forecast Memory
        replayData.forEach(row => {
          const forecastEntry = {
            timestamp: new Date().toISOString(),
            itemNumber: row.itemNumber,
            division: row.division,
            onHandUnits: row.onHandUnits,
            cycleCountUnits: row.cycleCountUnits,
            shrinkUnits: row.shrinkUnits,
            itdSalesUnits: row.itdSalesUnits,
            stabilityHint: (row.shrinkUnits > 0 || row.cycleCountUnits !== 0) ? "Volatile" : "Stable"
          };

          if (typeof window.NeuralForecastMemoryCortex?.injectForecastRecord === "function") {
            window.NeuralForecastMemoryCortex.injectForecastRecord(forecastEntry);
          }
        });

        alert(`âœ… Neural session replay complete: ${replayData.length} records re-injected.`);
        console.log("ğŸ”„ Neural Session Replay Injected:", replayData);
      } catch (err) {
        console.error("âŒ Failed to replay neural session:", err);
        alert("Error loading neural session file.");
      }
    };
    reader.readAsText(file);
  });

  const operatorTools = document.getElementById("operatorTools");
  if (operatorTools) {
    operatorTools.appendChild(replayBtn);
  }
});
</script>

<!-- Phase 201.7 â€” Neural Intake Growth Visualizer -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const growthBtn = document.createElement("button");
  growthBtn.textContent = "ğŸ“Š View Neural Growth";
  growthBtn.style.padding = "12px 18px";
  growthBtn.style.fontSize = "1em";
  growthBtn.style.fontFamily = "monospace";
  growthBtn.style.background = "#004422";
  growthBtn.style.color = "#fff";
  growthBtn.style.border = "2px solid #33cc66";
  growthBtn.style.borderRadius = "8px";
  growthBtn.style.cursor = "pointer";
  growthBtn.style.transition = "all 0.3s ease";

  growthBtn.addEventListener("click", () => {
    const parsed = window.NeuralDataIntake?.getParsedReports();
    const cortex = window.NeuralForecastMemoryCortex?.getForecastHistory?.();
    const sessionTotal = parsed?.length || 0;
    const cortexTotal = cortex?.length || 0;

    let message = `ğŸ§  Neural Growth Stats:\n\n`;
    message += `Current Intake Session: ${sessionTotal} rows\n`;
    message += `Forecast Cortex Memory: ${cortexTotal} forecast records\n`;
    message += `\nCortex Stability: ${cortexTotal > 0 ? "ACTIVE" : "IDLE"}`;

    alert(message);
  });

  const operatorTools = document.getElementById("operatorTools");
  if (operatorTools) {
    operatorTools.appendChild(growthBtn);
  }
});
</script>


<!-- Phase 201.8 â€” Neural Stability Advisor Engine -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const stabilityBtn = document.createElement("button");
  stabilityBtn.textContent = "âš–ï¸ Neural Stability Check";
  stabilityBtn.style.padding = "12px 18px";
  stabilityBtn.style.fontSize = "1em";
  stabilityBtn.style.fontFamily = "monospace";
  stabilityBtn.style.background = "#330066";
  stabilityBtn.style.color = "#fff";
  stabilityBtn.style.border = "2px solid #cc66ff";
  stabilityBtn.style.borderRadius = "8px";
  stabilityBtn.style.cursor = "pointer";
  stabilityBtn.style.transition = "all 0.3s ease";

  stabilityBtn.addEventListener("click", () => {
    const cortex = window.NeuralForecastMemoryCortex?.getForecastHistory?.();
    if (!cortex || cortex.length === 0) {
      alert("âš  Cortex memory is empty.");
      return;
    }

    let total = cortex.length;
    let stable = cortex.filter(f => f.stabilityHint === "Stable").length;
    let volatile = total - stable;
    let volatilityRate = ((volatile / total) * 100).toFixed(1);

    let message = `ğŸ§  Neural Stability Check:\n\n`;
    message += `Total Forecast Records: ${total}\n`;
    message += `Stable Records: ${stable}\n`;
    message += `Volatile Records: ${volatile}\n`;
    message += `Volatility Rate: ${volatilityRate}%\n\n`;

    if (volatilityRate > 30) {
      message += "âš  High volatility detected.\nConsider deeper review or fresh session ingestion.";
    } else if (volatilityRate > 15) {
      message += "ğŸŒ€ Moderate volatility detected.\nMonitor closely.";
    } else {
      message += "âœ… Cortex stability is strong and healthy.";
    }

    alert(message);
  });

  const operatorTools = document.getElementById("operatorTools");
  if (operatorTools) {
    operatorTools.appendChild(stabilityBtn);
  }
});
</script>


<!-- Phase 201.9 â€” Predictive Health Composite Index -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const healthIndexBtn = document.createElement("button");
  healthIndexBtn.textContent = "ğŸ“Š Predictive Health Index";
  healthIndexBtn.style.padding = "12px 18px";
  healthIndexBtn.style.fontSize = "1em";
  healthIndexBtn.style.fontFamily = "monospace";
  healthIndexBtn.style.background = "#661111";
  healthIndexBtn.style.color = "#fff";
  healthIndexBtn.style.border = "2px solid #ff4444";
  healthIndexBtn.style.borderRadius = "8px";
  healthIndexBtn.style.cursor = "pointer";
  healthIndexBtn.style.transition = "all 0.3s ease";

  healthIndexBtn.addEventListener("click", () => {
    const cortex = window.NeuralForecastMemoryCortex?.getForecastHistory?.() || [];
    const parsed = window.NeuralDataIntake?.getParsedReports() || [];
    const volatility = cortex.filter(f => f.stabilityHint === "Volatile").length;
    const stable = cortex.length - volatility;
    const total = cortex.length;

    const stabilityScore = total > 0 ? (stable / total) * 100 : 0;
    const dataVolumeScore = Math.min((parsed.length / 1000) * 100, 100);
    const volatilityPenalty = Math.min((volatility / total) * 100, 100);
    const compositeScore = Math.max(Math.min(((stabilityScore * 0.6) + (dataVolumeScore * 0.3) - (volatilityPenalty * 0.1)), 100), 0).toFixed(1);

    let message = `ğŸ§® Predictive Health Composite Index\n\n`;
    message += `Total Forecast Records: ${total}\n`;
    message += `Stable: ${stable}, Volatile: ${volatility}\n`;
    message += `Intake Records: ${parsed.length}\n\n`;
    message += `ğŸ“Š Composite Health Index: ${compositeScore}%\n`;

    if (compositeScore >= 90) {
      message += "âœ… Excellent System Integrity.";
    } else if (compositeScore >= 70) {
      message += "ğŸŒ€ Acceptable, some volatility present.";
    } else {
      message += "âš ï¸ Degraded â€” consider retraining intake sessions.";
    }

    alert(message);
  });

  const operatorTools = document.getElementById("operatorTools");
  if (operatorTools) {
    operatorTools.appendChild(healthIndexBtn);
  }
});
</script>

<!-- Phase 201.10 â€” Live Intake Sync Injector -->
<script>
// Phase 201.10 â€” Live Intake Sync Injector
document.addEventListener("DOMContentLoaded", () => {
  const scanInput = document.getElementById("scanInput");
  const liveQty = document.getElementById("liveQty");
  const categorySelect = document.getElementById("categorySelect");
  const addLiveItemBtn = document.getElementById("addLiveItem");

  if (addLiveItemBtn) {
    addLiveItemBtn.addEventListener("click", () => {
      const itemNumber = scanInput ? scanInput.value.trim() : "";
      const qty = liveQty ? parseInt(liveQty.value) : NaN;
      const category = categorySelect ? categorySelect.value : "";

      if (!itemNumber || isNaN(qty) || qty <= 0) {
        alert("Please enter valid item and quantity.");
        return;
      }

      // Phase 630.0 â€” Risk & Anomaly Signal Injection
      const forecastEntry = {
        timestamp: new Date().toISOString(),
        itemNumber: itemNumber,
        division: category,
        onHandUnits: qty,
        cycleCountUnits: 0,
        shrinkUnits: 0,
        itdSalesUnits: 0,
        stabilityHint: "Stable",
        riskSignal: "ğŸŸ¢ Stable",
        anomalySignal: "âšª Unanalyzed"
      };

      if (typeof window.NeuralForecastMemoryCortex?.injectForecastRecord === "function") {
        window.NeuralForecastMemoryCortex.injectForecastRecord(forecastEntry);
      }

      if (window.NeuralVisualSync?.refreshLiveTableFromCortex) {
        window.NeuralVisualSync.refreshLiveTableFromCortex();
      }

      if (scanInput) {
        scanInput.value = "";
        scanInput.focus();
      }
    });
  }
});
</script>

<!-- Phase 630.1 â€” Neural Anomaly Analyzer Engine -->
<script>
// Phase 630.1 â€” Neural Anomaly Analyzer Engine
document.addEventListener("DOMContentLoaded", () => {
  if (typeof window.NeuralForecastMemoryCortex?.addInjectionHook === "function") {
    window.NeuralForecastMemoryCortex.addInjectionHook(() => {
      const cortex = window.NeuralForecastMemoryCortex?.getForecastHistory?.() || [];
      if (cortex.length === 0) return;

      // Calculate category frequency map
      const categoryCounts = {};
      cortex.forEach(f => {
        categoryCounts[f.division] = (categoryCounts[f.division] || 0) + 1;
      });

      // Apply anomaly signals based on category dominance
      cortex.forEach(f => {
        const total = cortex.length;
        const categoryFreq = categoryCounts[f.division] || 0;
        if (categoryFreq > (total * 0.5)) {
          f.anomalySignal = "ğŸŸ  Anomaly: Category Surge";
        } else {
          f.anomalySignal = "ğŸŸ¢ No Anomaly";
        }
      });
    });
  }
});
</script>

<!-- Modal for unknown item prompt -->
  <div id="customModal" role="dialog" aria-modal="true" aria-labelledby="modalPromptText" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);display:none;justify-content:center;align-items:center;z-index:10000;">
    <div style="background:#1e1e1e;padding:20px;border-radius:8px;color:white;max-width:90%;text-align:center;">
      <h3 id="modalPromptText"></h3>
      <div style="margin-top:15px;">
        <button id="modalBtnLocation" role="button" aria-label="Set as Bay Location" style="margin:5px;">ğŸ“ Bay Location</button>
        <button id="modalBtnProduct" role="button" aria-label="Set as Product" style="margin:5px;">ğŸ“¦ Product</button>
        <button id="modalBtnESL" role="button" aria-label="Set as ESL Tag" style="margin:5px;">ğŸ·ï¸ ESL Tag</button>
        <button id="modalBtnCancel" role="button" aria-label="Cancel modal" style="margin:5px;">âŒ Cancel</button>
      </div>
    </div>
  </div>

<!-- Phase 201.11 â€” Modal Completion Sync Injector -->
<!-- Phase 201.13 â€” Unified Modal Completion Sync Injector -->
<script>
// Unified Cortex-only Modal Completion Sync Injector
document.addEventListener("DOMContentLoaded", () => {
  const scanInput = document.getElementById("scanInput");
  const liveQty = document.getElementById("liveQty");
  const categorySelect = document.getElementById("categorySelect");

  function handleModalComplete(itemNumber, category, qty = 1) {
    // Phase 630.0 â€” Risk & Anomaly Signal Injection
    const forecastEntry = {
      timestamp: new Date().toISOString(),
      itemNumber: itemNumber,
      division: category,
      onHandUnits: qty,
      cycleCountUnits: 0,
      shrinkUnits: 0,
      itdSalesUnits: 0,
      stabilityHint: "Stable",
      riskSignal: "ğŸŸ¢ Stable",
      anomalySignal: "âšª Unanalyzed"
    };

    if (typeof window.NeuralForecastMemoryCortex?.injectForecastRecord === "function") {
      window.NeuralForecastMemoryCortex.injectForecastRecord(forecastEntry);
    }

    if (window.NeuralVisualSync?.refreshLiveTableFromCortex) {
      window.NeuralVisualSync.refreshLiveTableFromCortex();
    }

    if (scanInput) {
      scanInput.value = "";
      scanInput.focus();
    }
  }

  // Attach modal buttons once for all modes:
  const bindModalButton = (btnId) => {
    const button = document.getElementById(btnId);
    if (button) {
      button.addEventListener("click", () => {
        const itemNumber = prompt("Enter Lowe's Item #");
        const qty = liveQty ? parseInt(liveQty.value) : 1;
        const category = categorySelect ? categorySelect.value : "";
        if (!itemNumber) return;
        handleModalComplete(itemNumber, category, qty);
      });
    }
  };

  bindModalButton("modalBtnProduct");
  bindModalButton("modalBtnESL");
  bindModalButton("modalBtnLocation");
});
</script>

  <!-- Trend Modal -->
  <div id="trendsModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.8); z-index:10000; justify-content:center; align-items:center;">
    <div style="background:#fff; padding:20px; border-radius:8px; max-width:90%; max-height:80%; overflow:auto;">
      <h3 style="text-align:center;">ğŸ“ˆ Inventory Trends</h3>
      <canvas id="trendChart" width="400" height="250"></canvas>
      <div style="text-align:center; margin-top:15px;">
        <button id="closeTrendsBtn">âŒ Close</button>
      </div>
    </div>
  </div>



  <!-- ğŸ§™â€â™‚ï¸ Sage Terminal Console -->
  <div id="sageTerminal" class="holo-console console-active sage-terminal">
    <div class="crystal-frame">
      <div class="sage-glow"></div>
      <div class="sage-output" id="sageOutputDisplay">
        <!-- The Sage whispers will appear here -->
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const terminal = document.getElementById("sovereignTerminal");
      const input = document.getElementById("terminalInput");
      const output = document.getElementById("terminalOutput");

      if (terminal && input && output) {
        input.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            const cmd = input.value.trim();
            if (!cmd) return;
            output.textContent += `\n> ${cmd}`;
            let response = "";

            switch (cmd.toLowerCase()) {
              case "help":
                response = "Available commands: help, status, clear, credits, secret";
                break;
              case "status":
                response = "All systems operational. No anomalies detected.";
                break;
              case "clear":
                output.textContent = ":: Console cleared.";
                input.value = "";
                return;
              case "credits":
                response = "Sovereign Codex Framework â€” Created by Tyson & Sage";
                break;
              case "secret":
                response = "ğŸ”® You have awakened a deeper thread...";
                break;
              default:
                response = "Unknown command. Type 'help' for options.";
            }

            output.textContent += `\n${response}`;
            input.value = "";
            output.scrollTop = output.scrollHeight;
          }
        });
      }
    });
  </script>


  
  <script>
  document.addEventListener("DOMContentLoaded", () => {
    console.log("ğŸ§  Orbit wiring script loaded");
    setTimeout(() => {
      const orbitButtons = document.querySelectorAll(".orbit-btn");
      console.log("ğŸ§© Found orbit buttons:", orbitButtons.length);

      orbitButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          const targetId = btn.getAttribute("data-target");
          const target = document.getElementById(targetId);
          if (!target) return;

          const isActive = target.classList.contains("console-active");

          // Hide all panels and deactivate all orbit buttons
          document.querySelectorAll(".holo-console").forEach(panel => {
            panel.classList.remove("console-active");
          });
          document.querySelectorAll(".orbit-btn").forEach(b => b.classList.remove("active-orbit"));

          if (!isActive) {
            // Only activate if it wasnâ€™t already active
            target.classList.add("console-active");
            btn.classList.add("active-orbit");
          }
        });
      });
    }, 0);
  });
  </script>

  <script>
  // Dynamic Version Extractor
  (function() {
    try {
      const scripts = document.querySelectorAll('script[src]');
      let found = null;
      scripts.forEach(script => {
        if (script.src.includes('index.js?v=')) {
          const version = script.src.split('v=')[1];
          found = version;
        }
      });
      const versionInfoEl = document.getElementById('versionInfo');
      if (versionInfoEl) {
        versionInfoEl.innerText = found || "v? (not detected)";
      }
    } catch {
      const versionInfoEl = document.getElementById('versionInfo');
      if (versionInfoEl) {
        versionInfoEl.innerText = "v? (error)";
      }
    }
  })();
  </script>


  <!-- Phase 130.1 â€” Control Tower Modals -->

  <!-- Diagnostics Modal -->
  <div id="diagnosticsModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="diagnosticsTitle" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);display:none;justify-content:center;align-items:center;z-index:10000;">
    <div style="background:#1e1e1e;padding:20px;border-radius:8px;color:white;max-width:90%;max-height:80%;overflow:auto;">
      <h3 id="diagnosticsTitle">ğŸ“Š Diagnostics Panel</h3>
      <div id="diagnosticsContent" style="margin-top:15px;">
        <!-- Future diagnostics data will be injected here -->
      </div>
      <div style="text-align:center;margin-top:15px;">
        <button id="closeDiagnosticsBtn">âŒ Close</button>
      </div>
    </div>
  </div>

  <!-- Resolver Modal -->
  <div id="resolverModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="resolverTitle" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);display:none;justify-content:center;align-items:center;z-index:10000;">
    <div style="background:#1e1e1e;padding:20px;border-radius:8px;color:white;max-width:90%;max-height:80%;overflow:auto;">
      <h3 id="resolverTitle">ğŸ§® Resolver Engine</h3>
      <div id="resolverContent" style="margin-top:15px;">
        <!-- Future resolver data will be injected here -->
      </div>
      
      <div id="threatMatrixContent" style="margin-top: 25px; padding: 15px; background: #222; border: 1px solid #555; border-radius: 5px; font-family: monospace; font-size: 0.95em; color: #fff;">
        <!-- Threat matrix summary will be injected here -->
      </div>
      
      <div style="text-align:center;margin-top:15px;">
        <button id="closeResolverBtn">âŒ Close</button>
      </div>
    </div>
  </div>

  <!-- Dropbox Modal -->
  <div id="dropboxModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="dropboxTitle" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);display:none;justify-content:center;align-items:center;z-index:10000;">
    <div style="background:#1e1e1e;padding:20px;border-radius:8px;color:white;max-width:90%;max-height:80%;overflow:auto;">
      <h3 id="dropboxTitle">â˜ï¸ Dropbox Control</h3>
      <div id="dropboxContent" style="margin-top:15px;">
        <!-- Future dropbox status data will be injected here -->
      </div>
      <div style="text-align:center;margin-top:15px;">
        <button id="closeDropboxBtn">âŒ Close</button>
      </div>
    </div>
  </div>

  <!-- Dev Tools Modal -->
  <div id="devToolsModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="devToolsTitle" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);display:none;justify-content:center;align-items:center;z-index:10000;">
    <div style="background:#1e1e1e;padding:20px;border-radius:8px;color:white;max-width:90%;max-height:80%;overflow:auto;">
      <h3 id="devToolsTitle">ğŸ§ª Developer Tools</h3>
      <div id="devToolsContent" style="margin-top:15px;">
        <!-- Future developer tools UI will be injected here -->
      </div>
      <div style="text-align:center;margin-top:15px;">
        <button id="closeDevToolsBtn">âŒ Close</button>
      </div>
    </div>
  </div>

  <!-- Toast container -->
  <div id="toastContainer" class="toast-container" aria-live="polite" aria-atomic="true" style="position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 9999; display: flex; flex-direction: column; align-items: center;"></div>

  <!-- Edit Item Modal -->
  <div id="editModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="editItemTitle" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);display:none;justify-content:center;align-items:center;z-index:10000;">
    <div style="background:#1e1e1e;padding:20px;border-radius:8px;color:white;max-width:90%;text-align:center;">
      <h3 id="editItemTitle">âœï¸ Edit Item</h3>

      <label for="editItemNumber">Item Number:</label>
      <input type="text" id="editItemNumber" style="margin: 5px 0;" />

      <label for="editScanCode">Scan Code:</label>
      <input type="text" id="editScanCode" style="margin: 5px 0;" />

      <label for="editScanType">Type:</label>
      <select id="editScanType" style="margin: 5px 0;">
        <option value="product">Product</option>
        <option value="esl">ESL</option>
        <option value="bay">Bay</option>
      </select>

      <label for="editScanValue">Mapped Value:</label>
      <input type="text" id="editScanValue" style="margin: 5px 0;" />

      <label for="editItemQty">Quantity:</label>
      <input type="number" id="editItemQty" min="1" style="margin: 5px 0;" />

      <label for="editItemCategory">Category:</label>
      <select id="editItemCategory" style="margin: 5px 0;">
        <option value="Laundry">Laundry</option>
        <option value="Fridges & Freezers">Fridges & Freezers</option>
        <option value="Ranges">Ranges</option>
        <option value="Dishwashers">Dishwashers</option>
        <option value="Wall Ovens">Wall Ovens</option>
        <option value="Cooktops">Cooktops</option>
        <option value="OTR Microwaves">OTR Microwaves</option>
        <option value="Microwaves (Countertop)">Microwaves (Countertop)</option>
        <option value="Vent Hoods">Vent Hoods</option>
        <option value="Beverage & Wine Coolers">Beverage & Wine Coolers</option>
        <option value="Cabinets">Cabinets</option>
        <option value="Countertops">Countertops</option>
        <option value="Interior Doors">Interior Doors</option>
        <option value="Exterior Doors">Exterior Doors</option>
        <option value="Storm Doors">Storm Doors</option>
        <option value="Windows">Windows</option>
        <option value="Commodity Moulding">Commodity Moulding</option>
        <option value="Other / Misc">Other / Misc</option>
      </select>

      <div style="margin-top:15px;">
        <button id="confirmEditBtn" role="button" aria-label="Save edits to item" style="margin:5px;">âœ… Save</button>
        <button id="cancelEditBtn" role="button" aria-label="Cancel edit modal" style="margin:5px;">âŒ Cancel</button>
      </div>
    </div>
  </div>

  <!-- Summary Modal -->
  <div id="summaryModal" class="modal hidden summary-modal" role="dialog" aria-modal="true" aria-labelledby="summaryTitle" style="display:none;">
    <div style="background:#1e1e1e;padding:20px;border-radius:8px;color:white;max-width:90%;max-height:80%;overflow:auto;">
      <h3 id="summaryTitle" style="text-align:center;">ğŸ“‹ Bay Audit Summary</h3>
      <div id="summaryContent" style="margin-top:15px; font-size: 0.95em;">
        <!-- Summary data will be injected here -->
      </div>
      <div style="text-align:center; margin-top:15px;">
        <button id="closeSummaryBtn" role="button" aria-label="Close summary modal" style="margin:5px;">âœ… Done</button>
      </div>
    </div>
  </div>

  <!-- Add Item Modal -->
  <div id="addItemModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="addItemTitle" aria-hidden="false" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);display:none;justify-content:center;align-items:center;z-index:10000;">
    <div style="background:#1e1e1e;padding:20px;border-radius:8px;color:white;max-width:90%;text-align:center;">
      <h3 id="addItemTitle">â• Add New Item</h3>

      <label for="newItemCode">Item Number:</label>
      <input type="tel" id="newItemCode" placeholder="Enter item number..." style="margin: 5px 0;" />

      <label for="newItemQty">Quantity:</label>
      <input type="number" id="newItemQty" min="1" value="1" inputmode="numeric" style="margin: 5px 0;" />

      <label for="newItemCategory">Category:</label>
      <select id="newItemCategory" style="margin: 5px 0;">
        <option value="Laundry">Laundry</option>
        <option value="Fridges & Freezers">Fridges & Freezers</option>
        <option value="Ranges">Ranges</option>
        <option value="Dishwashers">Dishwashers</option>
        <option value="Wall Ovens">Wall Ovens</option>
        <option value="Cooktops">Cooktops</option>
        <option value="OTR Microwaves">OTR Microwaves</option>
        <option value="Microwaves (Countertop)">Microwaves (Countertop)</option>
        <option value="Vent Hoods">Vent Hoods</option>
        <option value="Beverage & Wine Coolers">Beverage & Wine Coolers</option>
        <option value="Cabinets">Cabinets</option>
        <option value="Countertops">Countertops</option>
        <option value="Interior Doors">Interior Doors</option>
        <option value="Exterior Doors">Exterior Doors</option>
        <option value="Storm Doors">Storm Doors</option>
        <option value="Windows">Windows</option>
        <option value="Commodity Moulding">Commodity Moulding</option>
        <option value="Other / Misc">Other / Misc</option>
      </select>

      <div style="margin-top:15px;">
        <button id="confirmAddItemBtn" role="button" aria-label="Confirm new item" style="margin:5px;">âœ… Add</button>
        <button id="cancelAddItemBtn" role="button" aria-label="Cancel add item modal" style="margin:5px;">âŒ Cancel</button>
      </div>
    </div>
  </div>

  <!-- Item Link Modal -->
  <div id="itemLinkModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="itemLinkModalTitle" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);display:none;justify-content:center;align-items:center;z-index:10000;">
    <div style="background:#1e1e1e;padding:20px;border-radius:8px;color:white;max-width:90%;text-align:center;">
      <h3 id="itemLinkModalTitle">ğŸ”— Link Lowe's Item to UPC</h3>

      <label for="itemNumberInput">Lowe's Item #:</label>
      <input type="text" id="itemNumberInput" style="margin: 5px 0;" placeholder="Enter Lowe's item number..." />

      <label for="linkedUpcInput">Linked UPC:</label>
      <input type="text" id="linkedUpcInput" style="margin: 5px 0;" placeholder="Enter UPC code..." />

      <div style="margin-top:15px;">
        <button id="confirmLinkBtn" role="button" aria-label="Save item link" style="margin:5px;">âœ… Save Link</button>
        <button id="cancelLinkBtn" role="button" aria-label="Cancel link modal" style="margin:5px;">âŒ Cancel</button>
      </div>
    </div>
  </div>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- SheetJS (xlsx parser) -->
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

  <script src="scripts/liquidGlass/glassMemory.js"></script>

  <script src="scripts/systems/sovereignAuth.js"></script>


  <!-- ğŸ§  Sovereign Toolbar Forge -->
  <script src="scripts/operator/sovereign/sovereignToolbarRenderer.js"></script>
  <!-- Bootstrap Neural must come before wiring.js -->
  <script src="scripts/bootstrap/bootstrapNeural.js"></script>
  <!-- Bootstrap Loader (must remain, handles dynamic module loading) -->
  <script src="scripts/bootstrap/bootstrapLoader.js"></script>

  <script src="scripts/core/sovereignCodex.js"></script>

  <!-- Core Mesh System & Companions -->
  <script src="scripts/core/signalMesh.js"></script>
  <script src="scripts/core/meshVitals.js"></script>
  <script src="scripts/core/companionMind.js"></script>

  <!-- Companion Modules -->
  <script src="scripts/companions/sage.js"></script>
  <script src="scripts/companions/engineer.js"></script>
  <script src="scripts/companions/archivist.js"></script>

  <!-- Operator Command Console (module) -->
  <script type="module" src="scripts/operator.console.js"></script>

  <!-- Wiring logic loader -->
  <script src="scripts/bootstrap/wiring.js"></script>
  <!-- ğŸ§¼ Live Inventory Panel Force-Hide Patch -->
  <script>
    // Patch: Force-hide #countConsole on DOMContentLoaded for legacy/stray panels
    window.addEventListener("DOMContentLoaded", () => {
      const liveInventoryPanel = document.querySelector("#countConsole");
      if (liveInventoryPanel) {
        liveInventoryPanel.classList.add("hidden");
        liveInventoryPanel.style.display = "none";
        liveInventoryPanel.style.opacity = "0";
        liveInventoryPanel.style.height = "0px";
        liveInventoryPanel.style.margin = "0px";
        liveInventoryPanel.style.padding = "0px";
        liveInventoryPanel.style.position = "absolute";
        console.log("ğŸ§¼ Live Inventory Panel force-hidden on load.");
      } else {
        console.warn("âš ï¸ Could not locate Live Inventory Panel for cleanup.");
      }
    });
  </script>

  <!-- Phase 7000.1 â€” Sovereign Command Bridge Presence Validator -->
  <script>
    // Phase 7000.1 â€” Sovereign Command Bridge Presence Validator
    document.addEventListener("DOMContentLoaded", () => {
      const cb = document.getElementById("neuralCommandBridge");
      if (!cb) {
        console.warn("[SOVEREIGN:BridgeCheck] âš ï¸ Command Bridge not found in DOM. This may indicate a missing bridge injection or early load order issue.");
      } else {
        console.log("[SOVEREIGN:BridgeCheck] âœ… Command Bridge found. Forcing hidden...");
        // Always start hidden; only show when gear icon is clicked
        // cb.style.display = "block";
        cb.style.display = "none";
        cb.style.visibility = "visible";
        cb.style.zIndex = 9999;
      }
    });
  </script>

  <!-- ğŸŒ€ Whisperer Entity Module -->
  <script type="module" src="scripts/entities/theWhisperer.js"></script>

  <!-- ğŸ§  Dock Toggle Bar Panel Runtime Toggle Logic -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const toggleButtons = document.querySelectorAll(".dock-toggle-button");
      toggleButtons.forEach(button => {
        button.addEventListener("click", () => {
          const target = document.querySelector(button.getAttribute("data-target"));
          if (!target) return;

          const allConsoles = document.querySelectorAll(".holo-console");
          allConsoles.forEach(console => {
            if (console !== target) {
              console.classList.add("hidden");
              console.setAttribute("aria-hidden", "true");
            }
          });

          target.classList.toggle("hidden");
          target.setAttribute("aria-hidden", !target.classList.contains("hidden"));
        });
      });
    });
  </script>

<!-- Phase 600.0 â€” Predictive HUD Deep Linkage Bootstrap -->
<script>
// Phase 600.0 â€” Predictive HUD Deep Linkage Bootstrap
document.addEventListener("DOMContentLoaded", () => {
  // Predictive HUD element bindings
  const hudRiskLevel = document.getElementById("riskMetric");
  const hudForecastLevel = document.getElementById("forecastMetric");
  const hudAnomalyStatus = document.getElementById("anomalyMetric");
  const hudDriftStatus = document.getElementById("driftMetric");

  function updatePredictiveHUD() {
    const cortex = window.NeuralForecastMemoryCortex?.getForecastHistory?.() || [];
    const total = cortex.length;

    if (total === 0) {
      if (hudRiskLevel) hudRiskLevel.textContent = "No data";
      if (hudForecastLevel) hudForecastLevel.textContent = "No data";
      if (hudAnomalyStatus) hudAnomalyStatus.textContent = "No data";
      if (hudDriftStatus) hudDriftStatus.textContent = "Idle";
      return;
    }

    const volatility = cortex.filter(f => f.stabilityHint === "Volatile").length;
    const stable = total - volatility;
    const volatilityRate = ((volatility / total) * 100).toFixed(1);
    const uniqueCategories = [...new Set(cortex.map(f => f.division))];

    // Simple Anomaly Detector: if any category occurs unusually often
    const categoryCounts = {};
    cortex.forEach(f => {
      categoryCounts[f.division] = (categoryCounts[f.division] || 0) + 1;
    });
    const maxCategory = Object.values(categoryCounts).reduce((a, b) => Math.max(a, b), 0);
    const anomalyFlag = maxCategory > (total * 0.5) ? "Elevated" : "Nominal";

    // Null checks and field updates
    if (hudRiskLevel) hudRiskLevel.textContent = volatilityRate ? `${volatilityRate}% Volatile` : "Unknown";
    if (hudForecastLevel) hudForecastLevel.textContent = total ? `${total} records` : "Pending";
    if (hudAnomalyStatus) hudAnomalyStatus.textContent = anomalyFlag || "Idle";
    if (hudDriftStatus) hudDriftStatus.textContent = "Sync OK";
  }

  // Initial HUD update on page load
  updatePredictiveHUD();

  // Hook into Cortex injection to refresh HUD after each change
  if (typeof window.NeuralForecastMemoryCortex?.addInjectionHook === "function") {
    window.NeuralForecastMemoryCortex.addInjectionHook(updatePredictiveHUD);
  }
});
</script>
  <div id="commandBridgeToggle" class="command-bridge-toggle" onclick="toggleCommandBridge()" style="bottom: 65px;">âš™ï¸</div>
  <script>
    function toggleCommandBridge() {
      const bridge = document.getElementById('neuralCommandBridge');
      if (!bridge) return;
      const isVisible = bridge.style.display !== 'none';
      bridge.style.display = isVisible ? 'none' : 'block';
    }

    // Optional: Start hidden if needed
    // document.addEventListener("DOMContentLoaded", () => {
    //   const bridge = document.getElementById('neuralCommandBridge');
    //   if (bridge) bridge.style.display = 'none';
    // });
  </script>

<!-- ğŸ§­ HUD Toggle Button -->
<div id="brainDockButton" class="hud-toggle-icon" onclick="toggleHudPanel()">ğŸ§­</div>
  <style>
    .command-bridge-toggle {
      position: fixed;
      bottom: 15px;
      left: 15px;
      z-index: 9999;
      cursor: pointer;
      background: radial-gradient(circle, #2a003f 40%, #000 90%);
      color: #00ffcc;
      padding: 10px 12px;
      border-radius: 50%;
      border: 2px solid #00ffcc;
      box-shadow: 0 0 12px #00ffcc, 0 0 18px #00ffcc inset;
      font-size: 1.3rem;
      transition: all 0.3s ease;
    }
    .hud-toggle-icon {
      position: fixed;
      bottom: 15px;
      right: 15px;
      z-index: 9999;
      cursor: pointer;
      background: radial-gradient(circle, #2a003f 40%, #000 90%);
      color: #cc66ff;
      padding: 10px 12px;
      border-radius: 50%;
      border: 2px solid #cc66ff;
      box-shadow: 0 0 12px #cc66ff, 0 0 18px #cc66ff inset;
      font-size: 1.3rem;
      transition: all 0.3s ease;
    }
  </style>

<!-- Phase 200.7 â€” Predictive HUD Isolation Container -->
<div id="brainDockHudPanel" style="
    position: fixed;
    bottom: 90px;
    right: 20px;
    background: linear-gradient(145deg, #1b1b2f, #2a003f);
    border: 2px solid #cc66ff;
    border-radius: 12px;
    padding: 14px 18px;
    box-shadow: 0 0 20px rgba(204, 102, 255, 0.7), inset 0 0 8px rgba(204, 102, 255, 0.5);
    font-family: monospace;
    color: #fff;
    z-index: 10000;
    width: 280px;
    transition: transform 0.3s ease, opacity 0.3s ease;
    display: none;
">
  <h3 style="margin:0 0 12px 0; color:#cc66ff;">ğŸ§­ Predictive HUD</h3>
  <div class="hud-metrics">
    <div class="hud-stat"><span class="label">ğŸ§  RISK</span> <span id="riskMetric">No Data</span></div>
    <div class="hud-stat"><span class="label">ğŸ“ˆ FORECAST</span> <span id="forecastMetric">No Data</span></div>
    <div class="hud-stat"><span class="label">â˜¢ï¸ ANOMALIES</span> <span id="anomalyMetric">No Data</span></div>
    <div class="hud-stat"><span class="label">ğŸŒ€ DRIFT</span> <span id="driftMetric">Idle</span></div>
  </div>
  <!-- Live HUD feed for displaying live data updates -->
  <div id="brainHudLiveFeed" class="hud-feed-text" style="margin-top:18px; text-align:center; font-size:1.05em; color:#cc99ff;">Initializing...</div>
</div>

<!-- ğŸ§­ HUD Visibility Toggle Logic -->
<script>
  function toggleHudPanel() {
    const hud = document.getElementById("brainDockHudPanel");
    if (!hud) return;
    const isVisible = hud.style.display !== 'none';
    hud.style.display = isVisible ? 'none' : 'block';
  }
</script>
</div>

<!-- Phase 900.1 â€” Sovereign Console Module: Tools -->
<div id="sovereignConsole-tools" class="sovereign-console-panel" style="
  display: none;
  background: #1b1b2f;
  border: 2px solid #9933ff;
  border-radius: 12px;
  padding: 20px;
  color: #fff;
  font-family: monospace;
  max-width: 90%;
  margin: 20px auto;
  box-shadow: 0 0 15px rgba(153, 51, 255, 0.8);
">
  <h3 style="margin-top: 0; color: #cc66ff;">ğŸ›  Tools Console</h3>
  <p>This is the dedicated Sovereign Console for Tools operations.</p>
  <button onclick="alert('ğŸ”§ Tool A Activated')">Run Tool A</button>
  <button onclick="alert('ğŸ”© Tool B Activated')">Run Tool B</button>
</div>

  <!-- Phase 900.2 â€” Sovereign Console Module: Forecast -->
<div id="sovereignConsole-forecast" class="sovereign-console-panel hidden" style="
  display: none;
  background: #1b1b2f;
  border: 2px solid #9933ff;
  border-radius: 12px;
  padding: 20px;
  color: #fff;
  font-family: monospace;
  max-width: 90%;
  margin: 20px auto;
  box-shadow: 0 0 15px rgba(153, 51, 255, 0.8);
">
  <div class="console-header" style="display: flex; align-items: center; justify-content: space-between;">
    <h2 style="margin: 0; color: #cc66ff;">ğŸ§  Forecast Console</h2>
    <button class="console-close" style="font-size: 1.2em; background: none; border: none; color: #fff; cursor: pointer;" onclick="SovereignToolbarRenderer.toggleConsole('forecast')">âœ–</button>
  </div>
  <div class="console-body" style="margin-top: 20px;">
    <p>Welcome to the Forecast Console. Here you will find predictive diagnostics and anomaly visualizations.</p>
    <ul class="console-feature-list" style="list-style: none; padding-left: 0; margin-top: 15px;">
      <li style="margin-bottom: 8px;">ğŸ“Š Drift Sentinels</li>
      <li style="margin-bottom: 8px;">ğŸŒ€ Predictive Cortex</li>
      <li style="margin-bottom: 8px;">ğŸ§¬ Recursive Memory Mapper</li>
      <li style="margin-bottom: 8px;">ğŸ”® Adaptive Confidence Overlay</li>
    </ul>
  </div>
</div>



<!-- Phase 200.13 â€” Forecast Drift Visualizer -->
<div id="forecastDriftModal" style="
  display:none; position:fixed; top:0; left:0; width:100vw; height:100vh;
  background:rgba(0,0,0,0.85); z-index:10001; justify-content:center; align-items:center;
">
  <div style="
    background:#1e1e2f; padding:20px; border-radius:12px;
    max-width:90%; max-height:80%; overflow:auto;
    box-shadow:0 0 20px rgba(153, 51, 255, 0.9);
  ">
    <h3 style="text-align:center; color:#cc66ff;">ğŸ“ˆ Forecast Drift Visualizer</h3>
    <canvas id="forecastDriftChart" width="400" height="250"></canvas>
    <div style="text-align:center; margin-top:15px;">
      <button id="closeDriftChartBtn">âŒ Close</button>
    </div>
  </div>
</div>
<script>
const predictiveHud = document.getElementById("brainDockHudPanel");
const brainDockBtn = document.getElementById("brainDockButton");

if (predictiveHud && brainDockBtn) {
  let hudVisible = false;

  brainDockBtn.addEventListener("click", () => {
    hudVisible = !hudVisible;
    predictiveHud.style.display = hudVisible ? "block" : "none";
  });
}
</script>

<!-- Forecast Drift Visualizer Logic -->
<script>
// Forecast Drift Visualizer Logic
document.addEventListener("DOMContentLoaded", () => {
  const driftModal = document.getElementById("forecastDriftModal");
  const closeDriftBtn = document.getElementById("closeDriftChartBtn");

  closeDriftBtn.addEventListener("click", () => {
    driftModal.style.display = "none";
  });

  window.renderForecastDriftChart = () => {
    driftModal.style.display = "flex";

    const ctx = document.getElementById("forecastDriftChart").getContext("2d");
    const cortex = window.NeuralForecastMemoryCortex?.getForecastHistory?.() || [];

    const labels = cortex.map(f => f.timestamp.slice(11, 19));
    const states = cortex.map(f => {
      if (f.state && f.state.match(/Stable/i)) return 1;
      if (f.state && f.state.match(/Volatile|Surge|Regression/i)) return -1;
      return 0;
    });

    new Chart(ctx, {
      type: "line",
      data: {
        labels: labels,
        datasets: [{
          label: "Stability",
          data: states,
          fill: false,
          borderColor: "#cc66ff",
          tension: 0.3,
          pointRadius: 3
        }]
      },
      options: {
        scales: {
          y: {
            min: -1.5,
            max: 1.5,
            ticks: { stepSize: 1 }
          }
        }
      }
    });
  };
});
</script>
  <!-- DOM Sync Audit Utility -->
  <!-- <script type="module">

  </script> -->
  </div>


  <!-- Phase 135.4 â€” Forecast Overlay Containers Injection -->
  <div id="forecastSignalsContainer" style="display:none;"></div>
  <div id="anomalySignalsContainer" style="display:none;"></div>
  <div id="driftSignalsContainer" style="display:none;"></div>

  <!-- Developer Diagnostic Panel -->
  <div id="devDashboard" style="position:fixed; bottom:80px; right:20px; background:#111; border:2px solid #ff00ff; border-radius:8px; padding:15px; z-index:99999; box-shadow:0 0 20px #ff00ff; display:none;">
    <h3 style="margin:0 0 10px 0; color:#ff00ff; font-family:monospace;">ğŸ§ª Dev Tools</h3>
    <button id="runFullSystemAuditBtn" style="display:block; margin:5px 0;">Full System Audit</button>
    <button id="runWiringAuditBtn" style="display:block; margin:5px 0;">Wiring Audit</button>
    <button id="runAutoHealingBtn" style="display:block; margin:5px 0;">Auto Healing</button>
  </div>

  <!-- ğŸ§  Phase 16011 â€” Sovereign Operator Access -->
  <div id="operatorLoginTrigger" onclick="toggleLoginPanel()">ğŸ‘¤</div>

<div id="sovereignLoginWrapper" style="display: none;">
  <div id="operatorLoginOverlay" class="sovereign-overlay">
    <div class="login-panel">
      <h2>ğŸ§¬ Sovereign Operator Access</h2>
      <input type="text" id="operatorUsername" placeholder="Operator ID" />
      <input type="password" id="operatorPassword" placeholder="Access Key" />
      <button id="operatorLoginBtn">Authenticate</button>
      <div id="loginFeedback" class="login-feedback"></div>
    </div>
  </div>
</div>

  <!-- ğŸ›¡ï¸ Sovereign Operator Login Overlay -->
  <div id="sovereignLoginOverlay" class="sovereign-login-overlay hidden">
    <div class="login-panel">
      <h2>Sovereign Operator Access</h2>
      <p class="login-subtext">Tier Override Required</p>
      <input type="password" id="sovereignLoginInput" placeholder="Enter Override Key..." />
      <button id="sovereignLoginBtn">Authenticate</button>
      <div id="sovereignLoginFeedback" class="login-feedback"></div>
    </div>
  </div>

  <!-- Orbit Removal Panel Handlers -->
  <!--
  (orbitButtonsBar and its references removed)
  -->
<script>
// Phase 600.1 â€” Unified Sovereign Dock Wiring Linkage
document.addEventListener("DOMContentLoaded", () => {
  const panelMap = {
    count: "countContainer",
    deltaAnalyzer: "deltaAnalyzerSection",
    exceptionManager: "exceptionManagerSection",
    progressDashboard: "progressDashboardSection",
    reportingHub: "reportingHubSection",
    masterExportHub: "masterExportSection",
    utilityHub: "utilityHubSection",
    sessionManager: "sessionManagerSection",
    mappings: "mappingManagerSection",
    tools: "toolsPanel",
    audit: "auditSection",
    configPanel: "configPanelSection"
  };

  // (Removed orbitButtonsBar references. No dockToggleBar present.)
});
</script>

<!-- Phase 900.2 â€” Sovereign Console Toggle Logic -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const buttons = document.querySelectorAll(".sovereign-toolbar-container button[data-panel-id]");
  buttons.forEach(btn => {
    btn.addEventListener("click", () => {
      const panelId = btn.getAttribute("data-panel-id");
      if (!panelId) return;
      document.querySelectorAll(".sovereign-console-panel").forEach(p => p.style.display = "none");
      const targetPanel = document.getElementById(panelId);
      if (targetPanel) targetPanel.style.display = "block";
    });
  });
});
</script>

<!-- Phase 17001 â€” Pulse Monitor JS Logic (live data + refresh binding) -->
<script>
// Phase 17001 â€” Pulse Monitor JS Logic (live data + refresh binding)
document.addEventListener("DOMContentLoaded", () => {
  const statusEl = document.querySelector("#pulseMonitorConsole .pulse-status");
  const heartbeatEl = document.querySelector("#pulseMonitorConsole .last-heartbeat-time");
  const signalLog = document.querySelector("#pulseMonitorConsole .signal-log-entries");
  const reflexLog = document.querySelector("#pulseMonitorConsole .reflex-log-entries");
  const refreshBtn = document.querySelector("#pulseMonitorConsole .refresh-pulse-monitor");

  function updatePulseMonitor() {
    const now = new Date().toLocaleTimeString();
    heartbeatEl.textContent = now;

    const signals = window.SignalMesh?.getRecentSignals?.() || [];
    signalLog.innerHTML = "";
    if (signals.length === 0) {
      const li = document.createElement("li");
      li.textContent = "No recent signals.";
      li.className = "faint";
      signalLog.appendChild(li);
    } else {
      signals.slice(-10).reverse().forEach(sig => {
        const li = document.createElement("li");
        li.textContent = `[${sig.timestamp}] â†’ ${sig.target}`;
        signalLog.appendChild(li);
      });
    }

    const reflexEntries = [];
    for (let key in window.CompanionMesh) {
      const mem = window.CompanionMesh[key]?.memory || [];
      if (mem.length > 0) {
        const last = mem[mem.length - 1];
        reflexEntries.push({ who: key, ...last });
      }
    }

    reflexLog.innerHTML = "";
    if (reflexEntries.length === 0) {
      const li = document.createElement("li");
      li.textContent = "No reflex entries found.";
      li.className = "faint";
      reflexLog.appendChild(li);
    } else {
      reflexEntries.forEach(entry => {
        const li = document.createElement("li");
        li.textContent = `${entry.who}: ${entry.type || "unknown"} â†’ ${entry.entry || JSON.stringify(entry)}`;
        reflexLog.appendChild(li);
      });
    }

    statusEl.textContent = "ğŸŸ¢ Operational";
  }

  if (refreshBtn) {
    refreshBtn.addEventListener("click", updatePulseMonitor);
  }

  // Optional: auto-refresh when opened
  const pulseBtn = document.querySelector('button[data-panel="#pulseMonitorConsole"]');
  if (pulseBtn) {
    pulseBtn.addEventListener("click", () => {
      setTimeout(updatePulseMonitor, 100);
    });
  }
});
</script>
  <!-- <script src="scripts/liquidGlass/scripts/liquidGlass/glassOrbitHandler.js"></script> -->
  <script>
    // ğŸ§® Count Console Counter Logic
    let counter = 0;
    const countDisplay = document.getElementById('countDisplay');

    function updateCounter(amount) {
      counter += amount;
      if (countDisplay) countDisplay.textContent = counter;
    }

    function resetCounter() {
      counter = 0;
      if (countDisplay) countDisplay.textContent = counter;
    }

    // ğŸ“Š Delta Analyzer Logic
    function calculateDelta() {
      const a = parseFloat(document.getElementById('deltaValueA').value);
      const b = parseFloat(document.getElementById('deltaValueB').value);
      const delta = (isNaN(a) || isNaN(b)) ? 'Invalid input' : a - b;
      document.getElementById('deltaResult').textContent = `Î” = ${delta}`;
    }

    function clearDeltaInputs() {
      document.getElementById('deltaValueA').value = '';
      document.getElementById('deltaValueB').value = '';
      document.getElementById('deltaResult').textContent = 'Î” = 0';
    }
  </script>
  <style>
    .delta-result {
      font-size: 2rem;
      margin-top: 1rem;
      color: #f0f;
      text-shadow: 0 0 5px #f0f;
    }

    .delta-controls button {
      margin: 0.3rem;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      background: rgba(255,255,255,0.05);
      border: 1px solid #f0f;
      color: #f0f;
      cursor: pointer;
    }

    .delta-controls button:hover {
      background: rgba(255,0,255,0.1);
    }

    #deltaAnalyzerConsole input {
      margin: 0.3rem 0.5rem;
      padding: 0.4rem;
      width: 120px;
      font-size: 1rem;
    }

    /* === Normalize Holo Console Panels === */
    .holo-console {
      display: none !important;
      visibility: hidden !important;
      opacity: 0 !important;
      height: 0 !important;
      margin: 0 !important;
      padding: 0 !important;
      position: absolute !important;
      z-index: -1 !important;
    }

    .holo-console.console-active {
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
      height: auto !important;
      margin: auto !important;
      padding: 20px !important;
      position: relative !important;
      z-index: 10 !important;
    }
  </style>
  <script>
    function submitReport() {
      const input = document.getElementById('reportInput');
      const log = document.getElementById('reportLog');
      const text = input.value.trim();
      if (text === '') return;

      const timestamp = new Date().toLocaleString();
      const entry = document.createElement('li');
      entry.textContent = `[${timestamp}] ${text}`;
      log.appendChild(entry);
      input.value = '';
    }

    function clearReports() {
      document.getElementById('reportLog').innerHTML = '';
    }
    // Session Manager logic
    function startSession() {
      const input = document.getElementById('sessionNameInput');
      const sessionName = input.value.trim();
      if (!sessionName) return;

      const timestamp = new Date().toLocaleString();
      const display = document.getElementById('activeSessionDisplay');
      display.textContent = `ğŸ“Œ Active Session: "${sessionName}" started at ${timestamp}`;
      input.value = '';
    }

    // Updated closeConsole function with full panel reset and orbit button sync
    function closeConsole(button) {
      const panel = button.closest(".holo-console");
      if (!panel) return;

      // Prevent focus-related aria-hidden issue
      button.blur();

      panel.classList.remove("console-active");
      panel.classList.add("hidden");
      panel.setAttribute("aria-hidden", "true");

      // Reset styling from .console-active override
      panel.style.display = "none";
      panel.style.visibility = "hidden";
      panel.style.opacity = "0";
      panel.style.height = "0px";
      panel.style.margin = "0px";
      panel.style.padding = "0px";
      panel.style.position = "absolute";
      panel.style.zIndex = "-1";

      // Remove active class from any orbit buttons linked to this panel
      const orbitButtons = document.querySelectorAll(`.orbit-btn[data-target="${panel.id}"]`);
      orbitButtons.forEach(btn => btn.classList.remove("active-orbit"));
    }
  </script>
  <style>
    .session-display {
      margin-top: 1rem;
      font-size: 1rem;
      color: #00ffff;
      font-family: monospace;
      text-shadow: 0 0 4px #0ff;
    }

    #sessionNameInput {
      margin: 0.5rem 0.5rem 0.5rem 0;
      padding: 0.4rem;
      width: 200px;
      font-size: 1rem;
    }

    #sessionManagerConsole button {
      padding: 0.5rem 1rem;
      font-size: 1rem;
      background: rgba(0,255,255,0.05);
      border: 1px solid #00ffff;
      color: #00ffff;
      cursor: pointer;
    }

    #sessionManagerConsole button:hover {
      background: rgba(0,255,255,0.1);
    }
  </style>
  <script>
    function closeConsole(button) {
      const panel = button.closest(".holo-console");
      if (panel) {
        panel.setAttribute("aria-hidden", "true");
        panel.style.display = "none";
      }
    }
  </script>
</body>
</html>