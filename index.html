<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- <link rel="stylesheet" href="scripts/styles/sagecraftascendant.css?v=1.0.0"> -->
  <link rel="manifest" href="manifest.json" />
  <!-- <meta name="theme-color" content="#1e1e2f" /> -->
  <!-- iOS PWA Splash and Icon Support -->
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Inventory Auditor">
  <link rel="apple-touch-icon" href="icon/splash-1080x1920.png">

  <!-- iOS Splash Screen (Portrait) -->
  <link rel="apple-touch-startup-image" href="icon/splash-1080x1920.png"
    media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
  <style>
    /* === UI UTILITIES === */
    .sovereign-zone-anchor {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      grid-gap: 16px;
      padding: 16px;
      position: relative;
      z-index: 1;
    }

    .debug-outline {
      outline: 1px dashed magenta;
      background-color: rgba(255, 0, 255, 0.03);
    }

    .console-active-snap {
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
      position: relative !important;
      z-index: 10 !important;
      animation: fadeInSnap 0.3s ease-in;
    }

    @keyframes fadeInSnap {
      from {
        opacity: 0;
        transform: scale(0.98);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }
    .lore-entry {
      opacity: 0;
      transform: rotateX(-90deg);
      animation: pageReveal 0.6s ease-out forwards;
      margin-bottom: 6px;
      padding: 4px 8px;
      background: rgba(255, 255, 255, 0.03);
      border-left: 3px solid #7744dd;
      border-radius: 3px;
    }

    @keyframes pageReveal {
      to {
        opacity: 1;
        transform: rotateX(0);
      }
    }
    /* === Phase 1 Orbit Cluster Optimization: Orbit Panel Styles === */
    .holo-console,
    .dock-panel,
    .panel-content {
      /* Remove any forced white backgrounds set during Phase 1 */
      /* background-color: #fff; */
      /* background: #fff; */
      /* background-color: white; */
      background-color: transparent !important;
      /* Preserve original dark, ethereal theme */
      color: #e2e2e2;
      border: 1px solid #552288;
    }
    /* Optional: For better contrast in dark theme, adjust console-header if needed */
    .console-header {
      background: rgba(34,0,51,0.7);
      color: #ccbbff;
      border-bottom: 1px solid #552288;
    }
  </style>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&display=swap" rel="stylesheet">
  <!-- LiquidGlass styles should be loaded after all other head links -->
 <!-- Base styles -->
<!--link rel="stylesheet" href="scripts/liquidGlass/liquidGlass.css"-->

<!-- Overrides and resets -->
<link rel="stylesheet" href="styles/liquidGlassReset.css">
<link rel="stylesheet" href="styles/sovereignUILayout.css">
<link rel="stylesheet" href="styles/uiGridLayout.css">
<!-- <link rel="stylesheet" href="scripts/styles/debugclarity.css"> -->
  <link rel="stylesheet" href="styles/uiGridRestoration.css" />
</head>
<script>
  // Lock scroll to top briefly on load
  function lockScrollToTop() {
    window.scrollTo(0, 0);
    document.body.style.overflow = 'hidden';
    document.documentElement.style.overflow = 'hidden';
  }

  // Unlock scroll after short delay
  function unlockScroll() {
    document.body.style.overflow = 'auto';
    document.documentElement.style.overflow = 'auto';
  }

  document.addEventListener("DOMContentLoaded", () => {
    lockScrollToTop();
  });

  window.addEventListener("load", () => {
    lockScrollToTop();
    setTimeout(() => {
      unlockScroll();
      window.scrollTo(0, 0);
    }, 1500); // Delay to stabilize layout
  });
</script>
  <meta name="theme-color" content="#2a003f" />
  <script src="https://apis.google.com/js/api.js"></script>
  <script type="text/javascript" src="https://www.dropbox.com/static/api/2/dropins.js" id="dropboxjs" data-app-key="440t4dh1sy47nue"></script>
</head>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <body class="liquid-glass-ui">
    <div style="position: fixed; top: 10px; right: 20px; z-index: 10000;">
      <label style="font-family: monospace; color: #fff;">
        <input type="checkbox" id="restoreToggle" checked />
        üîÅ Restore Last Panel
      </label>
    </div>
    <!-- === SOVEREIGN GRID SYSTEM LAYOUT (REPLACES ALL PANELS/CONSOLES) === -->
    <div id="sovereignGrid"
         class="sovereign-zone-anchor debug-outline"
         data-harmony="true"
         data-role="observer"
         data-grid-area="staging-zone"
         data-status="active"
         data-grid-visual="active"
         data-legacy="true">
         <div id="sovereignToolbarMount"></div>
      <!-- üåÄ Whisperer Terminal Interface (restored) -->
      <div id="whispererPanel" class="nexus-core holo-console-panel" data-role="whisperer" data-zone="center-stage">
        <div id="whispererDisplay" class="terminal-output">üåå Welcome, Operator.</div>
        <input id="whispererInput" type="text" placeholder="Speak to the system..." autocomplete="off" />
      </div>
      <!-- Other dynamically rendered panels will follow here -->
    </div>
    <!-- Responsive Title Wrapper -->
    <div id="sovereignMainWrapper">
      <div id="sovereignTitle" class="system-title">
        <h1>SageCraft Ascendant</h1>
        <h2>Sovereign Codex</h2>
      </div>
    
      <section id="sovereignTerminal" class="holo-console dock-panel holo-console-panel">
        <button class="panel-close" onclick="closeConsole(this)">‚úñÔ∏è</button>
        <header class="console-header">üíª Sovereign Terminal</header>
        <div class="console-body">
          <div class="panel-content">
            <p>Awaiting command input...</p>
          </div>
        </div>
      </section>
    </div>
    <!-- ‚úÖ Sovereign Dock Panel Grid -->
    <div id="dockGrid" class="sovereign-dock-grid"></div>
    <div id="orbitBarZone"></div>
    <!-- ü™ê Orbit Buttons Dock -->
    <div id="orbitalDockContainer" class="orbit-button-dock"></div>
    <!-- Responsive Terminal Wrapper -->
    <div class="responsive-terminal-container">
      <div id="centralTerminalConsole" class="holo-console">
        <!-- terminal contents -->
      </div>
    </div>
    <!-- Removed legacy grid-panel static scaffolding -->
    <div id="footerStatusZone"></div>

    <!-- Modular Console Injections -->
    <div id="consoleMounts">
      <!-- Panels injected via JavaScript or server-side include -->
      <!-- Whisperer Console -->
      <div id="whispererConsoleMount"></div>
      <!-- Neural Pulse -->
      <div id="neuralPulsePanelMount"></div>
      <!-- Echo Archive -->
      <div id="echoArchiveConsoleMount"></div>
      <!-- Core Command -->
      <div id="coreCommandConsoleMount"></div>
      <!-- Signal Forecast -->
      <div id="signalForecastConsoleMount"></div>
    </div>
</script>
</script>
 <!-- 1. Sovereign Event Bus should be FIRST -->
<script src="core/sovereignEventBus.js"></script>
<!-- Sovereign Event Hub (must come before scripts that dispatch sovereign events) -->
<script type="module" src="scripts/sovereign/sovereignEventHub.js"></script>

<!-- 2. Core Sovereign Agent System -->
<script src="scripts/core/sovereignAgent.js"></script>
<script src="scripts/engine/sigil.engine.js"></script>

<!-- 3. Agent Modules (now that agent map exists) -->
<script src="scripts/agents/dropAgent.js"></script>
<script src="scripts/agents/taskAgent.js"></script>
<script src="scripts/agents/wardenAgent.js"></script>

</script>
<!-- 4. UI & Console -->
</script>
</script>
<script src="scripts/console/console.directives.js"></script>
<script type="module" src="scripts/wiring/consoleLifecycle.js"></script>
<script type="module" src="scripts/wiring/inputObserver.js"></script>
</script>
</script>
<script type="module" src="scripts/wiring/commandFeedback.js"></script>
</script>
  <script type="module" src="scripts/wiring/uiGridHarmonizer.js"></script>
  <script type="module" src="scripts/ascendancy/memorySocketLinker.js"></script>
  <script type="module" src="scripts/ascendancy/legacyEchoRecovery.js"></script>
  <script type="module" src="scripts/ascendancy/legacyEchoRehousing.js"></script>
  <script type="module" src="scripts/ascendancy/consoleRelayBinder.js"></script>
</script>
</div>

    <!--#include virtual="partials/agentLifecycle.html" -->

    <!--#include virtual="partials/coreCommandInput.html" -->

    <!--#include virtual="partials/echoArchivePanel.html" -->

    <!--#include virtual="partials/neuralPulsePanel.html" -->

    <!--#include virtual="partials/signalForecastConsole.html" -->

    <!--#include virtual="partials/whispererConsole.html" -->
    <!-- üîÅ Sweep Trigger -->
    <div include-html="partials/panelSweepTriggers.html"></div>
<!-- === UI FOUNDATION & WIRING === -->
<script type="module" src="scripts/wiring/buttonHooks.js"></script>
<script type="module" src="scripts/stability/earlyScrollSuppressor.js"></script>
<script type="module" src="scripts/wiring/panelVerification.js"></script>
<script type="module" src="scripts/wiring/consoleGroupSanitizer.js"></script>
<script type="module" src="scripts/ascendancy/consoleGridAllocator.js"></script>
<script type="module" src="scripts/ascendancy/consoleGridActivation.js"></script>
<script type="module" src="scripts/ascendancy/consoleGridVisualizer.js"></script>
<script type="module" src="scripts/ascendancy/panelCoordinateAtlas.js"></script>
<script type="module" src="scripts/ascendancy/consoleDockRelinker.js"></script>
<script type="module" src="scripts/stability/scrollIntercept.js"></script>
<script type="module" src="scripts/stability/scrollTrace.js"></script>
<script type="module" src="scripts/wiring/orbitWiringSystem.js"></script>

<!-- === CLEANUP & SANITATION === -->
<script type="module" src="scripts/wiring/uiSanitizer.js"></script>
<script type="module" src="scripts/cleanup/panelSanitizer.js"></script>
<script type="module" src="scripts/lifecycle/panelSnapValidationSweep.js"></script>
<script type="module" src="scripts/lifecycle/panelHydrationManager.js"></script>

<!-- === CONSOLE CORE LIFECYCLE === -->
<script type="module" src="scripts/ascendancy/consoleAtlas.js"></script>
<script type="module" src="scripts/ascendancy/consolePanelMemory.js"></script>
<script type="module" src="scripts/ascendancy/consoleRecovery.js"></script>
<script type="module" src="scripts/ascendancy/panelDockBinder.js"></script>
<script type="module" src="scripts/ascendancy/consoleHarmonySync.js"></script>
<script type="module" src="scripts/ascendancy/consoleClarityMatrix.js"></script>
<script type="module" src="scripts/ascendancy/consoleIdentityStabilizer.js"></script>
<script type="module" src="scripts/ascendancy/consoleVisibilitySweep.js"></script>
<script type="module" src="scripts/ascendancy/consoleClarityScanner.js"></script>
<script type="module" src="scripts/ascendancy/consoleGridBinder.js"></script>
<script type="module" src="scripts/ascendancy/panelGridMemoryLinker.js"></script>
<script type="module" src="scripts/ascendancy/consoleHomePositionResolver.js"></script>

<!-- === COMMAND SYSTEM & FEEDBACK === -->
<script type="module" src="scripts/utility/panelResurrectionGrid.js"></script>
<script type="module" src="scripts/wiring/commandDispatcher.js"></script>
<script type="module" src="scripts/ascendancy/commandFeedback.js"></script>
<script type="module" src="scripts/command/whispererTerminal.js"></script>

<!-- === VALIDATION LAYERS === -->
<script type="module" src="scripts/ascendancy/buttonValidator.js"></script>
<script type="module" src="scripts/ascendancy/inputFieldValidator.js"></script>
<script type="module" src="scripts/ascendancy/consoleGridValidator.js"></script>

<!-- === UI STABILITY MODULES === -->
<script type="module" src="scripts/utility/core.panelRoleFixer.js"></script>
<script type="module" src="scripts/ascendancy/consoleLayoutResolver.js"></script>
<script type="module" src="scripts/ascendancy/consoleHomeBinder.js"></script>
<script type="module" src="scripts/ascendancy/consoleContainmentField.js"></script>
<script type="module" src="scripts/ascendancy/uiHarmonyEngine.js"></script>
<script type="module" src="scripts/ascendancy/terminalVisibilityController.js"></script>
<script type="module" src="scripts/ascendancy/consoleGridLayoutResolver.js"></script>
<script type="module" src="scripts/ascendancy/consoleGridEnforcer.js"></script>
<script type="module" src="scripts/ascendancy/consoleGridConsistency.js"></script>
<script type="module" src="scripts/ascendancy/panelAutoAligner.js"></script>
<script type="module" src="scripts/ascendancy/gridNodeRestorer.js"></script>
<script type="module" src="scripts/ascendancy/consoleDockInjectionFinalizer.js"></script>
<script type="module" src="scripts/ascendancy/gridConstraintStabilizer.js"></script>
<script type="module" src="scripts/ascendancy/gridSentinel.js"></script>
<script type="module" src="scripts/ascendancy/consoleWarpStabilizer.js"></script>
<script type="module" src="scripts/ascendancy/terminalContainmentShield.js"></script>
<script type="module" src="scripts/ascendancy/terminalVisibilityGuard.js"></script>
<script type="module" src="scripts/ascendancy/driftCompensator.js"></script>
<script type="module" src="scripts/ascendancy/gridAnchorRegistry.js"></script>
<script type="module" src="scripts/ascendancy/gridAnchorRestoration.js"></script>
<script type="module" src="scripts/ascendancy/consoleGroupAnomalyDetector.js"></script>
<script type="module" src="scripts/ascendancy/terminalGridLinkSynchronizer.js"></script>
<script type="module" src="scripts/ascendancy/consoleGridEngine.js"></script>
<script type="module" src="scripts/ascendancy/gridSnapResolver.js"></script>
<script type="module" src="scripts/ascendancy/panelSnapRehydrator.js"></script>
<script type="module" src="scripts/grid/consoleSyncPulse.js"></script>
<script type="module" src="scripts/grid/panelOrbitSync.js"></script>
<script type="module" src="scripts/grid/consoleAnchorMatrix.js"></script>
<script type="module" src="scripts/grid/consoleSyncPulse.js"></script>
<script type="module" src="scripts/grid/gridIntegrityScanner.js"></script>
<script type="module" src="scripts/grid/spatialReconciliationEngine.js"></script>
<script type="module" src="scripts/ascendancy/consoleContourBinder.js"></script>
<script type="module" src="scripts/grid/gridMagnetMatrix.js"></script>
<script type="module" src="scripts/grid/gridResyncEmitter.js"></script>
<script type="module" src="scripts/grid/gridSnapMagnetism.js"></script>
<script type="module" src="scripts/grid/gridCoordinateResolver.js"></script>
<script type="module" src="scripts/grid/consoleGridMagnetizer.js"></script>
<script type="module" src="scripts/grid/gridNodeRestorer.js"></script>
<script type="module" src="scripts/ascendancy/panelSnapSerializer.js"></script>
<script type="module" src="scripts/ascendancy/panelMagneticFeedback.js"></script>
<script type="module" src="scripts/grid/panelQuadrantRegistry.js"></script>
<script type="module" src="scripts/grid/sectorAnchorBinder.js"></script>
<script type="module" src="scripts/grid/magneticGridSeeker.js"></script>
<script type="module" src="scripts/grid/gridCoordinateRegistry.js"></script>
<script type="module" src="scripts/stability/consoleUIMender.js"></script>
<script type="module" src="scripts/stability/consoleStyleBalancer.js"></script>
<script type="module" src="scripts/stability/consoleAnchorField.js"></script>
<script type="module" src="scripts/stability/uiRecoveryPulse.js"></script>
<script type="module" src="scripts/stability/adaptiveGridSentinel.js"></script>
<script type="module" src="scripts/stability/signalDriftDetector.js"></script>
<script type="module" src="scripts/stability/terminalSnapDiagnostics.js"></script>
<script type="module" src="scripts/stability/dockReconciliationMatrix.js"></script>
<script type="module" src="scripts/stability/consoleRootCalibrator.js"></script>
<script type="module" src="scripts/stability/consoleMatrixRealigner.js"></script>
<script type="module" src="scripts/stability/consoleStabilityDriftMonitor.js"></script>
<script type="module" src="scripts/stability/consolePanelFluxBinder.js"></script>
<script type="module" src="scripts/stability/consolePanelSyncGuardian.js"></script>
<script type="module" src="scripts/stability/terminalAnchorBinder.js"></script>
<script type="module" src="scripts/stability/consoleViewAligner.js"></script>
<script type="module" src="scripts/stability/interfaceLayoutMatrix.js"></script>
<script type="module" src="scripts/stability/interfaceKinetics.js"></script>
<script type="module" src="scripts/grid/gridSnapTrigger.js"></script>
<script type="module" src="scripts/devtools/gridSnapTestKit.js"></script>
<script type="module" src="scripts/lifecycle/panelDriftSignal.js"></script>
<script type="module" src="scripts/lifecycle/panelSnapEngine.js"></script>
<script type="module" src="scripts/lifecycle/panelGridAnchor.js"></script>
<script type="module" src="scripts/lifecycle/panelSnapEngine.js"></script>
<script type="module" src="scripts/ui/panelInteractionLinker.js"></script>
<script type="module" src="scripts/lifecycle/layoutPresetsDropdown.js"></script>
<script type="module" src="scripts/cleanup/uiGhostCleaner.js"></script>

<!-- === Companion Systems & Lifecycle Modules === -->
<script type="module" src="scripts/lifecycle/companionKernel.js"></script>

<!-- === FORECAST & SIGNAL SYSTEMS === -->
<script type="module" src="scripts/forecasting/forecastMatrixSync.js"></script>
<script type="module" src="scripts/ascendancy/resurrectionQueue.js"></script>

<!-- === ADVANCED MODULAR HOOKS === -->
<script type="module" src="scripts/ascendancy/consoleAnomalyScanner.js"></script>
<script type="module" src="scripts/ascendancy/panelActivityScanner.js"></script>
<script type="module" src="scripts/ascendancy/panelMemoryRehydrator.js"></script>
<script type="module" src="scripts/ascendancy/gridRelayLinker.js"></script>
<script type="module" src="scripts/ascendancy/consoleAnomalyRebinder.js"></script>
<script type="module" src="scripts/grid/gridSnapCoordinator.js"></script>
<script type="module" src="scripts/lifecycle/panelGridAnchor.js"></script>
<script type="module" src="scripts/core/terminalCentering.js"></script>
  <!-- üåÄ Whisperer Nexus Core -->
  <div id="whispererPanel" class="nexus-core holo-console-panel" data-role="whisperer" data-zone="center-stage">
    <div id="whispererDisplay" class="terminal-output">üåå Welcome, Operator.</div>
    <input id="whispererInput" type="text" placeholder="Speak to the system..." autocomplete="off" />
  </div>

  <!-- üß† Neural Activity Node -->
  <div id="neuralActivity" class="neural-core-indicator" title="Neural Activity Monitoring"></div>
  <script>
    // Block any element from stealing scroll focus
    const blockScrollSteal = () => {
      document.querySelectorAll('*').forEach(el => {
        el.blur?.();
      });
      window.scrollTo(0, 0);
    };

    // Re-run scroll lock on any new focus
    document.addEventListener('focus', blockScrollSteal, true);
    document.addEventListener('DOMContentLoaded', blockScrollSteal);
    window.addEventListener('load', () => {
      blockScrollSteal();
      setTimeout(blockScrollSteal, 250);
      setTimeout(blockScrollSteal, 500);
      setTimeout(blockScrollSteal, 1000);
    });
  </script>
  <script>
    // Finalized scroll lock logic that allows manual scrolling but prevents unwanted load jumps
    function stabilizeInitialScroll() {
      // Reset to top only once on full load
      window.scrollTo(0, 0);
    }

    window.addEventListener("load", () => {
      stabilizeInitialScroll();
      setTimeout(stabilizeInitialScroll, 100);
      setTimeout(stabilizeInitialScroll, 500);
    });

    // Remove any rogue script-triggered scrolls without interfering with manual scroll
    const observer = new MutationObserver(() => {
      if (window.scrollY > 5) {
        window.scrollTo(0, 0);
      }
    });

    // Activate only on initial burst (first few seconds)
    setTimeout(() => observer.disconnect(), 3000);
    observer.observe(document.body, { childList: true, subtree: true });
  </script>
  <script>
    // === Snapline Debug Injection ===
    const snaplines = [
      { top: '10px', left: '0', width: '100vw', height: '1px', background: 'rgba(255, 0, 0, 0.5)' },
      { top: 'auto', bottom: '10px', left: '0', width: '100vw', height: '1px', background: 'rgba(0, 255, 0, 0.5)' },
      { left: '10px', top: '0', width: '1px', height: '100vh', background: 'rgba(0, 0, 255, 0.5)' },
      { left: 'auto', right: '10px', top: '0', width: '1px', height: '100vh', background: 'rgba(255, 255, 0, 0.5)' }
    ];

    snaplines.forEach(line => {
      const div = document.createElement('div');
      Object.assign(div.style, {
        position: 'fixed',
        zIndex: 9999,
        pointerEvents: 'none',
        ...line
      });
      document.body.appendChild(div);
    });

    console.log("üìê Snapline Debug Injection complete.");
  </script>
</body>
<script>
  function toggleDevConsole() {
    const panel = document.getElementById("devConsolePanel");
    if (panel) {
      panel.style.display = panel.style.display === "none" ? "block" : "none";
    }
  }

  // Neural Command Bridge toggle helper
  function toggleNeuralCommandBridge() {
    const panel = document.getElementById("neuralCommandBridge");
    if (panel) {
      panel.style.display = panel.style.display === "none" ? "block" : "none";
    }
  }

</script>
<script>
  // Directive Presets for Dev Console (now localStorage-based)
  function getStoredPresets() {
    return JSON.parse(localStorage.getItem("directivePresets") || "{}");
  }

  function updatePresetDropdown() {
  const select = document.getElementById("directivePresetSelect");
  const presets = getStoredPresets();

  // ‚úÖ This logic should be INSIDE the function
  if (!select) return;

  // Clear and rebuild
  select.innerHTML = `<option value="">üîΩ Load Saved Directive...</option>`;
  for (const key in presets) {
    const option = document.createElement("option");
    option.value = key;
    option.textContent = key;
    select.appendChild(option);
  }
}

// ‚úÖ Safe execution only when dropdown exists
window.addEventListener("DOMContentLoaded", () => {
  const dropdown = document.getElementById("directivePresetSelect");
  if (dropdown) updatePresetDropdown();
});

  function saveCurrentDirectiveAsPreset() {
    const name = prompt("Enter preset name (e.g., meshVitals.sync):");
    if (!name) return;
    try {
      const raw = document.getElementById("devDirectiveInput").value;
      const json = JSON.parse(raw);
      const presets = getStoredPresets();
      presets[name] = json;
      localStorage.setItem("directivePresets", JSON.stringify(presets));
      updatePresetDropdown();
      alert("‚úÖ Preset saved.");
    } catch {
      alert("‚ùå Invalid JSON ‚Äî cannot save.");
    }
  }

  function deleteSelectedPreset() {
    const select = document.getElementById("directivePresetSelect");
    const key = select.value;
    if (!key) return;
    const presets = getStoredPresets();
    if (!presets[key]) return;
    delete presets[key];
    localStorage.setItem("directivePresets", JSON.stringify(presets));
    updatePresetDropdown();
    alert("üóëÔ∏è Preset deleted.");
  }

  function loadDirectivePreset() {
  const select = document.getElementById("directivePresetSelect");
  const input = document.getElementById("devDirectiveInput");
  if (!select || !input) return;

  const key = select.value;
  const presets = getStoredPresets();
  if (presets[key]) {
    input.value = JSON.stringify(presets[key], null, 2);
  }
}

  // Initialize dropdown on load
  updatePresetDropdown();

  function dispatchDevDirective() {
    try {
      const raw = document.getElementById("devDirectiveInput").value;
      const directive = JSON.parse(raw);
      if (window.SovereignBus?.emit) {
        window.SovereignBus.emit("agentDirective", directive);
        alert("‚úÖ Directive dispatched.");
      } else {
        alert("‚ùå SovereignBus not found.");
      }
    } catch (err) {
      alert("‚ùå Invalid JSON input.");
    }
  }

  // üõ∞ Listen for Agent Responses and log them in the Dev Console
  // --- Agent Lifeline Monitor logic ---
  // The Hollow Warden anomaly handler
  const agentStatusMap = {};
  const anomalyLog = JSON.parse(localStorage.getItem("anomalyLog") || "[]");

  function refreshAgentLifeline() {
    renderAgentLifeline();
  }

  // Auto memory: Store seen agents
  function updateAgentLifeline(directive) {
    const key = directive?.target;
    if (!key) return;

    const now = Date.now();
    agentStatusMap[key] = now;
    storeAgentMemory();
    renderAgentLifeline();
  }

  function storeAgentMemory() {
    try {
      localStorage.setItem("agentMemory", JSON.stringify(agentStatusMap));
    } catch (e) {
      console.warn("Failed to store agent memory:", e);
    }
  }

  function restoreAgentMemory() {
    try {
      const stored = JSON.parse(localStorage.getItem("agentMemory") || "{}");
      Object.assign(agentStatusMap, stored);
      renderAgentLifeline();
    } catch (e) {
      console.warn("Failed to restore agent memory:", e);
    }
  }

  function renderAgentLifeline() {
    const list = document.getElementById("agentLifelineList");
    if (!list) return;

    list.innerHTML = "";
    const now = Date.now();

    Object.keys(agentStatusMap).forEach((key) => {
      const lastPing = agentStatusMap[key];
      const secondsAgo = Math.floor((now - lastPing) / 1000);

      let status = "‚úÖ ONLINE";
      let cssClass = "agent-status-online";

      if (secondsAgo > 30) {
        status = "‚ùå MISSING";
        cssClass = "agent-status-missing";
      } else if (secondsAgo > 10) {
        status = "‚ö†Ô∏è IDLE";
        cssClass = "agent-status-idle";
      }

      const li = document.createElement("li");
      li.textContent = `${key}: ${status} ‚Äî ${secondsAgo}s ago`;
      li.className = cssClass;
      list.appendChild(li);
    });
  }

  function sweepGhostAgents() {
    const now = Date.now();
    const purged = [];

    Object.entries(agentStatusMap).forEach(([key, timestamp]) => {
      const age = now - timestamp;
      if (age > 120000) {
        purged.push(key);
        anomalyLog.unshift({
          key,
          timestamp,
          reason: "No ping in over 2 minutes",
          memoryId: `${key}-${Date.now()}`,
          echoKey: generateEchoKey(key)
        });
        localStorage.setItem("anomalyLog", JSON.stringify(anomalyLog.slice(0, 50)));
        delete agentStatusMap[key];
      }
    });

    if (purged.length > 0) {
      storeAgentMemory();
      renderAgentLifeline();
      renderAnomalySanctum();
      logToFeedbackConsole(`‚ò†Ô∏è Hollow Warden purged ${purged.length} ghost agent(s): ${purged.join(", ")}`);
    }
  }

  function generateEchoKey(base) {
    const charset = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
    let key = "";
    for (let i = 0; i < 6; i++) {
      key += charset[Math.floor(Math.random() * charset.length)];
    }
    return `${base.toUpperCase()}-${key}`;
  }

  // üîÑ Resurrect anomaly by Echo Key utility
  function resurrectAnomalyByEchoKey(echoKey) {
    const entry = anomalyLog.find(a => a.echoKey === echoKey);
    if (!entry) {
      alert("‚ùå No matching memory found.");
      return;
    }

    // Simulate restoration logic
    agentStatusMap[entry.key] = Date.now();
    sweepGhostAgents();
    renderAgentLifeline();
    renderAnomalySanctum();

    alert(`üîÑ ${entry.key} resurrected from memory (${echoKey})`);
  }

  function pulseWardenGlyph(active) {
  const glyph = document.getElementById("wardenGlyph");
  if (!glyph) return;
  glyph.style.color = active ? "#f44" : "#444";
  glyph.style.transform = active ? "scale(1.2)" : "scale(1)";
}

function toggleAnomalySanctum() {
  const panel = document.getElementById("anomalySanctumPanel");
  if (!panel) return;
  panel.style.display = panel.style.display === "none" ? "block" : "none";
}

  // Helper: Get sigil for anomaly key
  function getSigilForAnomaly(key = "") {
    if (key.startsWith("GHOST") || key.includes("phantom")) return "üëÅÔ∏è";
    if (key.startsWith("SYS") || key.includes("core")) return "‚öôÔ∏è";
    if (key.startsWith("DRIFTER") || key.includes("echo")) return "üíæ";
    return "üßø";
  }

  function renderAnomalySanctum() {
    const list = document.getElementById("anomalyList");
    if (!list) return;
    list.innerHTML = "";

    const selectedFilter = document.getElementById("anomalyFilterSelect")?.value || "";

    anomalyLog.slice(0, 10).forEach((entry) => {
      const sigil = getSigilForAnomaly(entry.key);
      if (selectedFilter && sigil !== selectedFilter) return;
      const li = document.createElement("li");
      const time = new Date(entry.timestamp).toLocaleTimeString();
      // --- Begin: Render anomaly key as link to grimoire.html#<key>
      const link = document.createElement("a");
      link.href = `/grimoire.html#${entry.key}`;
      link.textContent = `${entry.key}`;
      link.style.color = "#9cf";
      link.style.textDecoration = "underline";
      link.target = "_blank";

      li.textContent = `${sigil} `;
      li.appendChild(link);
      li.append(` ‚Äî ${time}`);
      // --- End: Render anomaly key as link
      li.classList.add("lore-entry");
      list.appendChild(li);
    });

    // Reveal the panel if it has content
    const panel = document.getElementById("anomalySanctumPanel");
    const hasAnomalies = anomalyLog.length > 0;
    if (panel) panel.style.display = hasAnomalies ? "block" : "none";
    pulseWardenGlyph(hasAnomalies);
  }

  function restoreLastAnomaly() {
    const entry = anomalyLog.shift();
    if (!entry) return alert("No anomalies to restore.");
    agentStatusMap[entry.key] = Date.now();
    renderAgentLifeline();
    renderAnomalySanctum();
    storeAgentMemory();
    logToFeedbackConsole(`‚ö° Restored forgotten agent: ${entry.key}`);
  }

  // üì¶ Export anomaly codex as JSON file
  function exportAnomalyCodex() {
    const blob = new Blob([JSON.stringify(anomalyLog, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const link = document.createElement("a");
    link.href = url;
    link.download = "sovereign_lore_codex.json";
    link.click();
    URL.revokeObjectURL(url);
  }

  // üì• Import anomaly codex from JSON file
  function importAnomalyCodex(file) {
    const reader = new FileReader();
    reader.onload = function (e) {
      try {
        const importedLog = JSON.parse(e.target.result);
        if (Array.isArray(importedLog)) {
          importedLog.forEach(entry => {
            if (entry.key && entry.timestamp) {
              anomalyLog.unshift(entry);
            }
          });
          localStorage.setItem("anomalyLog", JSON.stringify(anomalyLog.slice(0, 50)));
          renderAnomalySanctum();
          alert("üìñ Lore Codex synchronized successfully.");
        } else {
          alert("‚ùå Invalid format.");
        }
      } catch {
        alert("‚ùå Failed to parse JSON.");
      }
    };
    reader.readAsText(file);
  }

  setInterval(sweepGhostAgents, 90000);

  // Restore on load
  restoreAgentMemory();

  if (window.SovereignBus?.on) {
    SovereignBus.on("agentResponse", (response) => {
      console.log("üõ∞ Agent Response Received:", response);
      appendDevLog(response);

      const summary = response.directive?.target + "." + response.directive?.action;
      const status = response.status?.toUpperCase() || "UNKNOWN";
      logToFeedbackConsole(`${status} ‚Äî ${summary}`);

      // Lifeline update
      updateAgentLifeline(response.directive);
    });
  }
  function logToFeedbackConsole(msg) {
    const logBox = document.getElementById("feedbackConsole");
    if (!logBox) return;
    const timestamp = new Date().toLocaleTimeString();
    const line = `[${timestamp}] ${msg}`;
    logBox.textContent += line + "\n";
    logBox.scrollTop = logBox.scrollHeight;
  }

  function appendDevLog(response) {
    const logEl = document.getElementById("devConsoleLog");
    if (!logEl) return;

    const timestamp = new Date().toLocaleTimeString();
    const status = response.status?.toUpperCase() || "UNKNOWN";
    const summary = response.directive?.action
      ? `${response.directive.target}.${response.directive.action}()`
      : "No action";

    let symbol = "üî∑";
    if (status === "SUCCESS") symbol = "‚úÖ";
    else if (status === "ERROR") symbol = "‚ùå";
    else if (status === "UNHANDLED") symbol = "‚ö†Ô∏è";

    const line = `[${timestamp}] ${symbol} ${status} ‚Äî ${summary}`;
    const existing = logEl.textContent.trim();
    logEl.textContent = line + "\n" + existing;
  }

  // üì§ Export Anomaly Log as JSON file
  function exportAnomalyLog() {
    if (!anomalyLog?.length) return alert("üì≠ No anomalies to export.");

    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(anomalyLog, null, 2));
    const downloadAnchor = document.createElement("a");
    downloadAnchor.setAttribute("href", dataStr);
    downloadAnchor.setAttribute("download", "anomaly_log_export.json");
    downloadAnchor.click();
  }

  // üì• Import Anomaly Log from JSON file
  function importAnomalyLog() {
    const fileInput = document.getElementById("anomalyImportFile");
    const file = fileInput?.files?.[0];
    if (!file) return alert("üìÇ No file selected.");

    const reader = new FileReader();
    reader.onload = function (e) {
      try {
        const imported = JSON.parse(e.target.result);
        if (!Array.isArray(imported)) throw new Error("Invalid format.");
        anomalyLog = [...imported, ...anomalyLog];
        renderAnomalySanctum();
        alert("‚úÖ Anomalies imported.");
      } catch (err) {
        alert("‚ùå Failed to import. Invalid JSON format.");
      }
    };
    reader.readAsText(file);
  }

  // === üß¨ Agent Lifecycle Registry Panel Logic ===
  function renderAgentLifecyclePanel() {
    const list = document.getElementById("lifecycleList");
    if (!list || !window.SovereignAgents) return;

    list.innerHTML = "";
    const now = Date.now();

    Object.entries(SovereignAgents).forEach(([name, agent]) => {
      const lastPing = agent.lastPing || 0;
      const secondsAgo = Math.floor((now - lastPing) / 1000);

      let status = "‚úÖ ONLINE";
      if (secondsAgo > 30) status = "‚ùå MISSING";
      else if (secondsAgo > 10) status = "‚ö†Ô∏è IDLE";

      const li = document.createElement("li");
      li.textContent = `${name}: ${status} ‚Äî ${secondsAgo}s ago`;
      list.appendChild(li);
    });
  }

  // ‚ôªÔ∏è Refresh panel every 5 seconds
  setInterval(renderAgentLifecyclePanel, 5000);
</script>
<script>
function promptExportByType() {
  const type = prompt("Enter sigil type to export (or leave blank for all):", "all");
  if (type !== null) {
    exportSigilsByTypeToJSON(type.trim() || "all");
    showToast(`üì§ Exporting sigils by type: "${type}"`);
  }
}

function promptExportByElement() {
  const element = prompt("Enter sigil element to export (or leave blank for all):", "all");
  if (element !== null) {
    exportSigilsByElementToJSON(element.trim() || "all");
    showToast(`üåå Exporting sigils by element: "${element}"`);
  }
}

function showToast(message = "‚úÖ Done") {
  const toast = document.createElement("div");
  toast.textContent = message;
  toast.style.position = "fixed";
  toast.style.bottom = "30px";
  toast.style.right = "30px";
  toast.style.background = "rgba(0,0,0,0.8)";
  toast.style.color = "#fff";
  toast.style.padding = "10px 14px";
  toast.style.borderRadius = "6px";
  toast.style.fontFamily = "monospace";
  toast.style.zIndex = 10000;
  toast.style.boxShadow = "0 0 6px #8844ff";
  document.body.appendChild(toast);
  setTimeout(() => {
    toast.remove();
  }, 3000);
}
</script>
</html>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const toggle = document.getElementById("restoreToggle");
      const restoreEnabled = localStorage.getItem("restoreEnabled") !== "false";
      toggle.checked = restoreEnabled;

      toggle.addEventListener("change", () => {
        localStorage.setItem("restoreEnabled", toggle.checked);
      });

      // Intercept Neural persistence restoration
      const originalRestore = window.NeuralMemory?.restoreLastPanel;
      if (typeof originalRestore === "function") {
        const shouldRestore = localStorage.getItem("restoreEnabled") !== "false";
        if (shouldRestore) {
          originalRestore();
        }
      }

      // üõ°Ô∏è Activate Warden lifecycle
      if (typeof renderAnomalySanctum === "function") renderAnomalySanctum();
      if (typeof renderAgentLifeline === "function") renderAgentLifeline();
      if (window.Warden && typeof Warden.init === "function") {
        Warden.init(); // üõ°Ô∏è Activate Warden lifecycle
      }
    });
  </script>
  <div class="logo-banner-flex">
    <div id="operatorTierStatus" class="operator-tier-status sovereign-active">
      <span class="tier-badge">üõ° SOVEREIGN</span>
      <span id="authStatusLight" class="status-light status-authenticated" title="Authenticated"></span>
    </div>
  

<!-- === INSPECTION REPORT FOR STRUCTURAL PLACEHOLDERS & CLUTTER MARKERS === -->
<!--
Inspection results for structural placeholders/clutter markers:

1. <div class="panel-label"> ‚Äî FOUND in <style> only, not as an element in the main HTML.
2. <div class="console-contour"> ‚Äî FOUND in <style> only, not as an element in the main HTML.
3. <div class="orbitMapZone"> ‚Äî NOT FOUND.
4. <section id="orbitButtonHelp"> ‚Äî NOT FOUND.
5. <section class="holo-console"> containing generic headers like "Docked Panel":
   - Many <section class="holo-console ..."> found, but none with a header "Docked Panel".
6. <span class="zone-tag"> ‚Äî NOT FOUND.
7. <div class="grid-marker"> ‚Äî NOT FOUND.

Other notes:
* There are multiple <style> rules for .panel-label and .console-contour, but no actual elements with those classes in the HTML body.
* No elements with classes 'orbitMapZone', 'zone-tag', or 'grid-marker' found.
* No <section id="orbitButtonHelp"> found.
* No <section class="holo-console"> with a header "Docked Panel" found.
-->
  </script>
  <style>
    .utility-controls button {
      margin: 0.4rem;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      background: rgba(255,255,255,0.05);
      border: 1px solid #ff69b4;
      color: #ff69b4;
      cursor: pointer;
    }

    .utility-controls button:hover {
      background: rgba(255,105,180,0.1);
    }

    .utility-output {
      background: rgba(255,255,255,0.05);
      padding: 0.75rem;
      margin-top: 0.75rem;
      font-family: monospace;
      color: #ff69b4;
      border: 1px dashed #ff69b4;
      white-space: pre-wrap;
    }

    @keyframes pulseGreen {
  0% { color: #0f0; transform: scale(1); }
  50% { color: #6f6; transform: scale(1.05); }
  100% { color: #0f0; transform: scale(1); }
}

@keyframes pulseYellow {
  0% { color: #ff0; transform: scale(1); }
  50% { color: #ffb; transform: scale(1.05); }
  100% { color: #ff0; transform: scale(1); }
}

@keyframes pulseRed {
  0% { color: #f00; transform: scale(1); }
  50% { color: #f88; transform: scale(1.05); }
  100% { color: #f00; transform: scale(1); }
}

.agent-status-online {
  animation: pulseGreen 1.5s infinite;
}
.agent-status-idle {
  animation: pulseYellow 2s infinite;
}
.agent-status-missing {
  animation: pulseRed 2.2s infinite;
}
  </style>

    <section class="holo-console hidden" id="oracleConsole" aria-hidden="true">
      <button class="panel-close" onclick="closeConsole(this)">‚úñÔ∏è</button>
      <header class="console-header">üîÆ Oracle Interface</header>
      <div class="console-body">
        <div class="panel-content">
          <h2>üîÆ Oracle Console</h2>
          <p class="panel-desc">Consult the Oracle for wisdom, lore alignment, and sigil resonance.</p>
          <p>Consult the Silent Sage. Enter your query below:</p>

          <label>
            Your Inquiry:
            <input type="text" id="oracleInput" placeholder="e.g., What is the state of the mesh?">
          </label>
          <button onclick="consultOracle()">üßô Ask the Sage</button>

          <div id="oracleResponse" class="oracle-output">Awaiting your question...</div>
        </div>
      </div>
    </section>
    <!-- Micro-injected missing panels for Sovereign Console -->
    <div id="exceptionManagerConsole" class="holo-console holo-console-panel" data-permalock>
      <h2>üß® Exception Manager</h2>
      <p>Monitoring real-time exceptions in the system.</p>
      <ul id="exceptionList">
        <!-- Exceptions dynamically populated here -->
      </ul>
      <button id="clearExceptionsBtn">Clear Exceptions</button>
    </div>
    <div id="progressDashboardConsole" class="holo-console holo-console-panel"></div>
    <div id="masterExportHubConsole" class="holo-console holo-console-panel"></div>
    <div id="mappingsConsole" class="holo-console holo-console-panel"></div>
    <div id="toolsConsole" class="holo-console holo-console-panel"></div>
    <div id="auditConsole" class="holo-console holo-console-panel"></div>
    <div id="configPanelConsole" class="holo-console holo-console-panel"></div>
  <script>
    function consultOracle() {
      const input = document.getElementById("oracleInput");
      const response = document.getElementById("oracleResponse");
      const question = input.value.trim();

      if (!question) return;

      const reply = generateMysticalResponse(question);
      response.textContent = `üßô Sage replies: "${reply}"`;
      input.value = '';
    }

    function generateMysticalResponse(query) {
      const responses = [
        "The data whispers truths hidden in code.",
        "All systems stabilize in time.",
        "Beware the silent drift between panels.",
        "Your path will align when the circuit is closed.",
        "The mesh remembers more than you think."
      ];
      return responses[Math.floor(Math.random() * responses.length)];
    }
  </script>
  <style>
    #oracleConsole input {
      padding: 0.5rem;
      font-size: 1rem;
      width: 60%;
      margin-right: 0.5rem;
    }

    #oracleConsole button {
      padding: 0.5rem 1rem;
      font-size: 1rem;
      background: rgba(128,0,128,0.05);
      border: 1px solid #8a2be2;
      color: #8a2be2;
      cursor: pointer;
    }

    #oracleConsole button:hover {
      background: rgba(138,43,226,0.1);
    }

    .oracle-output {
      margin-top: 1rem;
      font-family: serif;
      font-style: italic;
      color: #8a2be2;
      text-shadow: 0 0 4px #8a2be2;
    }
  </style>

  <!-- üîÅ Modular: Orbital Panel Dock -->
  <div id="orbitalDockMount">
    <!-- Orbit Docking Panel Injected Here -->
    <!-- Expected partial include -->
  <div data-include-html="partials/orbitPanelDock.html"></div>
  </div>
</body>
<script>
  // Sovereign Orbit Dropdown Toggle Logic
  document.addEventListener("DOMContentLoaded", function () {
    const orbitToggle = document.getElementById("sovereignOrbitToggle");
    const orbitContent = orbitToggle?.nextElementSibling;

    if (orbitToggle && orbitContent) {
      orbitToggle.addEventListener("click", function (e) {
        e.stopPropagation();
        orbitContent.style.display = orbitContent.style.display === "block" ? "none" : "block";
      });

      // Optional: click outside to close dropdown
      document.addEventListener("click", function () {
        orbitContent.style.display = "none";
      });

      // Prevent closing when clicking inside
      orbitContent.addEventListener("click", function (e) {
        e.stopPropagation();
      });
    }
  });
</script>

  <!-- Whisperer Orbit external navigation logic removed; now handled via data-target like other orbits -->
  <!-- Ensure required console panels exist directly below #sovereignOrbitDock -->
  <script>
  document.addEventListener("DOMContentLoaded", function() {
    // Panel IDs & class
    const expectedPanels = [
      { id: "countConsole", className: "holo-console" },
      { id: "deltaAnalyzerConsole", className: "holo-console" },
      { id: "reportingHubConsole", className: "holo-console" },
      { id: "sessionManagerConsole", className: "holo-console" },
      { id: "utilityHubConsole", className: "holo-console" },
      { id: "oracleConsole", className: "holo-console" },
    ];
    // Find the sovereignOrbitDock node
    const dock = document.getElementById("sovereignOrbitDock");
    if (dock) {
      // Find last console panel after the dock (if any) to insert after
      let insertAfter = dock.parentNode;
      // Gather all direct siblings after #sovereignOrbitDock
      let next = dock.parentNode.nextSibling;
      let lastConsole = null;
      while (next) {
        if (next.nodeType === 1 && next.classList && next.classList.contains("holo-console")) {
          lastConsole = next;
        }
        next = next.nextSibling;
      }
      // Insert missing panels after the last known console, or after dock
      let insertParent = dock.parentNode.parentNode;
      let insertRef = dock.parentNode.nextSibling;
      // Check for each panel
      expectedPanels.forEach(panel => {
        if (!document.getElementById(panel.id)) {
          // Create and insert the missing panel
          const div = document.createElement("div");
          div.id = panel.id;
          div.className = panel.className;
          insertParent.insertBefore(div, insertRef);
        }
      });
    }
    // Predictive HUD DOM structure
    function createPredictiveHudDom() {
      const hud = document.createElement("div");
      hud.id = "predictiveHud";
      hud.className = "hud-container";
      hud.innerHTML = `
        <div id="dockStatusText">Dock: N/A</div>
        <div id="lastSync">Last Sync: N/A</div>
        <div>Items: <span id="itemSpan">0</span></div>
        <div>Categories: <span id="categorySpan">0</span></div>
        <ul id="recentList"></ul>
      `;
      return hud;
    }
    let predictiveHud = document.getElementById("predictiveHud");
    if (!predictiveHud) {
      // Try to find a container to append it to
      const container = document.getElementById("predictiveHud") || document.body;
      if (container && container.id === "predictiveHud") {
        // Already present, do nothing
      } else if (container && container.tagName === "BODY") {
        container.appendChild(createPredictiveHudDom());
      }
    }
  });
  </script>
  
    <section id="sovereignTerminal" class="holo-console dock-panel holo-console-panel">
      <button class="panel-close" onclick="closeConsole(this)">‚úñÔ∏è</button>
      <header class="console-header">üíª Sovereign Terminal</header>
      <div class="console-body">
        <div class="panel-content">
          <p>Awaiting command input...</p>
        </div>
      </div>
    </section>
  </div>
  <!-- üß† Center Stage Layout End -->
<!-- Grimoire Lore Table Render Trigger -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    if (window.GrimoireMemory && typeof GrimoireMemory.renderTableTo === "function") {
      GrimoireMemory.renderTableTo("grimoireTablePanel");
    }
  });
</script>
    </main>
    </script>

<!-- Phase 201.2 ‚Äî Neural Intake Uploader binding -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const intakeBtn = document.getElementById("launchNeuralIntakeBtn");
  const intakeFile = document.getElementById("neuralIntakeFile");

  if (intakeBtn && intakeFile) {
    intakeBtn.addEventListener("click", () => intakeFile.click());
    intakeFile.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (!file) return;
      if (window.NeuralDataIntake?.parseUploadedFile) {
        window.NeuralDataIntake.parseUploadedFile(file);
      } else {
        alert("Neural Intake system unavailable.");
      }
    });
  }
});
</script>

<!-- Orbit Button Active State Handler -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const allOrbitButtons = document.querySelectorAll('.orbit-btn');
    allOrbitButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const allOrbits = document.querySelectorAll('.orbit-btn');
        allOrbits.forEach(o => o.classList.remove('active-orbit'));
        btn.classList.add('active-orbit');
      });
    });
  });
</script>


<!-- Phase 201.3 ‚Äî Intake Pipeline Integration -->
<script>
// Upgraded drift-aware Neural Intake Pipeline Integration
document.addEventListener("DOMContentLoaded", () => {
  const intakeBtn = document.getElementById("launchNeuralIntakeBtn");
  const intakeFile = document.getElementById("neuralIntakeFile");

  if (intakeBtn && intakeFile) {
    intakeBtn.addEventListener("click", () => intakeFile.click());
    intakeFile.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (!file) return;
      if (window.NeuralDataIntake?.parseUploadedFile) {
        window.NeuralDataIntake.parseUploadedFile(file);

        // After successful parse, inject report directly into Cortex with drift-aware session ID
        setTimeout(() => {
          const parsed = window.NeuralDataIntake.getParsedReports();
          if (!parsed || parsed.length === 0) {
            console.warn("Neural Intake: No parsed data found.");
            return;
          }

          // Generate session identifier based on timestamp
          const intakeSessionId = `Intake_${new Date().toISOString().replace(/[:.]/g, '-')}`;

          // Phase 700.4 ‚Äî Neural Drift Threshold Optimizer Injection
          if (!window.NeuralDriftThresholds) {
            window.NeuralDriftThresholds = {};
          }
          parsed.forEach(row => {
            const category = row.division;
            if (!window.NeuralDriftThresholds[category]) {
              window.NeuralDriftThresholds[category] = { count: 0, sumVariance: 0 };
            }
            const previousQty = 0; // Starting point for learning (can expand later)
            const variance = Math.abs(row.onHandUnits - previousQty);
            window.NeuralDriftThresholds[category].count += 1;
            window.NeuralDriftThresholds[category].sumVariance += variance;
          });

          parsed.forEach(row => {
            const avgDriftThreshold = Math.max(
              (window.NeuralDriftThresholds[row.division].sumVariance / window.NeuralDriftThresholds[row.division].count) * 0.25,
              5
            );
            const forecastEntry = {
              timestamp: new Date().toISOString(),
              intakeSessionId: intakeSessionId,
              itemNumber: row.itemNumber,
              division: row.division,
              onHandUnits: row.onHandUnits,
              cycleCountUnits: row.cycleCountUnits,
              shrinkUnits: row.shrinkUnits,
              itdSalesUnits: row.itdSalesUnits,
              stabilityHint: (row.shrinkUnits > 0 || row.cycleCountUnits !== 0) ? "Volatile" : "Stable",
              riskSignal: "üü¢ Stable",
              anomalySignal: "‚ö™ Unanalyzed",
              learnedDriftThreshold: avgDriftThreshold.toFixed(1)
            };

            if (typeof window.NeuralForecastMemoryCortex?.injectForecastRecord === "function") {
              window.NeuralForecastMemoryCortex.injectForecastRecord(forecastEntry);
            }
          });

          console.log("üß† Neural Cortex successfully injected with live intake data.");
        }, 500);
      } else {
        alert("Neural Intake system unavailable.");
      }
    });
  }
});
</script>

<!-- Phase 201.4 ‚Äî Neural Intake Validation Diagnostics -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const validateIntakeBtn = document.createElement("button");
  validateIntakeBtn.textContent = "üß™ Validate Neural Intake";
  validateIntakeBtn.style.padding = "12px 18px";
  validateIntakeBtn.style.fontSize = "1em";
  validateIntakeBtn.style.fontFamily = "monospace";
  validateIntakeBtn.style.background = "#660033";
  validateIntakeBtn.style.color = "#fff";
  validateIntakeBtn.style.border = "2px solid #ff6699";
  validateIntakeBtn.style.borderRadius = "8px";
  validateIntakeBtn.style.cursor = "pointer";
  validateIntakeBtn.style.transition = "all 0.3s ease";

  validateIntakeBtn.addEventListener("click", () => {
    const parsed = window.NeuralDataIntake?.getParsedReports();
    if (!parsed || parsed.length === 0) {
      alert("‚ö† No parsed reports loaded.");
      return;
    }

    let sample = parsed.slice(0, 5);
    console.log("üß† Neural Intake Sample:", sample);
    alert(`‚úÖ Neural Intake contains ${parsed.length} rows. First 5 samples logged to console.`);
  });

  const operatorTools = document.getElementById("operatorTools");
  if (operatorTools) {
    operatorTools.appendChild(validateIntakeBtn);
  }
});
</script>

<!-- Phase 201.5 ‚Äî Neural Cortex Session Memory Archiver -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const archiveIntakeBtn = document.createElement("button");
  archiveIntakeBtn.textContent = "üíæ Archive Neural Session";
  archiveIntakeBtn.style.padding = "12px 18px";
  archiveIntakeBtn.style.fontSize = "1em";
  archiveIntakeBtn.style.fontFamily = "monospace";
  archiveIntakeBtn.style.background = "#224466";
  archiveIntakeBtn.style.color = "#fff";
  archiveIntakeBtn.style.border = "2px solid #3399ff";
  archiveIntakeBtn.style.borderRadius = "8px";
  archiveIntakeBtn.style.cursor = "pointer";
  archiveIntakeBtn.style.transition = "all 0.3s ease";

  archiveIntakeBtn.addEventListener("click", () => {
    const parsed = window.NeuralDataIntake?.getParsedReports();
    if (!parsed || parsed.length === 0) {
      alert("‚ö† No parsed intake data available.");
      return;
    }

    const archiveBlob = new Blob([JSON.stringify(parsed, null, 2)], { type: "application/json" });
    const archiveUrl = URL.createObjectURL(archiveBlob);
    const link = document.createElement("a");
    link.href = archiveUrl;
    link.download = `NeuralSession_${new Date().toISOString().replace(/[:.]/g,'-')}.json`;
    link.click();
    URL.revokeObjectURL(archiveUrl);

    console.log("üì¶ Neural Session archived successfully.");
  });

  const operatorTools = document.getElementById("operatorTools");
  if (operatorTools) {
    operatorTools.appendChild(archiveIntakeBtn);
  }
});
</script>

<!-- Phase 201.6 ‚Äî Neural Session Replay Engine -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const replayFileInput = document.createElement("input");
  replayFileInput.type = "file";
  replayFileInput.accept = ".json";
  replayFileInput.style.display = "none";
  document.body.appendChild(replayFileInput);

  const replayBtn = document.createElement("button");
  replayBtn.textContent = "üîÑ Replay Neural Session";
  replayBtn.style.padding = "12px 18px";
  replayBtn.style.fontSize = "1em";
  replayBtn.style.fontFamily = "monospace";
  replayBtn.style.background = "#333300";
  replayBtn.style.color = "#fff";
  replayBtn.style.border = "2px solid #cccc00";
  replayBtn.style.borderRadius = "8px";
  replayBtn.style.cursor = "pointer";
  replayBtn.style.transition = "all 0.3s ease";

  replayBtn.addEventListener("click", () => replayFileInput.click());

  replayFileInput.addEventListener("change", (e) => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(event) {
      try {
        const replayData = JSON.parse(event.target.result);
        if (!Array.isArray(replayData) || replayData.length === 0) {
          alert("Invalid neural session file.");
          return;
        }

        // Replay into Cortex Forecast Memory
        replayData.forEach(row => {
          const forecastEntry = {
            timestamp: new Date().toISOString(),
            itemNumber: row.itemNumber,
            division: row.division,
            onHandUnits: row.onHandUnits,
            cycleCountUnits: row.cycleCountUnits,
            shrinkUnits: row.shrinkUnits,
            itdSalesUnits: row.itdSalesUnits,
            stabilityHint: (row.shrinkUnits > 0 || row.cycleCountUnits !== 0) ? "Volatile" : "Stable"
          };

          if (typeof window.NeuralForecastMemoryCortex?.injectForecastRecord === "function") {
            window.NeuralForecastMemoryCortex.injectForecastRecord(forecastEntry);
          }
        });

        alert(`‚úÖ Neural session replay complete: ${replayData.length} records re-injected.`);
        console.log("üîÑ Neural Session Replay Injected:", replayData);
      } catch (err) {
        console.error("‚ùå Failed to replay neural session:", err);
        alert("Error loading neural session file.");
      }
    };
    reader.readAsText(file);
  });

  const operatorTools = document.getElementById("operatorTools");
  if (operatorTools) {
    operatorTools.appendChild(replayBtn);
  }
});
</script>

<!-- Phase 201.7 ‚Äî Neural Intake Growth Visualizer -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const growthBtn = document.createElement("button");
  growthBtn.textContent = "üìä View Neural Growth";
  growthBtn.style.padding = "12px 18px";
  growthBtn.style.fontSize = "1em";
  growthBtn.style.fontFamily = "monospace";
  growthBtn.style.background = "#004422";
  growthBtn.style.color = "#fff";
  growthBtn.style.border = "2px solid #33cc66";
  growthBtn.style.borderRadius = "8px";
  growthBtn.style.cursor = "pointer";
  growthBtn.style.transition = "all 0.3s ease";

  growthBtn.addEventListener("click", () => {
    const parsed = window.NeuralDataIntake?.getParsedReports();
    const cortex = window.NeuralForecastMemoryCortex?.getForecastHistory?.();
    const sessionTotal = parsed?.length || 0;
    const cortexTotal = cortex?.length || 0;

    let message = `üß† Neural Growth Stats:\n\n`;
    message += `Current Intake Session: ${sessionTotal} rows\n`;
    message += `Forecast Cortex Memory: ${cortexTotal} forecast records\n`;
    message += `\nCortex Stability: ${cortexTotal > 0 ? "ACTIVE" : "IDLE"}`;

    alert(message);
  });

  const operatorTools = document.getElementById("operatorTools");
  if (operatorTools) {
    operatorTools.appendChild(growthBtn);
  }
});
</script>


<!-- Phase 201.8 ‚Äî Neural Stability Advisor Engine -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const stabilityBtn = document.createElement("button");
  stabilityBtn.textContent = "‚öñÔ∏è Neural Stability Check";
  stabilityBtn.style.padding = "12px 18px";
  stabilityBtn.style.fontSize = "1em";
  stabilityBtn.style.fontFamily = "monospace";
  stabilityBtn.style.background = "#330066";
  stabilityBtn.style.color = "#fff";
  stabilityBtn.style.border = "2px solid #cc66ff";
  stabilityBtn.style.borderRadius = "8px";
  stabilityBtn.style.cursor = "pointer";
  stabilityBtn.style.transition = "all 0.3s ease";

  stabilityBtn.addEventListener("click", () => {
    const cortex = window.NeuralForecastMemoryCortex?.getForecastHistory?.();
    if (!cortex || cortex.length === 0) {
      alert("‚ö† Cortex memory is empty.");
      return;
    }

    let total = cortex.length;
    let stable = cortex.filter(f => f.stabilityHint === "Stable").length;
    let volatile = total - stable;
    let volatilityRate = ((volatile / total) * 100).toFixed(1);

    let message = `üß† Neural Stability Check:\n\n`;
    message += `Total Forecast Records: ${total}\n`;
    message += `Stable Records: ${stable}\n`;
    message += `Volatile Records: ${volatile}\n`;
    message += `Volatility Rate: ${volatilityRate}%\n\n`;

    if (volatilityRate > 30) {
      message += "‚ö† High volatility detected.\nConsider deeper review or fresh session ingestion.";
    } else if (volatilityRate > 15) {
      message += "üåÄ Moderate volatility detected.\nMonitor closely.";
    } else {
      message += "‚úÖ Cortex stability is strong and healthy.";
    }

    alert(message);
  });

  const operatorTools = document.getElementById("operatorTools");
  if (operatorTools) {
    operatorTools.appendChild(stabilityBtn);
  }
});
</script>


<!-- Phase 201.9 ‚Äî Predictive Health Composite Index -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const healthIndexBtn = document.createElement("button");
  healthIndexBtn.textContent = "üìä Predictive Health Index";
  healthIndexBtn.style.padding = "12px 18px";
  healthIndexBtn.style.fontSize = "1em";
  healthIndexBtn.style.fontFamily = "monospace";
  healthIndexBtn.style.background = "#661111";
  healthIndexBtn.style.color = "#fff";
  healthIndexBtn.style.border = "2px solid #ff4444";
  healthIndexBtn.style.borderRadius = "8px";
  healthIndexBtn.style.cursor = "pointer";
  healthIndexBtn.style.transition = "all 0.3s ease";

  healthIndexBtn.addEventListener("click", () => {
    const cortex = window.NeuralForecastMemoryCortex?.getForecastHistory?.() || [];
    const parsed = window.NeuralDataIntake?.getParsedReports() || [];
    const volatility = cortex.filter(f => f.stabilityHint === "Volatile").length;
    const stable = cortex.length - volatility;
    const total = cortex.length;

    const stabilityScore = total > 0 ? (stable / total) * 100 : 0;
    const dataVolumeScore = Math.min((parsed.length / 1000) * 100, 100);
    const volatilityPenalty = Math.min((volatility / total) * 100, 100);
    const compositeScore = Math.max(Math.min(((stabilityScore * 0.6) + (dataVolumeScore * 0.3) - (volatilityPenalty * 0.1)), 100), 0).toFixed(1);

    let message = `üßÆ Predictive Health Composite Index\n\n`;
    message += `Total Forecast Records: ${total}\n`;
    message += `Stable: ${stable}, Volatile: ${volatility}\n`;
    message += `Intake Records: ${parsed.length}\n\n`;
    message += `üìä Composite Health Index: ${compositeScore}%\n`;

    if (compositeScore >= 90) {
      message += "‚úÖ Excellent System Integrity.";
    } else if (compositeScore >= 70) {
      message += "üåÄ Acceptable, some volatility present.";
    } else {
      message += "‚ö†Ô∏è Degraded ‚Äî consider retraining intake sessions.";
    }

    alert(message);
  });

  const operatorTools = document.getElementById("operatorTools");
  if (operatorTools) {
    operatorTools.appendChild(healthIndexBtn);
  }
});
</script>

<!-- Phase 201.10 ‚Äî Live Intake Sync Injector -->
<script>
// Phase 201.10 ‚Äî Live Intake Sync Injector
document.addEventListener("DOMContentLoaded", () => {
  const scanInput = document.getElementById("scanInput");
  const liveQty = document.getElementById("liveQty");
  const categorySelect = document.getElementById("categorySelect");
  const addLiveItemBtn = document.getElementById("addLiveItem");

  if (addLiveItemBtn) {
    addLiveItemBtn.addEventListener("click", () => {
      const itemNumber = scanInput ? scanInput.value.trim() : "";
      const qty = liveQty ? parseInt(liveQty.value) : NaN;
      const category = categorySelect ? categorySelect.value : "";

      if (!itemNumber || isNaN(qty) || qty <= 0) {
        alert("Please enter valid item and quantity.");
        return;
      }

      // Phase 630.0 ‚Äî Risk & Anomaly Signal Injection
      const forecastEntry = {
        timestamp: new Date().toISOString(),
        itemNumber: itemNumber,
        division: category,
        onHandUnits: qty,
        cycleCountUnits: 0,
        shrinkUnits: 0,
        itdSalesUnits: 0,
        stabilityHint: "Stable",
        riskSignal: "üü¢ Stable",
        anomalySignal: "‚ö™ Unanalyzed"
      };

      if (typeof window.NeuralForecastMemoryCortex?.injectForecastRecord === "function") {
        window.NeuralForecastMemoryCortex.injectForecastRecord(forecastEntry);
      }

      if (window.NeuralVisualSync?.refreshLiveTableFromCortex) {
        window.NeuralVisualSync.refreshLiveTableFromCortex();
      }

      if (scanInput) {
        scanInput.value = "";
        scanInput.focus();
      }
    });
  }
});
</script>

<!-- Phase 630.1 ‚Äî Neural Anomaly Analyzer Engine -->
<script>
// Phase 630.1 ‚Äî Neural Anomaly Analyzer Engine
document.addEventListener("DOMContentLoaded", () => {
  if (typeof window.NeuralForecastMemoryCortex?.addInjectionHook === "function") {
    window.NeuralForecastMemoryCortex.addInjectionHook(() => {
      const cortex = window.NeuralForecastMemoryCortex?.getForecastHistory?.() || [];
      if (cortex.length === 0) return;

      // Calculate category frequency map
      const categoryCounts = {};
      cortex.forEach(f => {
        categoryCounts[f.division] = (categoryCounts[f.division] || 0) + 1;
      });

      // Apply anomaly signals based on category dominance
      cortex.forEach(f => {
        const total = cortex.length;
        const categoryFreq = categoryCounts[f.division] || 0;
        if (categoryFreq > (total * 0.5)) {
          f.anomalySignal = "üü† Anomaly: Category Surge";
        } else {
          f.anomalySignal = "üü¢ No Anomaly";
        }
      });
    });
  }
});
</script>

<!-- Modal for unknown item prompt -->
  <div id="customModal" role="dialog" aria-modal="true" aria-labelledby="modalPromptText" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);display:none;justify-content:center;align-items:center;z-index:10000;">
    <div style="background:#1e1e1e;padding:20px;border-radius:8px;color:white;max-width:90%;text-align:center;">
      <h3 id="modalPromptText"></h3>
      <div style="margin-top:15px;">
        <button id="modalBtnLocation" role="button" aria-label="Set as Bay Location" style="margin:5px;">üìç Bay Location</button>
        <button id="modalBtnProduct" role="button" aria-label="Set as Product" style="margin:5px;">üì¶ Product</button>
        <button id="modalBtnESL" role="button" aria-label="Set as ESL Tag" style="margin:5px;">üè∑Ô∏è ESL Tag</button>
        <button id="modalBtnCancel" role="button" aria-label="Cancel modal" style="margin:5px;">‚ùå Cancel</button>
      </div>
    </div>
  </div>

<!-- Phase 201.11 ‚Äî Modal Completion Sync Injector -->
<!-- Phase 201.13 ‚Äî Unified Modal Completion Sync Injector -->
<script>
// Unified Cortex-only Modal Completion Sync Injector
document.addEventListener("DOMContentLoaded", () => {
  const scanInput = document.getElementById("scanInput");
  const liveQty = document.getElementById("liveQty");
  const categorySelect = document.getElementById("categorySelect");

  function handleModalComplete(itemNumber, category, qty = 1) {
    // Phase 630.0 ‚Äî Risk & Anomaly Signal Injection
    const forecastEntry = {
      timestamp: new Date().toISOString(),
      itemNumber: itemNumber,
      division: category,
      onHandUnits: qty,
      cycleCountUnits: 0,
      shrinkUnits: 0,
      itdSalesUnits: 0,
      stabilityHint: "Stable",
      riskSignal: "üü¢ Stable",
      anomalySignal: "‚ö™ Unanalyzed"
    };

    if (typeof window.NeuralForecastMemoryCortex?.injectForecastRecord === "function") {
      window.NeuralForecastMemoryCortex.injectForecastRecord(forecastEntry);
    }

    if (window.NeuralVisualSync?.refreshLiveTableFromCortex) {
      window.NeuralVisualSync.refreshLiveTableFromCortex();
    }

    if (scanInput) {
      scanInput.value = "";
      scanInput.focus();
    }
  }

  // Attach modal buttons once for all modes:
  const bindModalButton = (btnId) => {
    const button = document.getElementById(btnId);
    if (button) {
      button.addEventListener("click", () => {
        const itemNumber = prompt("Enter Lowe's Item #");
        const qty = liveQty ? parseInt(liveQty.value) : 1;
        const category = categorySelect ? categorySelect.value : "";
        if (!itemNumber) return;
        handleModalComplete(itemNumber, category, qty);
      });
    }
  };

  bindModalButton("modalBtnProduct");
  bindModalButton("modalBtnESL");
  bindModalButton("modalBtnLocation");
});
</script>

  <!-- Trend Modal -->
  <div id="trendsModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.8); z-index:10000; justify-content:center; align-items:center;">
    <div style="background:#fff; padding:20px; border-radius:8px; max-width:90%; max-height:80%; overflow:auto;">
      <h3 style="text-align:center;">üìà Inventory Trends</h3>
      <canvas id="trendChart" width="400" height="250"></canvas>
      <div style="text-align:center; margin-top:15px;">
        <button id="closeTrendsBtn">‚ùå Close</button>
      </div>
    </div>
  </div>



  <!-- üßô‚Äç‚ôÇÔ∏è Sage Terminal Console -->
  <div id="sageTerminal" class="holo-console console-active sage-terminal">
    <div class="crystal-frame">
      <div class="sage-glow"></div>
      <div class="sage-output" id="sageOutputDisplay">
        <!-- The Sage whispers will appear here -->
      </div>
    </div>
  </div>

  <!-- üåå Modular Gameplay Console Arena -->
  <div id="gameplayArenaMount">
    <!-- Consoles from gameplay.html will be injected here by mesh renderer -->
  </div>
  <link rel="stylesheet" href="styles/gameplay.css" />

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const terminal = document.getElementById("sovereignTerminal");
      const input = document.getElementById("terminalInput");
      const output = document.getElementById("terminalOutput");

      if (terminal && input && output) {
        input.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            const cmd = input.value.trim();
            if (!cmd) return;
            output.textContent += `\n> ${cmd}`;
            let response = "";

            switch (cmd.toLowerCase()) {
              case "help":
                response = "Available commands: help, status, clear, credits, secret";
                break;
              case "status":
                response = "All systems operational. No anomalies detected.";
                break;
              case "clear":
                output.textContent = ":: Console cleared.";
                input.value = "";
                return;
              case "credits":
                response = "Sovereign Codex Framework ‚Äî Created by Tyson & Sage";
                break;
              case "secret":
                response = "üîÆ You have awakened a deeper thread...";
                break;
              default:
                response = "Unknown command. Type 'help' for options.";
            }

            output.textContent += `\n${response}`;
            input.value = "";
            output.scrollTop = output.scrollHeight;
          }
        });
      }
    });
  </script>


  
  <script>
  document.addEventListener("DOMContentLoaded", () => {
    console.log("üß† Orbit wiring script loaded");
    setTimeout(() => {
      const orbitButtons = document.querySelectorAll(".orbit-btn");
      console.log("üß© Found orbit buttons:", orbitButtons.length);

      orbitButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          const targetId = btn.getAttribute("data-target");
          const target = document.getElementById(targetId);
          if (!target) return;

          const isActive = target.classList.contains("console-active");

          // Hide all panels and deactivate all orbit buttons
          document.querySelectorAll(".holo-console").forEach(panel => {
            panel.classList.remove("console-active");
          });
          document.querySelectorAll(".orbit-btn").forEach(b => b.classList.remove("active-orbit"));

          if (!isActive) {
            // Only activate if it wasn‚Äôt already active
            target.classList.add("console-active");
            btn.classList.add("active-orbit");
          }
        });
      });
    }, 0);
  });
  </script>

  <script>
  // Dynamic Version Extractor
  (function() {
    try {
      const scripts = document.querySelectorAll('script[src]');
      let found = null;
      scripts.forEach(script => {
        if (script.src.includes('index.js?v=')) {
          const version = script.src.split('v=')[1];
          found = version;
        }
      });
      const versionInfoEl = document.getElementById('versionInfo');
      if (versionInfoEl) {
        versionInfoEl.innerText = found || "v? (not detected)";
      }
    } catch {
      const versionInfoEl = document.getElementById('versionInfo');
      if (versionInfoEl) {
        versionInfoEl.innerText = "v? (error)";
      }
    }
  })();
  </script>


  <!-- Phase 130.1 ‚Äî Control Tower Modals -->

  <!-- Diagnostics Modal -->
  <div id="diagnosticsModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="diagnosticsTitle" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);display:none;justify-content:center;align-items:center;z-index:10000;">
    <div style="background:#1e1e1e;padding:20px;border-radius:8px;color:white;max-width:90%;max-height:80%;overflow:auto;">
      <h3 id="diagnosticsTitle">üìä Diagnostics Panel</h3>
      <div id="diagnosticsContent" style="margin-top:15px;">
        <!-- Future diagnostics data will be injected here -->
      </div>
      <div style="text-align:center;margin-top:15px;">
        <button id="closeDiagnosticsBtn">‚ùå Close</button>
      </div>
    </div>
  </div>

  <!-- Resolver Modal -->
  <div id="resolverModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="resolverTitle" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);display:none;justify-content:center;align-items:center;z-index:10000;">
    <div style="background:#1e1e1e;padding:20px;border-radius:8px;color:white;max-width:90%;max-height:80%;overflow:auto;">
      <h3 id="resolverTitle">üßÆ Resolver Engine</h3>
      <div id="resolverContent" style="margin-top:15px;">
        <!-- Future resolver data will be injected here -->
      </div>
      
      <div id="threatMatrixContent" style="margin-top: 25px; padding: 15px; background: #222; border: 1px solid #555; border-radius: 5px; font-family: monospace; font-size: 0.95em; color: #fff;">
        <!-- Threat matrix summary will be injected here -->
      </div>
      
      <div style="text-align:center;margin-top:15px;">
        <button id="closeResolverBtn">‚ùå Close</button>
      </div>
    </div>
  </div>

  <!-- Dropbox Modal -->
  <div id="dropboxModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="dropboxTitle" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);display:none;justify-content:center;align-items:center;z-index:10000;">
    <div style="background:#1e1e1e;padding:20px;border-radius:8px;color:white;max-width:90%;max-height:80%;overflow:auto;">
      <h3 id="dropboxTitle">‚òÅÔ∏è Dropbox Control</h3>
      <div id="dropboxContent" style="margin-top:15px;">
        <!-- Future dropbox status data will be injected here -->
      </div>
      <div style="text-align:center;margin-top:15px;">
        <button id="closeDropboxBtn">‚ùå Close</button>
      </div>
    </div>
  </div>

  <!-- Dev Tools Modal -->
  <div id="devToolsModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="devToolsTitle" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);display:none;justify-content:center;align-items:center;z-index:10000;">
    <div style="background:#1e1e1e;padding:20px;border-radius:8px;color:white;max-width:90%;max-height:80%;overflow:auto;">
      <h3 id="devToolsTitle">üß™ Developer Tools</h3>
      <div id="devToolsContent" style="margin-top:15px;">
        <!-- Future developer tools UI will be injected here -->
      </div>
      <div style="text-align:center;margin-top:15px;">
        <button id="closeDevToolsBtn">‚ùå Close</button>
      </div>
    </div>
  </div>

  <!-- Toast container -->
  <div id="toastContainer" class="toast-container" aria-live="polite" aria-atomic="true" style="position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 9999; display: flex; flex-direction: column; align-items: center;"></div>

  <!-- Edit Item Modal -->
  <div id="editModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="editItemTitle" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);display:none;justify-content:center;align-items:center;z-index:10000;">
    <div style="background:#1e1e1e;padding:20px;border-radius:8px;color:white;max-width:90%;text-align:center;">
      <h3 id="editItemTitle">‚úèÔ∏è Edit Item</h3>

      <label for="editItemNumber">Item Number:</label>
      <input type="text" id="editItemNumber" style="margin: 5px 0;" />

      <label for="editScanCode">Scan Code:</label>
      <input type="text" id="editScanCode" style="margin: 5px 0;" />

      <label for="editScanType">Type:</label>
      <select id="editScanType" style="margin: 5px 0;">
        <option value="product">Product</option>
        <option value="esl">ESL</option>
        <option value="bay">Bay</option>
      </select>

      <label for="editScanValue">Mapped Value:</label>
      <input type="text" id="editScanValue" style="margin: 5px 0;" />

      <label for="editItemQty">Quantity:</label>
      <input type="number" id="editItemQty" min="1" style="margin: 5px 0;" />

      <label for="editItemCategory">Category:</label>
      <select id="editItemCategory" style="margin: 5px 0;">
        <option value="Laundry">Laundry</option>
        <option value="Fridges & Freezers">Fridges & Freezers</option>
        <option value="Ranges">Ranges</option>
        <option value="Dishwashers">Dishwashers</option>
        <option value="Wall Ovens">Wall Ovens</option>
        <option value="Cooktops">Cooktops</option>
        <option value="OTR Microwaves">OTR Microwaves</option>
        <option value="Microwaves (Countertop)">Microwaves (Countertop)</option>
        <option value="Vent Hoods">Vent Hoods</option>
        <option value="Beverage & Wine Coolers">Beverage & Wine Coolers</option>
        <option value="Cabinets">Cabinets</option>
        <option value="Countertops">Countertops</option>
        <option value="Interior Doors">Interior Doors</option>
        <option value="Exterior Doors">Exterior Doors</option>
        <option value="Storm Doors">Storm Doors</option>
        <option value="Windows">Windows</option>
        <option value="Commodity Moulding">Commodity Moulding</option>
        <option value="Other / Misc">Other / Misc</option>
      </select>

      <div style="margin-top:15px;">
        <button id="confirmEditBtn" role="button" aria-label="Save edits to item" style="margin:5px;">‚úÖ Save</button>
        <button id="cancelEditBtn" role="button" aria-label="Cancel edit modal" style="margin:5px;">‚ùå Cancel</button>
      </div>
    </div>
  </div>

  <!-- Summary Modal -->
  <div id="summaryModal" class="modal hidden summary-modal" role="dialog" aria-modal="true" aria-labelledby="summaryTitle" style="display:none;">
    <div style="background:#1e1e1e;padding:20px;border-radius:8px;color:white;max-width:90%;max-height:80%;overflow:auto;">
      <h3 id="summaryTitle" style="text-align:center;">üìã Bay Audit Summary</h3>
      <div id="summaryContent" style="margin-top:15px; font-size: 0.95em;">
        <!-- Summary data will be injected here -->
      </div>
      <div style="text-align:center; margin-top:15px;">
        <button id="closeSummaryBtn" role="button" aria-label="Close summary modal" style="margin:5px;">‚úÖ Done</button>
      </div>
    </div>
  </div>

  <!-- Add Item Modal -->
  <div id="addItemModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="addItemTitle" aria-hidden="false" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);display:none;justify-content:center;align-items:center;z-index:10000;">
    <div style="background:#1e1e1e;padding:20px;border-radius:8px;color:white;max-width:90%;text-align:center;">
      <h3 id="addItemTitle">‚ûï Add New Item</h3>

      <label for="newItemCode">Item Number:</label>
      <input type="tel" id="newItemCode" placeholder="Enter item number..." style="margin: 5px 0;" />

      <label for="newItemQty">Quantity:</label>
      <input type="number" id="newItemQty" min="1" value="1" inputmode="numeric" style="margin: 5px 0;" />

      <label for="newItemCategory">Category:</label>
      <select id="newItemCategory" style="margin: 5px 0;">
        <option value="Laundry">Laundry</option>
        <option value="Fridges & Freezers">Fridges & Freezers</option>
        <option value="Ranges">Ranges</option>
        <option value="Dishwashers">Dishwashers</option>
        <option value="Wall Ovens">Wall Ovens</option>
        <option value="Cooktops">Cooktops</option>
        <option value="OTR Microwaves">OTR Microwaves</option>
        <option value="Microwaves (Countertop)">Microwaves (Countertop)</option>
        <option value="Vent Hoods">Vent Hoods</option>
        <option value="Beverage & Wine Coolers">Beverage & Wine Coolers</option>
        <option value="Cabinets">Cabinets</option>
        <option value="Countertops">Countertops</option>
        <option value="Interior Doors">Interior Doors</option>
        <option value="Exterior Doors">Exterior Doors</option>
        <option value="Storm Doors">Storm Doors</option>
        <option value="Windows">Windows</option>
        <option value="Commodity Moulding">Commodity Moulding</option>
        <option value="Other / Misc">Other / Misc</option>
      </select>

      <div style="margin-top:15px;">
        <button id="confirmAddItemBtn" role="button" aria-label="Confirm new item" style="margin:5px;">‚úÖ Add</button>
        <button id="cancelAddItemBtn" role="button" aria-label="Cancel add item modal" style="margin:5px;">‚ùå Cancel</button>
      </div>
    </div>
  </div>

  <!-- Item Link Modal -->
  <div id="itemLinkModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="itemLinkModalTitle" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);display:none;justify-content:center;align-items:center;z-index:10000;">
    <div style="background:#1e1e1e;padding:20px;border-radius:8px;color:white;max-width:90%;text-align:center;">
      <h3 id="itemLinkModalTitle">üîó Link Lowe's Item to UPC</h3>

      <label for="itemNumberInput">Lowe's Item #:</label>
      <input type="text" id="itemNumberInput" style="margin: 5px 0;" placeholder="Enter Lowe's item number..." />

      <label for="linkedUpcInput">Linked UPC:</label>
      <input type="text" id="linkedUpcInput" style="margin: 5px 0;" placeholder="Enter UPC code..." />

      <div style="margin-top:15px;">
        <button id="confirmLinkBtn" role="button" aria-label="Save item link" style="margin:5px;">‚úÖ Save Link</button>
        <button id="cancelLinkBtn" role="button" aria-label="Cancel link modal" style="margin:5px;">‚ùå Cancel</button>
      </div>
    </div>
  </div>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- SheetJS (xlsx parser) -->
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

  <script src="scripts/liquidGlass/glassMemory.js"></script>

  <script src="scripts/systems/sovereignAuth.js"></script>


  <!-- üß† Sovereign Toolbar Forge -->
  <script src="scripts/operator/sovereign/sovereignToolbarRenderer.js"></script>
  <!-- Bootstrap Neural must come before wiring.js -->
  <script src="scripts/bootstrap/bootstrapNeural.js"></script>
  <!-- Bootstrap Loader (must remain, handles dynamic module loading) -->
  <script src="scripts/bootstrap/bootstrapLoader.js"></script>

  <script src="scripts/core/sovereignCodex.js"></script>

  <!-- Core Mesh System & Companions -->
  <script src="scripts/core/signalMesh.js"></script>
  <script src="scripts/core/meshVitals.js"></script>
  <script src="scripts/core/companionMind.js"></script>

  <!-- Companion Modules -->
  <script src="scripts/companions/sage.js"></script>
  <script src="scripts/companions/engineer.js"></script>
  <script src="scripts/companions/archivist.js"></script>

  <!-- Operator Command Console (module) -->
  <script type="module" src="scripts/operator.console.js"></script>

  <script type="module" src="scripts/bootstrap/operatorConsoleReady.js"></script>

  <script type="module" src="scripts/registry/panel.registry.js"></script>

  <!-- Wiring logic loader -->
  <script src="scripts/bootstrap/wiring.js"></script>
  <!-- üßº Live Inventory Panel Force-Hide Patch -->
  <script>
    // Patch: Force-hide #countConsole on DOMContentLoaded for legacy/stray panels
    window.addEventListener("DOMContentLoaded", () => {
      const liveInventoryPanel = document.querySelector("#countConsole");
      if (liveInventoryPanel) {
        liveInventoryPanel.classList.add("hidden");
        liveInventoryPanel.style.display = "none";
        liveInventoryPanel.style.opacity = "0";
        liveInventoryPanel.style.height = "0px";
        liveInventoryPanel.style.margin = "0px";
        liveInventoryPanel.style.padding = "0px";
        liveInventoryPanel.style.position = "absolute";
        console.log("üßº Live Inventory Panel force-hidden on load.");
      } else {
        console.warn("‚ö†Ô∏è Could not locate Live Inventory Panel for cleanup.");
      }
    });
  </script>

  <!-- Phase 7000.1 ‚Äî Sovereign Command Bridge Presence Validator -->
  <script>
    // Phase 7000.1 ‚Äî Sovereign Command Bridge Presence Validator
    document.addEventListener("DOMContentLoaded", () => {
      const cb = document.getElementById("neuralCommandBridge");
      if (!cb) {
        console.warn("[SOVEREIGN:BridgeCheck] ‚ö†Ô∏è Command Bridge not found in DOM. This may indicate a missing bridge injection or early load order issue.");
      } else {
        console.log("[SOVEREIGN:BridgeCheck] ‚úÖ Command Bridge found. Forcing hidden...");
        // Always start hidden; only show when gear icon is clicked
        // cb.style.display = "block";
        cb.style.display = "none";
        cb.style.visibility = "visible";
        cb.style.zIndex = 9999;
      }
    });
  </script>

  <!-- üåÄ Whisperer Entity Module -->
  <script type="module" src="scripts/entities/theWhisperer.js"></script>

  <script type="module" src="scripts/stability/snapPinLock.js"></script>
  <script type="module" src="scripts/stability/panelSnapTracer.js"></script>
  <script type="module" src="scripts/stability/snapPinDefender.js"></script>
  <script type="module" src="scripts/lifecycle/panelSnapAnchor.js"></script>
  <script type="module" src="scripts/lifecycle/panelZoneAnchor.js"></script>
  <script type="module" src="scripts/lifecycle/snapGridFinalizer.js"></script>
  <script type="module" src="scripts/lifecycle/snapMemoryEngine.js"></script>
  <script type="module" src="scripts/lifecycle/snapMemoryRecall.js"></script>
  <script type="module" src="scripts/lifecycle/autoSnapMemoryRecall.js"></script>
  <script type="module" src="scripts/lifecycle/snapMemoryGuardian.js"></script>
  <script type="module" src="scripts/bootstrap/panelLoader.js"></script>
  <script type="module" src="scripts/lifecycle/panelVisibilityReconciliation.js"></script>
  <!-- === Stability Modules === -->
<script type="module" src="scripts/stability/panelLoadoutSanitizer.js"></script>
<script type="module" src="scripts/stability/uiRenderCompensator.js"></script>
<script type="module" src="scripts/stability/uiRogueScanner.js"></script>
<script type="module" src="scripts/stability/scripts/mesh/orbitSummoner.js"></script>
<script type="module" src="scripts/stability/scripts/stability/scripts/mesh/safePanelSweep.js"></script>
<script type="module" src="scripts/stability/scripts/stability/scripts/sovereignLoadPlan.js"></script>
<script type="module" src="scripts/stability/scripts/stability/sovereignStartupVisibility.js"></script>
<script type="module" src="scripts/stability/uiCloakEngine.js"></script>
<script type="module" src="scripts/core/sovereignPanelDirective.js"></script>
<script type="module" src="scripts/core/sovereignPanelEnforcer.js"></script>
<script type="module" src="scripts/grid/SovereignPanelGridClassifier.js"></script>
<!-- <script type="module" src="scripts/stability/uiRoguePurger.js"></script> -->

  <!-- üß† Dock Toggle Bar Panel Runtime Toggle Logic -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const toggleButtons = document.querySelectorAll(".dock-toggle-button");
      toggleButtons.forEach(button => {
        button.addEventListener("click", () => {
          const target = document.querySelector(button.getAttribute("data-target"));
          if (!target) return;

          const allConsoles = document.querySelectorAll(".holo-console");
          allConsoles.forEach(console => {
            if (console !== target) {
              console.classList.add("hidden");
              console.setAttribute("aria-hidden", "true");
            }
          });

          target.classList.toggle("hidden");
          target.setAttribute("aria-hidden", !target.classList.contains("hidden"));
        });
      });
    });
  </script>

<!-- Phase 600.0 ‚Äî Predictive HUD Deep Linkage Bootstrap -->
<script>
// Phase 600.0 ‚Äî Predictive HUD Deep Linkage Bootstrap
document.addEventListener("DOMContentLoaded", () => {
  // Predictive HUD element bindings
  const hudRiskLevel = document.getElementById("riskMetric");
  const hudForecastLevel = document.getElementById("forecastMetric");
  const hudAnomalyStatus = document.getElementById("anomalyMetric");
  const hudDriftStatus = document.getElementById("driftMetric");

  function updatePredictiveHUD() {
    const cortex = window.NeuralForecastMemoryCortex?.getForecastHistory?.() || [];
    const total = cortex.length;

    if (total === 0) {
      if (hudRiskLevel) hudRiskLevel.textContent = "No data";
      if (hudForecastLevel) hudForecastLevel.textContent = "No data";
      if (hudAnomalyStatus) hudAnomalyStatus.textContent = "No data";
      if (hudDriftStatus) hudDriftStatus.textContent = "Idle";
      return;
    }

    const volatility = cortex.filter(f => f.stabilityHint === "Volatile").length;
    const stable = total - volatility;
    const volatilityRate = ((volatility / total) * 100).toFixed(1);
    const uniqueCategories = [...new Set(cortex.map(f => f.division))];

    // Simple Anomaly Detector: if any category occurs unusually often
    const categoryCounts = {};
    cortex.forEach(f => {
      categoryCounts[f.division] = (categoryCounts[f.division] || 0) + 1;
    });
    const maxCategory = Object.values(categoryCounts).reduce((a, b) => Math.max(a, b), 0);
    const anomalyFlag = maxCategory > (total * 0.5) ? "Elevated" : "Nominal";

    // Null checks and field updates
    if (hudRiskLevel) hudRiskLevel.textContent = volatilityRate ? `${volatilityRate}% Volatile` : "Unknown";
    if (hudForecastLevel) hudForecastLevel.textContent = total ? `${total} records` : "Pending";
    if (hudAnomalyStatus) hudAnomalyStatus.textContent = anomalyFlag || "Idle";
    if (hudDriftStatus) hudDriftStatus.textContent = "Sync OK";
  }

  // Initial HUD update on page load
  updatePredictiveHUD();

  // Hook into Cortex injection to refresh HUD after each change
  if (typeof window.NeuralForecastMemoryCortex?.addInjectionHook === "function") {
    window.NeuralForecastMemoryCortex.addInjectionHook(updatePredictiveHUD);
  }
});
</script>
  <script>
    function toggleCommandBridge() {
      const bridge = document.getElementById('neuralCommandBridge');
      if (!bridge) return;
      const isVisible = bridge.style.display !== 'none';
      bridge.style.display = isVisible ? 'none' : 'block';
    }

    // Optional: Start hidden if needed
    // document.addEventListener("DOMContentLoaded", () => {
    //   const bridge = document.getElementById('neuralCommandBridge');
    //   if (bridge) bridge.style.display = 'none';
    // });
  </script>

<!-- üß≠ HUD Toggle Button -->
<div id="brainDockButton" class="hud-toggle-icon" onclick="toggleHudPanel()">üß≠</div>
  <style>
    .command-bridge-toggle {
      position: fixed;
      bottom: 15px;
      left: 15px;
      z-index: 9999;
      cursor: pointer;
      background: radial-gradient(circle, #2a003f 40%, #000 90%);
      color: #00ffcc;
      padding: 10px 12px;
      border-radius: 50%;
      border: 2px solid #00ffcc;
      box-shadow: 0 0 12px #00ffcc, 0 0 18px #00ffcc inset;
      font-size: 1.3rem;
      transition: all 0.3s ease;
    }
    .hud-toggle-icon {
      position: fixed;
      bottom: 15px;
      right: 15px;
      z-index: 9999;
      cursor: pointer;
      background: radial-gradient(circle, #2a003f 40%, #000 90%);
      color: #cc66ff;
      padding: 10px 12px;
      border-radius: 50%;
      border: 2px solid #cc66ff;
      box-shadow: 0 0 12px #cc66ff, 0 0 18px #cc66ff inset;
      font-size: 1.3rem;
      transition: all 0.3s ease;
    }
  </style>

<!-- Phase 200.7 ‚Äî Predictive HUD Isolation Container -->
<div id="brainDockHudPanel" style="
    position: fixed;
    bottom: 90px;
    right: 20px;
    background: linear-gradient(145deg, #1b1b2f, #2a003f);
    border: 2px solid #cc66ff;
    border-radius: 12px;
    padding: 14px 18px;
    box-shadow: 0 0 20px rgba(204, 102, 255, 0.7), inset 0 0 8px rgba(204, 102, 255, 0.5);
    font-family: monospace;
    color: #fff;
    z-index: 10000;
    width: 280px;
    transition: transform 0.3s ease, opacity 0.3s ease;
    display: none;
">
  <h3 style="margin:0 0 12px 0; color:#cc66ff;">üß≠ Predictive HUD</h3>
  <div class="hud-metrics">
    <div class="hud-stat"><span class="label">üß† RISK</span> <span id="riskMetric">No Data</span></div>
    <div class="hud-stat"><span class="label">üìà FORECAST</span> <span id="forecastMetric">No Data</span></div>
    <div class="hud-stat"><span class="label">‚ò¢Ô∏è ANOMALIES</span> <span id="anomalyMetric">No Data</span></div>
    <div class="hud-stat"><span class="label">üåÄ DRIFT</span> <span id="driftMetric">Idle</span></div>
  </div>
  <!-- Live HUD feed for displaying live data updates -->
  <div id="brainHudLiveFeed" class="hud-feed-text" style="margin-top:18px; text-align:center; font-size:1.05em; color:#cc99ff;">Initializing...</div>
</div>

<!-- üß≠ HUD Visibility Toggle Logic -->
<script>
  function toggleHudPanel() {
    const hud = document.getElementById("brainDockHudPanel");
    if (!hud) return;
    const isVisible = hud.style.display !== 'none';
    hud.style.display = isVisible ? 'none' : 'block';
  }
</script>
</div>

<!-- Phase 900.1 ‚Äî Sovereign Console Module: Tools -->
<div id="sovereignConsole-tools" class="sovereign-console-panel" style="
  display: none;
  background: #1b1b2f;
  border: 2px solid #9933ff;
  border-radius: 12px;
  padding: 20px;
  color: #fff;
  font-family: monospace;
  max-width: 90%;
  margin: 20px auto;
  box-shadow: 0 0 15px rgba(153, 51, 255, 0.8);
">
  <h3 style="margin-top: 0; color: #cc66ff;">üõ† Tools Console</h3>
  <p>This is the dedicated Sovereign Console for Tools operations.</p>
  <button onclick="alert('üîß Tool A Activated')">Run Tool A</button>
  <button onclick="alert('üî© Tool B Activated')">Run Tool B</button>
</div>

  <!-- Phase 900.2 ‚Äî Sovereign Console Module: Forecast -->
<div id="sovereignConsole-forecast" class="sovereign-console-panel hidden" style="
  display: none;
  background: #1b1b2f;
  border: 2px solid #9933ff;
  border-radius: 12px;
  padding: 20px;
  color: #fff;
  font-family: monospace;
  max-width: 90%;
  margin: 20px auto;
  box-shadow: 0 0 15px rgba(153, 51, 255, 0.8);
">
  <div class="console-header" style="display: flex; align-items: center; justify-content: space-between;">
    <h2 style="margin: 0; color: #cc66ff;">üß† Forecast Console</h2>
    <button class="console-close" style="font-size: 1.2em; background: none; border: none; color: #fff; cursor: pointer;" onclick="SovereignToolbarRenderer.toggleConsole('forecast')">‚úñ</button>
  </div>
  <div class="console-body" style="margin-top: 20px;">
    <p>Welcome to the Forecast Console. Here you will find predictive diagnostics and anomaly visualizations.</p>
    <ul class="console-feature-list" style="list-style: none; padding-left: 0; margin-top: 15px;">
      <li style="margin-bottom: 8px;">üìä Drift Sentinels</li>
      <li style="margin-bottom: 8px;">üåÄ Predictive Cortex</li>
      <li style="margin-bottom: 8px;">üß¨ Recursive Memory Mapper</li>
      <li style="margin-bottom: 8px;">üîÆ Adaptive Confidence Overlay</li>
    </ul>
  </div>
</div>



<!-- Phase 200.13 ‚Äî Forecast Drift Visualizer -->
<div id="forecastDriftModal" style="
  display:none; position:fixed; top:0; left:0; width:100vw; height:100vh;
  background:rgba(0,0,0,0.85); z-index:10001; justify-content:center; align-items:center;
">
  <div style="
    background:#1e1e2f; padding:20px; border-radius:12px;
    max-width:90%; max-height:80%; overflow:auto;
    box-shadow:0 0 20px rgba(153, 51, 255, 0.9);
  ">
    <h3 style="text-align:center; color:#cc66ff;">üìà Forecast Drift Visualizer</h3>
    <canvas id="forecastDriftChart" width="400" height="250"></canvas>
    <div style="text-align:center; margin-top:15px;">
      <button id="closeDriftChartBtn">‚ùå Close</button>
    </div>
  </div>
</div>
<script>
const predictiveHud = document.getElementById("brainDockHudPanel");
const brainDockBtn = document.getElementById("brainDockButton");

if (predictiveHud && brainDockBtn) {
  let hudVisible = false;

  brainDockBtn.addEventListener("click", () => {
    hudVisible = !hudVisible;
    predictiveHud.style.display = hudVisible ? "block" : "none";
  });
}
</script>

<!-- Forecast Drift Visualizer Logic -->
<script>
// Forecast Drift Visualizer Logic
document.addEventListener("DOMContentLoaded", () => {
  const driftModal = document.getElementById("forecastDriftModal");
  const closeDriftBtn = document.getElementById("closeDriftChartBtn");

  closeDriftBtn.addEventListener("click", () => {
    driftModal.style.display = "none";
  });

  window.renderForecastDriftChart = () => {
    driftModal.style.display = "flex";

    const ctx = document.getElementById("forecastDriftChart").getContext("2d");
    const cortex = window.NeuralForecastMemoryCortex?.getForecastHistory?.() || [];

    const labels = cortex.map(f => f.timestamp.slice(11, 19));
    const states = cortex.map(f => {
      if (f.state && f.state.match(/Stable/i)) return 1;
      if (f.state && f.state.match(/Volatile|Surge|Regression/i)) return -1;
      return 0;
    });

    new Chart(ctx, {
      type: "line",
      data: {
        labels: labels,
        datasets: [{
          label: "Stability",
          data: states,
          fill: false,
          borderColor: "#cc66ff",
          tension: 0.3,
          pointRadius: 3
        }]
      },
      options: {
        scales: {
          y: {
            min: -1.5,
            max: 1.5,
            ticks: { stepSize: 1 }
          }
        }
      }
    });
  };
});
</script>
  <!-- DOM Sync Audit Utility -->
  <!-- <script type="module">

  </script> -->
  </div>


  <!-- Phase 135.4 ‚Äî Forecast Overlay Containers Injection -->
  <div id="forecastSignalsContainer" style="display:none;"></div>
  <div id="anomalySignalsContainer" style="display:none;"></div>
  <div id="driftSignalsContainer" style="display:none;"></div>

  <!-- Developer Diagnostic Panel -->
  <div id="devDashboard" style="position:fixed; bottom:80px; right:20px; background:#111; border:2px solid #ff00ff; border-radius:8px; padding:15px; z-index:99999; box-shadow:0 0 20px #ff00ff; display:none;">
    <h3 style="margin:0 0 10px 0; color:#ff00ff; font-family:monospace;">üß™ Dev Tools</h3>
    <button id="runFullSystemAuditBtn" style="display:block; margin:5px 0;">Full System Audit</button>
    <button id="runWiringAuditBtn" style="display:block; margin:5px 0;">Wiring Audit</button>
    <button id="runAutoHealingBtn" style="display:block; margin:5px 0;">Auto Healing</button>
  </div>

  <!-- üß† Phase 16011 ‚Äî Sovereign Operator Access -->
  <div id="operatorLoginTrigger" onclick="toggleLoginPanel()">üë§</div>

<div id="sovereignLoginWrapper" style="display: none;">
  <div id="operatorLoginOverlay" class="sovereign-overlay">
    <div class="login-panel">
      <h2>üß¨ Sovereign Operator Access</h2>
      <input type="text" id="operatorUsername" placeholder="Operator ID" />
      <input type="password" id="operatorPassword" placeholder="Access Key" />
      <button id="operatorLoginBtn">Authenticate</button>
      <div id="loginFeedback" class="login-feedback"></div>
    </div>
  </div>
</div>

  <!-- üõ°Ô∏è Sovereign Operator Login Overlay -->
  <div id="sovereignLoginOverlay" class="sovereign-login-overlay hidden">
    <div class="login-panel">
      <h2>Sovereign Operator Access</h2>
      <p class="login-subtext">Tier Override Required</p>
      <input type="password" id="sovereignLoginInput" placeholder="Enter Override Key..." />
      <button id="sovereignLoginBtn">Authenticate</button>
      <div id="sovereignLoginFeedback" class="login-feedback"></div>
    </div>
  </div>

  <!-- Orbit Removal Panel Handlers -->
  <!--
  (orbitButtonsBar and its references removed)
  -->
<!-- script>
// Phase 600.1 ‚Äî Unified Sovereign Dock Wiring Linkage
document.addEventListener("DOMContentLoaded", () => {
  const panelMap = {
    count: "countContainer",
    deltaAnalyzer: "deltaAnalyzerSection",
    exceptionManager: "exceptionManagerSection",
    progressDashboard: "progressDashboardSection",
    reportingHub: "reportingHubSection",
    masterExportHub: "masterExportSection",
    utilityHub: "utilityHubSection",
    sessionManager: "sessionManagerSection",
    mappings: "mappingManagerSection",
    tools: "toolsPanel",
    audit: "auditSection",
    configPanel: "configPanelSection"
  };
});
</script>
-->

<!-- Phase 900.2 ‚Äî Sovereign Console Toggle Logic -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const buttons = document.querySelectorAll(".sovereign-toolbar-container button[data-panel-id]");
  buttons.forEach(btn => {
    btn.addEventListener("click", () => {
      const panelId = btn.getAttribute("data-panel-id");
      if (!panelId) return;
      document.querySelectorAll(".sovereign-console-panel").forEach(p => p.style.display = "none");
      const targetPanel = document.getElementById(panelId);
      if (targetPanel) targetPanel.style.display = "block";
    });
  });
});
</script>

<!-- Phase 17001 ‚Äî Pulse Monitor JS Logic (live data + refresh binding) -->
<script>
// Phase 17001 ‚Äî Pulse Monitor JS Logic (live data + refresh binding)
document.addEventListener("DOMContentLoaded", () => {
  const statusEl = document.querySelector("#pulseMonitorConsole .pulse-status");
  const heartbeatEl = document.querySelector("#pulseMonitorConsole .last-heartbeat-time");
  const signalLog = document.querySelector("#pulseMonitorConsole .signal-log-entries");
  const reflexLog = document.querySelector("#pulseMonitorConsole .reflex-log-entries");
  const refreshBtn = document.querySelector("#pulseMonitorConsole .refresh-pulse-monitor");
  const pulseBtn = document.querySelector('button[data-panel="#pulseMonitorConsole"]');

  function updatePulseMonitor() {
    const now = new Date().toLocaleTimeString();
    heartbeatEl.textContent = now;

    const signals = window.SignalMesh?.getRecentSignals?.() || [];
    signalLog.innerHTML = "";
    if (signals.length === 0) {
      const li = document.createElement("li");
      li.textContent = "No recent signals.";
      li.className = "faint";
      signalLog.appendChild(li);
    } else {
      signals.slice(-10).reverse().forEach(sig => {
        const li = document.createElement("li");
        li.textContent = `[${sig.timestamp}] ‚Üí ${sig.target}`;
        signalLog.appendChild(li);
      });
    }

    const reflexEntries = [];
    for (let key in window.CompanionMesh) {
      const mem = window.CompanionMesh[key]?.memory || [];
      if (mem.length > 0) {
        const last = mem[mem.length - 1];
        reflexEntries.push({ who: key, ...last });
      }
    }

    reflexLog.innerHTML = "";
    if (reflexEntries.length === 0) {
      const li = document.createElement("li");
      li.textContent = "No reflex entries found.";
      li.className = "faint";
      reflexLog.appendChild(li);
    } else {
      reflexEntries.forEach(entry => {
        const li = document.createElement("li");
        li.textContent = `${entry.who}: ${entry.type || "unknown"} ‚Üí ${entry.entry || JSON.stringify(entry)}`;
        reflexLog.appendChild(li);
      });
    }

    statusEl.textContent = "üü¢ Operational";
  }

  if (refreshBtn) {
    refreshBtn.addEventListener("click", updatePulseMonitor);
  }

  if (pulseBtn) {
    pulseBtn.addEventListener("click", () => {
      setTimeout(updatePulseMonitor, 100);
    });
  }
});
</script>
  <!-- <script src="scripts/liquidGlass/scripts/liquidGlass/glassOrbitHandler.js"></script> -->
  <script>
    // üßÆ Count Console Counter Logic
    let counter = 0;
    const countDisplay = document.getElementById('countDisplay');

    function updateCounter(amount) {
      counter += amount;
      if (countDisplay) countDisplay.textContent = counter;
    }

    function resetCounter() {
      counter = 0;
      if (countDisplay) countDisplay.textContent = counter;
    }

    // üìä Delta Analyzer Logic
    function calculateDelta() {
      const a = parseFloat(document.getElementById('deltaValueA').value);
      const b = parseFloat(document.getElementById('deltaValueB').value);
      const delta = (isNaN(a) || isNaN(b)) ? 'Invalid input' : a - b;
      document.getElementById('deltaResult').textContent = `Œî = ${delta}`;
    }

    function clearDeltaInputs() {
      document.getElementById('deltaValueA').value = '';
      document.getElementById('deltaValueB').value = '';
      document.getElementById('deltaResult').textContent = 'Œî = 0';
    }
  </script>
  <style>
    .delta-result {
      font-size: 2rem;
      margin-top: 1rem;
      color: #f0f;
      text-shadow: 0 0 5px #f0f;
    }

    .delta-controls button {
      margin: 0.3rem;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      background: rgba(255,255,255,0.05);
      border: 1px solid #f0f;
      color: #f0f;
      cursor: pointer;
    }

    .delta-controls button:hover {
      background: rgba(255,0,255,0.1);
    }

    #deltaAnalyzerConsole input {
      margin: 0.3rem 0.5rem;
      padding: 0.4rem;
      width: 120px;
      font-size: 1rem;
    }

    /* === Normalize Holo Console Panels === */
   /* === Sovereign Console Panel Visibility ‚Äî Grid Safe === */
.holo-console {
  visibility: hidden;
  opacity: 0;
  pointer-events: none;
  height: auto;
  margin: 0;
  padding: 0;
  position: relative;
  z-index: 1;
  transition: opacity 0.3s ease, transform 0.3s ease;
  display: block; /* Maintain grid alignment */
}

/* When active */
.holo-console.console-active {
  visibility: visible;
  opacity: 1;
  pointer-events: auto;
  padding: 20px;
  margin: 0;
  z-index: 10;
  transform: scale(1.01);
}
  </style>
  <script>
    function submitReport() {
      const input = document.getElementById('reportInput');
      const log = document.getElementById('reportLog');
      const text = input.value.trim();
      if (text === '') return;

      const timestamp = new Date().toLocaleString();
      const entry = document.createElement('li');
      entry.textContent = `[${timestamp}] ${text}`;
      log.appendChild(entry);
      input.value = '';
    }

    function clearReports() {
      document.getElementById('reportLog').innerHTML = '';
    }
    // Session Manager logic
    function startSession() {
      const input = document.getElementById('sessionNameInput');
      const sessionName = input.value.trim();
      if (!sessionName) return;

      const timestamp = new Date().toLocaleString();
      const display = document.getElementById('activeSessionDisplay');
      display.textContent = `üìå Active Session: "${sessionName}" started at ${timestamp}`;
      input.value = '';
    }


  function deactivateOrbitButtons(panel) {
    const orbitButtons = document.querySelectorAll(`.orbit-btn[data-target="${panel.id}"]`);
    orbitButtons.forEach(btn => btn.classList.remove("active-orbit"));
  }

  function closeConsole(button) {
    const panel = button.closest(".holo-console");
    if (!panel) return;

    button.blur(); // Prevent focus-related aria-hidden issue
    panel.classList.remove("console-active");
    panel.classList.add("hidden");
    panel.setAttribute("aria-hidden", "true");

    // Reset styling
    panel.style.display = "none";
    panel.style.visibility = "hidden";
    panel.style.opacity = "0";
    panel.style.height = "0px";
    panel.style.margin = "0px";
    panel.style.padding = "0px";
    panel.style.position = "absolute";
    panel.style.zIndex = "-1";

    deactivateOrbitButtons(panel);
  }

  function lockScrollToTop() {
    window.scrollTo(0, 0);
    document.body.scrollTop = 0;
    document.documentElement.scrollTop = 0;
  }

  document.addEventListener("DOMContentLoaded", () => {
    lockScrollToTop();
    window.scrollTo(0, 0);
    document.body.scrollTop = 0;
    document.documentElement.scrollTop = 0;
  });

  window.addEventListener("load", () => {
    lockScrollToTop();
    setTimeout(lockScrollToTop, 100);
    setTimeout(lockScrollToTop, 500);
    setTimeout(lockScrollToTop, 1000);
  });

  window.addEventListener("scroll", () => {
    if (window.scrollY !== 0) {
      lockScrollToTop();
    }
  });
</script>

<style>
  .session-display {
    margin-top: 1rem;
    font-size: 1rem;
    color: #00ffff;
    font-family: monospace;
    text-shadow: 0 0 4px #0ff;
  }

  #sessionNameInput {
    margin: 0.5rem 0.5rem 0.5rem 0;
    padding: 0.4rem;
    width: 200px;
    font-size: 1rem;
  }

  #sessionManagerConsole button {
    padding: 0.5rem 1rem;
    font-size: 1rem;
    background: rgba(0,255,255,0.05);
    border: 1px solid #00ffff;
    color: #00ffff;
    cursor: pointer;
  }

  #sessionManagerConsole button:hover {
    background: rgba(0,255,255,0.1);
  }
</style>
<!-- üî• Scorched Earth Protocol -->
<script>
  window.addEventListener("DOMContentLoaded", () => {
    const allowedPanels = [
      "neuralPulsePanel",
      "sovereignTerminal"
      // Add more IDs here if you want them to survive
    ];

    document.querySelectorAll('.holo-console').forEach(panel => {
      if (!allowedPanels.includes(panel.id)) {
        console.log(`üî• Removing: ${panel.id}`);
        panel.remove(); // Total purge
      } else {
        panel.style.display = "grid";
        panel.style.visibility = "visible";
        panel.style.opacity = "1";
      }
    });
  });
</script>
</body>
</html>